/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojanimation","ojdnd"],function(a,g){(function(){a.ib("oj.ojTreeView",g.oj.baseComponent,{version:"1.0.0",defaultElement:"\x3cdiv\x3e",widgetEventPrefix:"oj",options:{currentItem:null,data:null,dnd:{drag:null,drop:null},expanded:[],item:{focusable:null,renderer:null,selectable:null},selection:[],selectionMode:"none",animateEnd:null,animateStart:null,beforeCollapse:null,beforeCurrentItem:null,beforeExpand:null,collapse:null,expand:null},qc:function(){this._super()},
Df:function(){this._super();this.Ena()},Ena:function(){var a=this;this.element.off();this.element.removeClass("oj-complete");this.options.data?(this.element.find("ul").remove(),this.Jga(null,function(b){a.Gna(b,a.element);a.d4();a.element.addClass("oj-complete")})):(this.element.find("ul").addClass("oj-treeview-list").attr("role","group"),this.element.find("li").each(function(){var b=g(this);a.Ifa(b)}),this.d4(),this.element.addClass("oj-complete"));this.DGa();this.iJ=null},Jga:function(c,b){var d=
this.options.data,e={start:0,count:d.getChildCount(c)},f=this.Xh("fetching data");d.fetchChildren(c,e,{success:function(a){b(a);f()},error:function(b){a.D.error(b);f()}})},Gna:function(a,b){if(!(0>=a.getCount()))for(var d=g(document.createElement("ul")).addClass("oj-treeview-list").attr("role","group").appendTo(b),e=0;e<a.getCount();e++)this.ZRa(d,a,e)},ZRa:function(c,b,d){d+=b.getStart();var e=b.getData(d);b=b.getMetadata(d);var f=b.key,h=this.options.item.renderer,h=this.ml(h),k=g(document.createElement("li")).attr("id",
f).appendTo(c);if(h){var l={};l.parentElement=k;l.index=d;l.data=e;l.datasource=this.options.data;l.parentKey=this.rb(this.dQ(k));l.component=a.Components.ud(this.element);this.vk&&(l=this.vk(l));for(var m in b)b.hasOwnProperty(m)&&(l[m]=b[m]);m=h.call(this,l);null!=m&&(null===m.parentNode||m.parentNode instanceof DocumentFragment?k.append(m):null==m.parentNode&&m.toString&&(h=document.createElement("span"),h.appendChild(document.createTextNode(m.toString())),k.append(h)));k=c.children().eq(d);l.parentElement=
k;null==k.attr("id")&&k.attr("id",f)}k.data("data",e).data("metadata",b);this.Ifa(k)},DGa:function(){var a=this;this._on(this.element,{click:function(b){a.w1(b)},mouseover:function(b){a.N1(b)},mouseout:function(b){a.zQ(b)},mousedown:function(b){a.L1(b)},mouseup:function(b){a.O1(b)},keydown:function(b){a.hr(b)}});var b=this.st();0<Object.keys(b).length&&this._on(this.element,{dragstart:function(b){a.GI(b)},drag:function(b){a.Aja(b,"drag")},dragend:function(b){a.Aja(b,"dragEnd")}});b=this.mI();0<Object.keys(b).length&&
this._on(this.element,{dragenter:function(b){a.vQ(b,"dragEnter")},dragover:function(b){a.vQ(b,"dragOver")},dragleave:function(b){a.vQ(b,"dragLeave")},drop:function(b){a.vQ(b,"drop")}});this.QH||(b=g(document.createElement("span")).addClass("oj-treeview-drop-marker-icon oj-component-icon"),this.QH=g(document.createElement("div")).addClass("oj-treeview-drop-marker").append(b).appendTo(this.element),this.vga=this.QH[0].getBoundingClientRect());this.QH.hide();this.yC||(this.yC=g(document.createElement("div")).addClass("oj-treeview-drop-line").appendTo(this.element),
this.BHa=this.yC[0].getBoundingClientRect());this.yC.hide();b=this.Lia();this._focusable({element:b,applyHighlight:!0,setupHandlers:function(b,d){a.Aj=b;a.Qi=d}});b.attr("tabIndex",0).on("focus",function(){a.Aj(a.Hv(a.uv))}).on("blur",function(){a.Qi(a.Hv(a.uv))}).attr("role","tree").attr("aria-labelledby",this.element.attr("id"));var d=this.options.selectionMode;"none"!=d?b.attr("aria-multiselectable","multiple"==d?"true":"false"):b.removeAttr("aria-multiselectable")},Ifa:function(a){a.addClass("oj-treeview-item").attr("role",
"treeitem");var b=this.Hv(a);0==b.length&&(b=g(document.createElement("div")).addClass("oj-treeview-item-content").append(a.children(":not(ul)")).prependTo(a),b.find(".oj-treeview-item-icon").addClass("oj-treeview-icon"));this.ji(a);var d=this.st();b.attr("draggable",0<Object.keys(d).length?"true":"false");b=a.children(".oj-treeview-spacer");0==b.length&&(b=g(document.createElement("ins")).addClass("oj-treeview-icon oj-treeview-spacer").prependTo(a));this.Xn(a)?a.addClass("oj-treeview-leaf"):(this.fla(a)?
this.fe(a,!1):this.xh(a,!1),b.addClass("oj-treeview-disclosure-icon oj-component-icon oj-clickable-icon-nocontext oj-default"))},Bk:function(){return this.element.find(".oj-treeview-item")},rb:function(a){var b=a.data("metadata");return b?b.key:a.attr("id")},sI:function(a){return this.element.find("li#"+a)},Hv:function(a){return a.children(".oj-treeview-item-content")},mha:function(a){return a.children(".oj-treeview-list").children(".oj-treeview-item")},dQ:function(a){return a.parent(".oj-treeview-list").parent(".oj-treeview-item")},
DI:function(a){return a.children(".oj-treeview-list")},Lia:function(){return this.element.children(".oj-treeview-list")},Xn:function(a){var b=a.data("metadata");return!(b?!b.leaf:0<this.DI(a).length)},fla:function(a){a=this.rb(a);var b=this.options.expanded;return"all"==b||-1!=b.indexOf(a)},Fk:function(a){return a.hasClass("oj-expanded")},fe:function(a,b,d,e){var f=this;if(!(this.Fk(a)||this.Xn(a)||b&&!this._trigger("beforeExpand",d,this.pI(a))&&!1!==e)){if(0==this.DI(a).length)return f.Jga(f.rb(a),
function(e){f.Gna(e,a);f.Bga(a,b,d)});f.Bga(a,b,d);this.iJ=null}},Bga:function(a,b,d){var e=this;a.removeClass("oj-collapsed").addClass("oj-expanded").attr("aria-expanded","true");var f=this.DI(a);f.css("max-height","none");if(b){var g=this.Xh("animating expand");a.addClass("oj-treeview-animated");this.VD(f,"expand").then(function(){a.removeClass("oj-treeview-animated");e._trigger("expand",d,e.pI(a));g()})}},xh:function(a,b,d,e){var f=this;if(!(a.hasClass("oj-collapsed")||this.Xn(a)||b&&!this._trigger("beforeCollapse",
d,this.pI(a))&&!1!==e)){a.removeClass("oj-expanded").addClass("oj-collapsed").attr("aria-expanded","false");var g=this.DI(a);if(b){var k=this.Xh("animating collapse");a.addClass("oj-treeview-animated");this.VD(g,"collapse").then(function(){g.css("max-height",0);a.removeClass("oj-treeview-animated");f._trigger("collapse",d,f.pI(a));k()})}else g.css("max-height",0);this.iJ=null}},VD:function(c,b){this.Hp||(this.Hp=a.ic.Tc("oj-treeview-option-defaults"));return a.ea.wi(c[0],b,(this.Hp.animation||{})[b],
this)},pI:function(a){return{key:this.rb(a),item:a[0]}},VQ:function(a,b){var d=this.options.item[b+"able"];if(!1===d)return!1;if("function"===typeof d){var e=this.getContextByNode(a[0]);return d(e)}return!0},ei:function(a){a=this.rb(a);return-1!=this.options.selection.indexOf(a)},ji:function(c,b){var d=this.options.selectionMode;if("none"!=d&&this.VQ(c,"select")){var e=this.ei(c);if(b){var f=a.T.ie(),g=a.T.Xr(b),k="multiple"==d,l=40==b.keyCode||38==b.keyCode,d=this.rb(c),m=[];if(k&&b.shiftKey&&!l){g?
m=this.options.selection.slice(0):this.yj();for(f=(e=this.iJ)&&e.offset().top<c.offset().top?this.P0.bind(this):this.V0.bind(this);e&&e[0]!=c[0];)g=this.rb(e),-1==m.indexOf(g)&&(m.push(g),this.vS(e)),e=f(e,"select");e=!0;m.push(d)}else k&&(g||f||l)?(e=!e,m=this.options.selection.slice(0),e?m.push(d):m.splice(m.indexOf(d),1)):(this.yj(),(f||32==b.keyCode)&&e?(e=!1,m=[]):(e=!0,m=[d]));this.XS("selection",m,b);this.iJ=c}e?this.vS(c):this.cpa(c)}},vS:function(a){this.Hv(a).addClass("oj-selected");a.attr("aria-selected",
"true")},cpa:function(a){this.Hv(a).removeClass("oj-selected");a.attr("aria-selected","false")},yj:function(){this.cpa(this.Bk())},Wg:function(a,b){if(this.VQ(a,"focus")){if(b){var d=this.pI(a);this.uv&&(d.previousKey=this.rb(this.uv),d.previousItem=this.uv[0]);if(!this._trigger("beforeCurrentItem",b,d))return;this.XS("currentItem",this.rb(a),b)}this.Qi(this.Hv(this.uv));this.Aj(this.Hv(a));this.y4(a)}},d4:function(){if(this.options.currentItem){var a=this.sI(this.options.currentItem);if(0<a.length){this.y4(a);
return}}a=this.Bk().first();this.y4(a);this.XS("currentItem",this.rb(this.uv),null)},y4:function(a){this.uv=a;this.Lia().attr("aria-activedescendant",this.rb(a))},Xh:function(c){var b=a.Context.getContext(this.element[0]).md(),d=this.element.attr("id");return b.ad({description:"The component identified by '"+d+"', "+c})},XS:function(a,b,d){this.option(a,b,{_context:{originalEvent:d,gd:!0,ob:!0}})},st:function(){return((this.options.dnd||{}).drag||{}).items||{}},mI:function(){return((this.options.dnd||
{}).drop||{}).items||{}},IP:function(a){return g(a.target).closest(".oj-treeview-item-content")},fI:function(a){return g(a.target).closest(".oj-treeview-disclosure-icon")},w1:function(a){var b=this.fI(a);0<b.length?(b=b.closest(".oj-treeview-item"),this.Fk(b)?this.xh(b,!0,a):this.fe(b,!0,a)):(b=this.IP(a),0<b.length?(b=b.parent(),this.ji(b,a),this.Wg(b,a)):(this.yj(),this.iJ=null,this.XS("selection",[],a)))},N1:function(c){if(!a.T.ie()){var b=this.fI(c);0==b.length&&(b=this.IP(c));b.removeClass("oj-default");
b.addClass("oj-hover")}},zQ:function(c){if(!a.T.ie()){var b=this.fI(c);b.removeClass("oj-selected");0==b.length&&(b=this.IP(c));b.addClass("oj-default");b.removeClass("oj-hover")}},L1:function(a){this.fI(a).addClass("oj-selected")},O1:function(a){this.fI(a).removeClass("oj-selected")},hr:function(a){var b=a.keyCode,d=this.uv;if(38==b||40==b){if(b=40==b?this.P0(d,"focus"):this.V0(d,"focus"))a.preventDefault(),this.ei(d)&&a.shiftKey&&this.ji(this.ei(b)?d:b,a),this.Wg(b,a)}else if(37==b||39==b){var e=
"rtl"==this.Qc(),b=!e&&39==b||e&&37==b;if(!b||this.Xn(d)||this.Fk(d))if(b||this.Xn(d)||!this.Fk(d)){if(b=b?this.P0(d,"focus"):this.V0(d,"focus"))a.preventDefault(),this.Wg(b,a)}else a.preventDefault(),this.xh(d,!0,a);else a.preventDefault(),this.fe(d,!0,a)}else if(13==b||32==b)a.preventDefault(),this.ji(d,a)},HJa:function(a){if(!this.Xn(a)&&this.Fk(a)){var b=this.mha(a).first();if(0<b.length)return b}for(;0<a.length;){b=a.next(".oj-treeview-item");if(0<b.length)return b;a=this.dQ(a)}return null},
P0:function(a,b){for(;null!=a;)if(a=this.HJa(a),this.VQ(a,b))return a;return null},ZJa:function(a){for(var b=a.prev(".oj-treeview-item");0<b.length;)if(!this.Xn(b)&&this.Fk(b)){var d=this.mha(b).last();if(0<d.length)b=d;else return b}else return b;a=this.dQ(a);return 0<a.length?a:null},V0:function(a,b){for(;null!=a;)if(a=this.ZJa(a),this.VQ(a,b))return a;return null},GI:function(a){var b=this,d="rtl"==this.Qc(),e=this.IP(a).parent();if(0!=e.length){var f=g();if(this.ei(e))for(var h=this.options.selection,
e=0;e<h.length;e++)f=f.add(this.sI(h[e]));else this.ji(e,a),f=f.add(e);var h=this.st(),k=a.originalEvent.dataTransfer,l=[],m=g(document.createElement("ul")).addClass("oj-treeview-drag-image oj-treeview-list"),p=Infinity,t=Infinity;f.each(function(){var a=g(this);l.push(a.data("data"));var c=a.offset();d&&(c.left=b.Hv(a).offset().left);a=a.clone().css({top:c.top,left:c.left});b.DI(a).remove();c.top<p&&(p=c.top);c.left<t&&(t=c.left);m.append(a)});m.children().each(function(){g(this).css({top:parseFloat(g(this).css("top"))-
p,left:parseFloat(g(this).css("left"))-t})});f=h.dataTypes;for(e=0;e<f.length;e++)k.setData(f[e],JSON.stringify(l));g("body").append(m);k.setDragImage(m[0],a.pageX-t,a.pageY-p);setTimeout(function(){m.remove()},0);(f=h.dragStart)&&f(a.originalEvent,{items:l})}},Aja:function(a,b){var d=this.st()[b];d&&d(a.originalEvent)},vQ:function(a,b){var d=this.mI(),e=d.dataTypes,f=d[b],h=g(a.target).closest(".oj-treeview-item"),k=h.children(".oj-treeview-spacer")[0].getBoundingClientRect(),l=(k.top+k.bottom)/
2,d="inside",m=a.pageY-k.top;m<.25*k.height?d="before":m>.75*k.height&&(d=this.Fk(h)?"first":"after");f&&f(a.originalEvent,{item:h[0],position:d});if("dragEnter"==b||"dragOver"==b){var m="rtl"==this.Qc(),f=l,h=m?k.left-this.BHa.width:k.right,l=l-this.vga.height/2,p=k.left+k.width/2-this.vga.width/2;if("before"==d)l-=k.height/2,f-=k.height/2;else if("after"==d||"first"==d)l+=k.height/2,f+=k.height/2,"first"==d&&(k=(m?-1:1)*k.width,p+=k,h+=k);this.QH.css("top",l+"px").css("left",p+"px").show();"inside"!=
d?this.yC.css("top",f+"px").css("left",h+"px").show():this.yC.hide()}else this.QH.hide(),this.yC.hide();for(d=0;d<e.length;d++)if((k=a.originalEvent.dataTransfer.types)&&0<=k.indexOf(e[d])){a.preventDefault();break}},refresh:function(){this._super();this.Ena()},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var b=a.subId;a=this.sI(a.key);var d;"oj-treeview-disclosure"===b?d=a.children(".oj-treeview-disclosure-icon")[0]:"oj-treeview-item"===b&&(d=a[0]);return d||null},
getSubIdByNode:function(a){if(!g.contains(this.element[0],a))return null;var b=g(a);if(b.hasClass("oj-treeview-disclosure-icon"))b=b.parent(),a="oj-treeview-disclosure";else if(b.hasClass("oj-treeview-item"))a="oj-treeview-item";else return null;return{subId:a,key:this.rb(b)}},getContextByNode:function(c){if(!g.contains(this.element[0],c))return null;c=g(c);if(!c.hasClass("oj-treeview-item"))return null;var b={subId:"oj-treeview-item"};b.index=c.parent().children(".oj-treeview-item").index(c);b.parentKey=
this.rb(this.dQ(c));b.component=a.Components.ud(this.element);this.vk&&(b=this.vk(b));var d=c.data("metadata");if(d){b.data=c.data("data");b.datasource=this.options.data;for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}else b.key=this.rb(c),b.leaf=this.Xn(c),b.depth=c.parents(".oj-treeview-list").length;return b},getExpanded:function(){var a=this,b=[];this.Bk().each(function(){var d=g(this);a.Fk(d)&&b.push(a.rb(d))});return b},expand:function(a,b){var d=this.sI(a);this.fe(d,!0,null,b)},collapse:function(a,
b){var d=this.sI(a);this.xh(d,!0,null,b)},_setOption:function(a,b,d){var e=this;this._superApply(arguments);"expanded"==a?this.Bk().each(function(){var a=g(this);e.fla(a)?e.fe(a,!0):e.xh(a,!0)}):"selection"==a?this.Bk().each(function(){var a=g(this);e.ji(a)}):"currentItem"==a?this.d4():(this.options.expanded=this.getExpanded(),this.refresh())},_destroy:function(){this._super()}})})();a.J.$a("oj-tree-view","baseComponent",{properties:{currentItem:{type:"any",readOnly:!0,writeback:!0},data:{},dnd:{type:"object",
properties:{drag:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"Array\x3cstring\x3e"},drag:{},dragEnd:{},dragStart:{}}}}},drop:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"Array\x3cstring\x3e"},dragEnter:{},dragLeave:{},dragOver:{},drop:{}}}}}}},item:{type:"object",properties:{focusable:{},renderer:{},selectable:{}}},selection:{type:"Array\x3cobject\x3e",writeback:!0},selectionMode:{type:"string",enumValues:["none","single","multiple"]}},
events:{animateEnd:{},animateStart:{},beforeCollapse:{},beforeCurrentItem:{},beforeExpand:{},collapse:{},expand:{}},methods:{getContextByNode:{}},extension:{Ya:"ojTreeView"}});a.J.register("oj-tree-view",{metadata:a.J.getMetadata("oj-tree-view")})});