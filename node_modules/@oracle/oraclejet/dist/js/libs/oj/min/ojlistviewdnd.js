/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojdnd","ojs/ojlistview"],function(a,g){a.Ia=function(a){this.Da=a};o_("ListViewDndContext",a.Ia,a);a.f.ya(a.Ia,a.f,"oj.ListViewDndContext");a.Ia.S9=67;a.Ia.tN=86;a.Ia.vN=88;a.Ia.kxa="cut";a.Ia.gxa="copy";a.Ia.pya="paste";a.Ia.gN="pasteBefore";a.Ia.fN="pasteAfter";a.Ia.prototype.reset=function(){this.D5();this.so=this.CL=this.HL=this.SU=null};a.Ia.prototype.m0=function(a){var b=this.Da.Ud("dnd");return null!=b&&b[a]?b[a].items:null};a.Ia.prototype.st=function(){return this.m0("drag")};
a.Ia.prototype.mI=function(){return this.m0("drop")};a.Ia.prototype.Zv=function(){return"enabled"==this.m0("reorder")};a.Ia.prototype.zh=function(a){return this.Da.Go(a)};a.Ia.prototype.lQ=function(){var a,b,d,e;a=[];if(this.Da.$c())for(b=this.Da.Ud("selection"),d=0;d<b.length;d++)e=this.Da.Le(b[d]),null==e||this.Da.Hi(g(e))||a.push(e);else e=this.bha(),null!=e&&a.push(e);null!=this.MA&&0<this.MA.length&&-1==a.indexOf(this.MA.get(0))&&a.push(this.MA.get(0));return a};a.Ia.prototype.bha=function(){return null==
this.Da.aa?null:this.Da.aa.elem[0]};a.Ia.prototype.IA=function(a){var b;g(a).hasClass(this.Da.wf())||(a=a.firstElementChild);a=g(a).find(".oj-listview-drag-handle");null!=a&&0<a.length&&(b=a.attr("aria-labelledby"),null==b?a.attr("aria-labelledby",this.Da.gt("instr")):a.attr("aria-labelledby",b+" "+this.Da.gt("instr")),this.Da.Yn()&&a.attr("draggable","true"))};a.Ia.prototype.D5=function(){this.pua&&g.each(this.pua,function(a,b){g(b).removeClass("oj-draggable")})};a.Ia.prototype.S0a=function(){var a=
[],b,d,e;this.D5();b=this.Da.Ud("selection");for(d=0;d<b.length;d++)e=this.Da.Le(b[d]),null==e||this.Da.Hi(g(e))||(a.push(e),g(e).addClass("oj-draggable"));this.pua=a};a.Ia.prototype.Koa=function(a){var b;b=a.find(".oj-listview-drag-handle");if(null!=b&&0<b.length)return!0;a.addClass("oj-draggable");return!1};a.Ia.prototype.$Ua=function(a){a.removeClass("oj-draggable")};a.Ia.prototype.Eoa=function(a){var b,d;if(null!=this.st()||this.Zv()){if(a.hasClass("oj-listview-drag-handle"))b=g(a);else{a=this.zh(a);
if(null!=a&&(d=this.Koa(a)))return;d=this.lQ();0<d.length&&(null!=a&&-1<d.indexOf(a[0])?b=a:g(d[0]).removeClass("oj-draggable"))}null!=b&&b.attr("draggable",!0)}};a.Ia.prototype.pqa=function(a){if(null!=this.st()||this.Zv())a=a.hasClass("oj-listview-drag-handle")?g(a):this.zh(a),null!=a&&a.removeAttr("draggable")};a.Ia.prototype.mp=function(c,b,d,e){var f;if(c="drag"===c?this.st():this.mI())if((b=c[b])&&"function"==typeof b)try{this.Da.ga.Y()?(b(d.originalEvent,e),d.originalEvent.defaultPrevented&&
d.preventDefault()):(d.dataTransfer=d.originalEvent.dataTransfer,f=b(d,e))}catch(g){a.D.error("Error: "+g)}else f=-1;else f=-1;return f};a.Ia.prototype.XSa=function(a,b,d){var e,f=[],g;for(e=0;e<d.length;e++)(g=this.Da.Bha(d[e]))&&(g.innerHTML&&g.tagName&&"LI"==g.tagName?f.push(g.innerHTML):f.push(g));return 0<f.length?(this.WSa(a.originalEvent,b,f),this.YSa(a.originalEvent,d),{items:f}):null};a.Ia.prototype.WSa=function(a,b,d){var e;a=a.dataTransfer;d=JSON.stringify(d);if("string"==typeof b)a.setData(b,
d);else if(b)for(e=0;e<b.length;e++)a.setData(b[e],d);a.setData("text/ojlistview-dragsource-id",this.Da.element.get(0).id)};a.Ia.prototype.YSa=function(a,b){var d,e,f=Number.MAX_VALUE,h,k,l,m=0,p=0;d=a.target;if(1<b.length){d=g(document.createElement("ul"));d.get(0).className=this.Da.element.get(0).className;d.addClass("oj-listview-drag-image").css({width:this.Da.element.css("width"),height:this.Da.element.css("height")});for(e=0;e<b.length;e++)f=Math.min(f,b[e].offsetTop);for(e=0;e<b.length;e++)h=
b[e].offsetTop-f,k=b[e].offsetWidth,l=g(b[e].cloneNode(!0)),l.removeClass("oj-selected oj-focus oj-hover").css({position:"absolute",top:h,width:k}),d.append(l)}else g(d).hasClass("oj-listview-drag-handle")?(h=0,g.contains(b[0],d.offsetParent)&&(h=d.offsetTop),m=Math.max(0,d.offsetLeft-b[0].offsetLeft)+d.offsetWidth/2,p=h+d.offsetHeight/2):(m=Math.max(0,a.offsetX),p=Math.max(0,a.offsetY)),l=g(b[0].cloneNode(!0)),l.removeClass("oj-selected oj-focus oj-hover").addClass("oj-drag"),d=g(document.createElement("ul")),
d.get(0).className=this.Da.element.get(0).className,d.addClass("oj-listview-drag-image").css({width:this.Da.element.css("width"),height:2*b[0].offsetHeight}).append(l);this.Da.Mh()&&d.addClass("oj-listview-card-layout");g("body").append(d);this.HL=d;a.dataTransfer.setDragImage(d.get(0),m,p)};a.Ia.prototype.GI=function(a){var b,d;b=this.st();if(null!=b||this.Zv())if(b=null!=b?b.dataTypes:"text/ojlistview-items-data",g(a.target).hasClass("oj-listview-drag-handle")?(d=[],d.push(this.zh(a.target)[0])):
d=this.lQ(),0<d.length)if(this.so=d,this.CL=g(d[0]),b=this.XSa(a,b,d)){if(a=this.mp("drag","dragStart",a,b),-1!==a)return a}else return!1};a.Ia.prototype.kLa=function(a){return this.mp("drag","drag",a)};a.Ia.prototype.jP=function(){null!=this.HL&&(this.HL.remove(),this.HL=null)};a.Ia.prototype.C1=function(a){var b;if(null!=this.CL&&null!=this.so)for(this.CL.find(".oj-listview-drag-handle").removeAttr("draggable"),this.CL.removeClass("oj-drag oj-draggable").removeAttr("draggable"),b=0;b<this.so.length;b++)g(this.so[b]).removeClass("oj-listview-drag-item").css("display",
"");this.vH();this.jP();this.D5();this.mp("drag","dragEnd",a);this.SU=this.so;this.so=this.CL=this.HL=null};a.Ia.prototype.Y2=function(a){var b,d;if((b=this.mI())&&b.dataTypes)for(b=b.dataTypes,b="string"==typeof b?[b]:b,a=a.originalEvent.dataTransfer.types,d=0;d<a.length;d++)if(0<=b.indexOf(a[d]))return!0;return!1};a.Ia.prototype.Vn=function(a,b,d){a=this.mp("drop",a,b,d);(void 0===a||-1===a)&&this.Y2(b)&&b.preventDefault();return a};a.Ia.prototype.jfa=function(a){var b;null==this.Vl&&(b=g(a.get(0).cloneNode(!1)),
b.addClass("oj-drop").removeClass("oj-drag oj-draggable oj-hover oj-focus oj-selected").css({display:"block",height:a.outerHeight()}),this.Vl=b);return this.Vl};a.Ia.prototype.Eea=function(){null!=this.Yj&&-1===this.hF&&this.Yj.children("."+this.Da.hg()).removeClass("oj-drop")};a.Ia.prototype.Dea=function(){null!=this.Yj&&this.Yj.hasClass("oj-listview-no-data-message")&&(this.Yj.removeClass("oj-drop"),this.Yj.get(0).textContent=this.Da.Hha())};a.Ia.prototype.vH=function(){null!=this.Vl&&(this.Vl.css("height",
"0"),this.Vl.remove(),this.Vl=null);this.Dea();this.Eea()};a.Ia.prototype.D1=function(a){var b;b=this.zh(a.target);a=this.Vn("dragEnter",a,{item:b.get(0)});if(-1!=a)return a};a.Ia.prototype.x4=function(a){null!=this.Yj&&this.Yj.removeClass("oj-valid-drop oj-invalid-drop");this.Yj=a;this.Yj.addClass("oj-valid-drop")};a.Ia.prototype.poa=function(a,b){var d;d=a.attr("aria-label");null==d&&(d=a.text());d=this.Da.ga.R("accessibleReorder"+b.charAt(0).toUpperCase()+b.substr(1)+"Item",{item:d});this.Da.ki(d)};
a.Ia.prototype.qDa=function(){null==this.Mua&&this.Da.Yn()&&(this.Da.element.find("ul."+this.Da.Jg()).each(function(){g(this).attr("oldMaxHeight",g(this).css("maxHeight").toString());g(this).css("maxHeight",1E4)}),this.Mua="adjusted")};a.Ia.prototype.$na=function(){this.Da.Yn()&&this.Da.element.find("ul."+this.Da.Jg()).each(function(){g(this).css("maxHeight",parseInt(g(this).attr("oldMaxHeight"),10));g(this).removeAttr("oldMaxHeight")});this.Mua=null};a.Ia.prototype.F1=function(a){var b,d,e,f;this.qDa();
if(null!=this.so&&"none"!=g(this.so[0]).css("display")){if(b=g(this.so[0]),e=this.Vn("dragOver",a,{item:b.get(0)}),-1===e&&this.Zv()||!1===e||a.isDefaultPrevented()){d=this.jfa(b);for(a=0;a<this.so.length;a++)g(this.so[a]).addClass("oj-listview-drag-item").css("display","none");d.insertBefore(b);this.hF=d.index()}}else b=this.zh(a.target),null!=b&&0<b.length?(e=this.Vn("dragOver",a,{item:b.get(0)}),-1===e&&this.Zv()||!1===e||a.isDefaultPrevented()?(b.hasClass(this.Da.wf())?(this.Eea(),b.hasClass("oj-drop")||
(d=this.jfa(b),f=b.index(),null==this.hF||this.hF<f?(d.insertAfter(b),this.gF="after"):(d.insertBefore(b),this.gF="before"),this.poa(b,this.gF),this.x4(b),this.hF=d.index())):(this.vH(),b.children("."+this.Da.hg()).addClass("oj-drop"),this.x4(b),this.hF=-1,this.gF="inside",this.poa(b,this.gF)),a.preventDefault()):g(a.target).hasClass(this.Da.Jg())||(b.addClass("oj-invalid-drop"),this.vH())):(b=this.Da.element.children(".oj-listview-no-data-message"),null!=b&&0<b.length&&(b.addClass("oj-drop"),b.get(0).textContent=
"",this.x4(b),a.preventDefault()));return e};a.Ia.prototype.YQ=function(a,b){var d,e;d=b.getBoundingClientRect();e=a.originalEvent;return e.clientX>=d.left&&e.clientX<d.right&&e.clientY>=d.top&&e.clientY<d.bottom};a.Ia.prototype.E1=function(a){var b,d;if(null!=this.Yj&&(b=this.zh(a.target),null!=b&&0<b.length?(b.removeClass("oj-valid-drop oj-invalid-drop"),d=this.Vn("dragLeave",a,{item:b.get(0)}),this.YQ(a,a.currentTarget)||(this.vH(),this.$na())):this.YQ(a,a.currentTarget)||this.Dea(),-1!=d))return d};
a.Ia.prototype.G1=function(a){var b,d;if(null!=this.Yj&&(b=a.originalEvent.dataTransfer.getData("text/ojlistview-dragsource-id"),d=this.Yj.hasClass("oj-listview-no-data-message")?{}:{item:this.Yj.get(0),position:this.gF},this.Zv()&&b===this.Da.element.get(0).id?d.reorder=!0:d.reorder=!1,null!=this.Yj&&this.Yj.removeClass("oj-valid-drop"),this.vH(),this.$na(),this.jP(),b=this.Vn("drop",a,d),d.reorder&&(d.items=null==this.SU?this.so:this.SU,d.reference=d.item,this.Da.tm("reorder",a,d),a.preventDefault()),
this.Yj=null,this.hF=-1,this.SU=this.gF=null,-1!==b))return b};a.Ia.prototype.M_a=function(a){var b=this,d,e;this.Zv()&&(d=g(a),this.g_a!=a&&(this.g_a=a,"OJ-MENU"===a.tagName?(a.addEventListener("ojBeforeOpen",this.sja.bind(this)),a.addEventListener("ojAction",this.Al.bind(this))):(d.on("ojbeforeopen",this.sja.bind(this)),d.on("ojselect",this.Al.bind(this)))),this.u8=e=this.sha(a,function(a,c){var d=b.ql(c,a.tagName);"OJ-OPTION"===a.tagName?(a.innerHTML=d.get(0).innerHTML,g(a).attr("data-oj-command",
d.attr("data-oj-command"))):(d.get(0).className=g(a).get(0).className,g(a).replaceWith(d))}),0<e.length&&d.data("oj-ojMenu")&&("OJ-MENU"===a.tagName?a.refresh():g(a).ojMenu("refresh")))};a.Ia.prototype.sha=function(c,b){var d;d=[];g(c).find("[data-oj-command]").each(function(){var c;0===g(this).children("a").length?0==g(this).attr("data-oj-command").indexOf("oj-listview-")&&(c=g(this).attr("data-oj-command").substring(12),b&&b(this,c)):(c=g(this).attr("data-oj-command"),c==a.Ia.gN?c="paste-before":
c==a.Ia.fN&&(c="paste-after"));c&&d.push(c)});return d};a.Ia.prototype.ql=function(c,b){return"paste-before"===c?this.wh(a.Ia.gN,b):"paste-after"===c?this.wh(a.Ia.fN,b):this.wh(c,b)};a.Ia.prototype.wh=function(a,b){var d=g(document.createElement(b));d.attr("data-oj-command",a);d.append(this.Hy(a));return d};a.Ia.prototype.Hy=function(a){a="label"+a.charAt(0).toUpperCase()+a.slice(1);return g('\x3ca href\x3d"#"\x3e\x3c/a\x3e').text(this.Da.ga.R(a))};a.Ia.prototype.FI=function(a){var b;null!=this.Up&&
g(this.Up).removeClass("oj-listview-cut");b=this.lQ();g(b).addClass("oj-listview-cut");this.Up=b;this.Da.tm("cut",a,{items:b})};a.Ia.prototype.tja=function(a){var b;null!=this.Up&&g(this.Up).removeClass("oj-listview-cut");this.Up=b=this.lQ();this.Da.tm("copy",a,{items:b})};a.Ia.prototype.II=function(a,b,d){this.Da.tm("paste",a,{item:b.get(0)});g(this.Up).removeClass("oj-listview-cut");this.Da.tm("reorder",a,{items:this.Up,position:d,reference:b.get(0)});this.Up=null};a.Ia.prototype.Al=function(c,
b){var d;if(null!=this.MA)switch(d=b?b.item:g(c.target),d.attr("data-oj-command")){case a.Ia.kxa:this.FI(c);break;case a.Ia.gxa:this.tja(c);break;case a.Ia.pya:var e=!0;case a.Ia.gN:var f=!0;case a.Ia.fN:d="after",e?d="inside":f&&(d="before"),this.II(c,this.MA,d),this.MA=null}};a.Ia.prototype.cH=function(c,b){null!=this.u8&&("paste-before"==b?b=a.Ia.gN:"paste-after"==b&&(b=a.Ia.fN),c.find("[data-oj-command\x3d'"+b+"']").removeClass("oj-disabled"))};a.Ia.prototype.sja=function(a,b){var d,e;d=g(a.target);
d.find("[data-oj-command]").addClass("oj-disabled");e=b?b.openOptions.launcher:a.detail.openOptions.launcher;null==e||null==this.u8||0==this.u8.length?"OJ-MENU"!=d.get(0).tagName&&d.ojMenu("refresh"):(e.children().first().hasClass(this.Da.hg())?null!=this.Up&&this.cH(d,"paste"):(this.cH(d,"cut"),this.cH(d,"copy"),null!=this.Up&&(this.cH(d,"paste-before"),this.cH(d,"paste-after"))),"OJ-MENU"!=d.get(0).tagName&&d.ojMenu("refresh"),this.MA=e)};a.Ia.prototype.RM=function(c){var b,d,e;if(c.ctrlKey||c.metaKey)if(b=
c.keyCode,b===a.Ia.vN||b===a.Ia.S9||a.Ia.tN){if(!this.Zv())return!1;d=this.Da.ga.wq();if(null==d)return!1;d=this.sha(d);if(0==d.length)return!1;if(b===a.Ia.vN&&-1<d.indexOf("cut"))return this.FI(c),!0;if(b===a.Ia.S9&&-1<d.indexOf("copy"))return this.tja(c),!0;if(b===a.Ia.tN&&null!=this.Up&&(b=g(this.bha()),b.children().first().hasClass(this.Da.hg())?-1<d.indexOf("paste")&&(e="inside"):-1<d.indexOf("paste-before")?e="before":-1<d.indexOf("paste-after")&&(e="after"),null!=e))return this.II(c,b,e),!0}return!1}});