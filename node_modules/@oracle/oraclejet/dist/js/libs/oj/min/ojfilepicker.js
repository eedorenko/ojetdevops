/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","knockout","ojs/ojcomponentcore","ojs/ojcomposite"],function(a,g,c){a.gf.register("oj-file-picker",{view:{inline:"\x3cinput type\x3d'file' style\x3d'display:none'       data-bind\x3d\"attr:{multiple: $props.selectionMode \x3d\x3d 'multiple',                         accept: acceptStr}\"\x3e\x3c/input\x3e\x3cdiv class\x3d'oj-filepicker-clickable'\x3e  \x3coj-slot name\x3d'trigger'\x3e    \x3cdiv tabindex\x3d'0'         class\x3d'oj-filepicker-dropzone'\x3e      \x3cp class\x3d'oj-filepicker-text' data-bind\x3d'text: defDropzoneText'\x3e\x3c/p\x3e    \x3c/div\x3e  \x3c/oj-slot\x3e\x3c/div\x3e"},
viewModel:{inline:function(b){function d(a){var b=v[0],c=g(s).find(".oj-filepicker-clickable")[0];b&&(b.removeEventListener("dragenter",p,!1),b.removeEventListener("dragover",t,!1),b.removeEventListener("dragleave",r,!1),b.removeEventListener("dragend",r,!1),b.removeEventListener("drop",n,!1));c&&(c.removeEventListener("click",e,!1),c.removeEventListener("keypress",e,!1));switch(a){case "click":k(c);break;case "drop":l(b);c&&c.addEventListener("keypress",e,!1);break;default:k(c),l(b)}}function e(){x=
!0;w.click();return!0}function f(a){a.preventDefault();a.stopPropagation();var b=a.target.files;0<b.length&&q(b,a);x=!1}function h(b){var c=u.accept;if(!c||0==c.length||!b)return!0;for(var d,e=0;e<c.length;e++){d=a.Xa.trim(c[e]);if(!d)return!0;if(d.pn(".",0)){if(!b.name||b.name&&b.name.Nra(d))return!0}else if(!b.type)break;else if("image/*"==d){if(b.type.pn("image/",0))return!0}else if("video/*"==d){if(b.type.pn("video/",0))return!0}else if("audio/*"==d){if(b.type.pn("audio/",0))return!0}else if(b.type==
d)return!0}return!1}function k(a){a&&(a.addEventListener("click",e,!1),a.addEventListener("keypress",e,!1))}function l(a){a&&(a.addEventListener("dragenter",p,!1),a.addEventListener("dragover",t,!1),a.addEventListener("dragleave",r,!1),a.addEventListener("dragend",r,!1),a.addEventListener("drop",n,!1))}function m(a){var b="single"!=s.selectionMode||1==a.length;if(b)a:{if(a)for(b=0;b<a.length;b++)if(!h(a[b])){a=!1;break a}a=!0}else a=b;return a}function p(a){a.preventDefault();a.stopPropagation()}
function t(a){a.preventDefault();a.stopPropagation();a=a.dataTransfer;var b=!a.items||m(a.items);b?(a.dropEffect="copy",v.addClass("oj-valid-drop")):a.dropEffect="none";return b}function r(a){a.preventDefault();a.stopPropagation();v.removeClass("oj-valid-drop")}function n(b){var c=b.dataTransfer.files;if(m(c))q(c,b);else{var d="";if(c)for(var e=0;e<c.length;e++)d+=c[e].name+" ";a.D.warn("oj-file-picker: Files "+d+" are not acceptable.")}r(b)}function q(a,b){var c=new CustomEvent("select",{detail:{files:a,
originalEvent:b}});s.dispatchEvent(c)}var s=b.element,u,v,w,x=!1;b.props.then(function(a){u=a});this.acceptStr=c.pureComputed(function(){var a=u.accept;return a&&a.length?a.join(","):null},this);s.addEventListener("selectOnChanged",function(a){d(a.detail.value)});this.defDropzoneText=a.va.R("oj-ojFilePicker.dropzoneText");this.bindingsApplied=function(){var b=g(s);b.addClass("oj-filepicker");v=b.find(".oj-filepicker-dropzone");d(u.selectOn);b=b.find("input");b.length&&(w=b[0],w.addEventListener("change",
f,!1));v.length&&(v[0].addEventListener("focus",function(){x||(a.T.Iva()?v.removeClass("oj-focus-highlight"):v.addClass("oj-focus-highlight"))}),v[0].addEventListener("focusout",function(){x||v.removeClass("oj-focus-highlight")}))}}},metadata:{inline:{properties:{accept:{type:"Array"},selectOn:{type:"string",enumValues:["auto","click","drop","clickAndDrop"],value:"auto"},selectionMode:{type:"string",enumValues:["multiple","single"],value:"multiple"}},events:{select:{}}}}})});