/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojarraytabledatasource","ojs/ojcolor","ojs/ojlistview","ojs/ojeditablevalue"],function(a,g){(function(){a.ib("oj.ojColorPalette",g.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{labelledBy:null,palette:null,swatchSize:"lg",labelDisplay:"off",layout:"grid",value:null},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var b=a.subId,d=a.index;a=this._super(a);if(!a)switch(b){case "oj-palette-entry":b=
this.ce.find(".oj-listview-item"),b.length&&d<b.length&&(a=b[d])}return a},getSubIdByNode:function(a){var b=g(a),d=null,e=-1,f=null,h;b.is("li")&&b.hasClass("oj-listview-item-element")&&(d="oj-palette-entry",h=b.attr("id"),b=this.ce.find(".oj-listview-item"),g.each(b,function(a,b){if(g(b).attr("id")===h)return e=a,!1}));d&&(f={subId:d},0<=e&&(f.index=e));null==f&&(f=this._super(a));return f},add:function(c){var b=null,d;c instanceof a.o?b={color:c}:"object"===typeof c&&(d=c.color,d instanceof a.o&&
(b=c));b&&(this.uS("The swatch add is being animated in the palette (id\x3d"+this.element.attr("id")+")."),b.id=this.tia(),this.Sm||(this.Sm=[]),this.Sm.push({ng:"a",fV:b}),this.zD.add(b),this.T5())},remove:function(c){var b=null,d;d=typeof c;"number"===d?0<=c&&c<this.Fj.length?b=this.Fj[c].id:a.D.error("JET Color Palette (id\x3d'"+this.element.attr("id")+"'): Invalid index for remove ("+c+")"):"object"===d&&(c=c instanceof a.o?c:c.color,b=this.fIa(c));b&&(c={id:b},this.uS("The removed swatch is being animated in the palette (id\x3d"+
this.element.attr("id")+")."),this.Sm||(this.Sm=[]),this.Sm.push({ng:"r",fV:c}),this.zD.remove(c),this.T5())},whenReady:function(){var a=this;return new Promise(function(b){a.ce.ojListView("whenReady").then(function(){b(!0)})})},_destroy:function(){this.i4();this.ce&&(this.Sm=[],this.ce.ojListView("destroy"));this.zD=null;this.saa.remove();this.qh.removeClass("oj-colorpalette");this.My();this._super()},qc:function(){this._super();this.wNa()},Df:function(){var c;this._super();this.Mj(null,this.options.labelledBy,
this.ce);this.Y()||(c=this.ky());c?(c=c.attr("id"))?this.ce.attr("aria-labelledby",c):a.D.warn("JET Color Palette: The label for this component needs an id in order to be accessible"):(c=this.element.attr("aria-label"))&&this.ce.attr("aria-label",c)},_setOption:function(a,b,d){var e=this.options.labelledBy;switch(a){case "value":this.C4(b);break;case "palette":this.xTa(b);break;case "swatchSize":this.yTa(b);break;case "layout":this.wTa(b);break;case "labelDisplay":this.vTa(b);break;case "disabled":this.hK(b,
!0);break;case "labelledBy":this.Mj(e,b,this.ce)}this._super(a,b,d)},Mj:a.ia.Mj,RPa:function(a,b){"selection"===b.option&&this.KSa(a,b)},T5:function(){if(!this.EX){var c=this;this.EX=a.Context.getContext(this.ce[0]).md();this.EX.whenReady().then(function(){c.EX=null;var a,d,e,f,g;c.i4();if(c.Sm){e=!1;for(g=0;g<c.Sm.length;g++)if(a=c.Sm[g],d=a.fV,"a"===a.ng||"r"===a.ng)e=!0,f||(f=c.Fj.slice(0)),"a"===a.ng?f.push(d):"r"===a.ng&&(d=c.eIa(f,d.id),f.splice(d,1),a.index=d);if(e)for(c.Wy("palette",f,null);c.Sm.length;)a=
c.Sm.shift(),d=a.fV,"a"===a.ng?c.Fj.push(d):"r"===a.ng&&c.Fj.splice(a.index,1)}},function(){a.D.error("JET Color Palette (id\x3d'"+c.element.attr("id")+"'): ListView timed out.");c.Sm=[]})}},VO:function(c,b){var d=b instanceof a.o,e=!1;c instanceof a.o&&d&&(e=c.isEqual(b));return e},Wy:function(a,b,d){"palette"===a&&this.option(a,b,{_context:{originalEvent:d,ob:!0},changed:!0})},P_:function(a){var b=-1,d=this.Fj,e=d.length,f,g;for(f=0;f<e;f++)if(g=d[f],a.isEqual(g.color)){b=f;break}return b},fIa:function(a){var b=
null,d=this.Fj,e=d.length,f,g;for(f=0;f<e;f++)if(g=d[f],a.isEqual(g.color)){b=g.id;break}return b},eIa:function(a,b){var d=-1,e=a.length,f,g;for(f=0;f<e;f++)if(g=a[f],g.id===b){d=f;break}return d},uS:function(c){this.gS||(this.gS=a.Context.getContext(this.element[0]).md().ad({description:c}))},i4:function(){this.gS&&(this.gS(),this.gS=null)},dSa:function(c){var b,d,e,f,g,k;b=c.data.color;b instanceof a.o||(b=a.o.BLACK,a.D.warn("JET Color Palette (id\x3d'"+this.element.attr("id")+"'): Substituting oj.Color.BLACK for an object that is not an instance of oj.Color"));
d=e=c.data.label;f="auto"===this.mR&&"list"===this.dg&&"sm"===this.aE||"auto"===this.mR&&"grid"===this.dg&&"lg"===this.aE;null!=b&&(k=d?d:this.UZ.format(b),f?(d=k?k:this.UZ.format(b),d=e?d:d.toUpperCase()):d=null,g=!!(this.yOa(b)||d&&"none"===d.toLowerCase()));e="";this.Qm===c.data.id&&(e="oj-selected",this.Qm=-1,this.r4=c.parentElement);c="list"===this.dg?"oj-colorpalette-swatchsize-"+this.aE+(g?" oj-colorpalette-swatch-none":""):this.Kpa+(g?" oj-colorpalette-swatch-none":"");return g?this.$Ra(f,
d,k,c,e):this.bSa(b,f,d,k,c,e)},bSa:function(a,b,d,e,f,h){a="\x3cdiv class\x3d'oj-colorpalette-swatch-entry "+f+(b?" oj-colorpalette-swatch-showlabel":"")+"'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-container'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch "+h+"' style\x3d'background-color:"+a.toString()+"'"+(d?"":" title\x3d'"+e+"'")+"\x3e\x3c/div\x3e\x3c/div\x3e";d&&(a+="\x3cspan class\x3d'oj-colorpalette-swatch-text'\x3e"+d+"\x3c/span\x3e");return g(a+"\x3c/div\x3e")[0]},$Ra:function(a,b,d,e,f){a=
"\x3cdiv class\x3d'oj-colorpalette-swatch-entry "+e+(a?" oj-colorpalette-swatch-showlabel":"")+"'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-container'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch "+f+"'"+(b?"":" title\x3d'"+d+"'")+"\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-none-icon'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";b&&(a+="\x3cspan class\x3d'oj-colorpalette-swatch-text'\x3e"+b+"\x3c/span\x3e");return g(a+"\x3c/div\x3e")[0]},KSa:function(a,b){var d=null,e,f;e=g(b.items[0]).find(".oj-colorpalette-swatch");
e.addClass("oj-selected");f=this.MSa;this.MSa=e;!f&&this.r4&&(f=g(this.r4).find(".oj-colorpalette-swatch"),this.r4=null);f&&f.removeClass("oj-selected");if(1===b.value.length){for(e=0;e<this.Fj.length;e++)if(this.Fj[e].id===b.value[0]){d=this.Fj[e].color;break}this.jc(d,a);this.Pf=d}},hK:function(a,b){var d,e;if(!b||b&&a!==this.Vq)this.ce&&this.ce.ojListView("option","disabled",a),d=g(".oj-colorpalette-container .oj-colorpalette-swatch"),e=this,a?(this.OH=[],g.each(d,function(a,b){e.OH.push(b.style.backgroundColor);
b.style.backgroundColor="#eee"})):(this.OH&&this.OH.length&&g.each(d,function(a,b){b.style.backgroundColor=e.OH[a]}),this.OH=null),this.Vq=a},C4:function(c){var b=-1,d=[];0<this.Fj.length&&c instanceof a.o&&!this.VO(this.Pf,c)&&(b=this.P_(c),0<=b&&d.push(b),this.ce.ojListView("option","selection",d),this.Pf=c);return 0<=b},xTa:function(a){g.isArray(a)&&!this.qOa(a,this.Fj)&&(this.uS("The palette (id\x3d"+this.element.attr("id")+") option change in progress."),this.Sm=[],this.Fj=a.slice(0),this.Qm=
this.P_(this.Pf),this.Boa(a,this.Qm,!0),this.T5())},yTa:function(a){"string"===typeof a&&a!==this.aE&&(this.aE=a,this.Kpa="oj-colorpalette-swatchsize-"+("lg"===a?"lg":"sm"===a?"sm":"xs"),this.ce.ojListView("refresh"))},vTa:function(a){"string"!==typeof a||a===this.mR||"auto"!==a&&"off"!==a||(this.mR=a,this.ce.ojListView("refresh"))},wTa:function(a){"string"===typeof a&&a!==this.dg&&(this.dg=a,this.USa(),this.ce.ojListView("refresh"))},USa:function(){var a="grid"===this.dg,b=a?"oj-colorpalette-grid":
"oj-colorpalette-list";this.ce.removeClass("oj-colorpalette-grid oj-colorpalette-list oj-listview-card-layout");this.ce.addClass(b);a&&this.ce.addClass("oj-listview-card-layout")},Boa:function(c,b,d){this.YCa(c);this.zD=new a.hb(c,{idAttribute:"id"});0<=b&&(this.Fj[b].id&&(b=this.Fj[b].id),0===this.CR.length?this.CR.push(b):this.CR[0]=b);d&&this.ce.ojListView("option","data",this.zD)},wNa:function(){this.uS("Palette (id\x3d"+this.element.attr("id")+") is initializing.");this.SI();this.sb()},sb:function(){this.qh.append(this.mJ);
this.qh.addClass("oj-colorpalette");this.saa=this.qh.find(".oj-colorpalette-container");this.ce=this.saa.find(":first");this.ce.attr("data-oj-context","");this.Pf&&this.Pf instanceof a.o&&(this.Qm=this.P_(this.Pf));this.Lpa=0;this.Boa(this.Fj,this.Qm,!1);this.ce.ojListView({data:this.zD,item:{renderer:this.dSa.bind(this)},optionChange:this.RPa.bind(this),selectionMode:"single",selection:this.CR,rootAttributes:{style:"height:100%;width:100%"}}).attr("data-oj-internal","");var c=this;a.Context.getContext(this.ce[0]).md().whenReady().then(function(){c.ce.ojListView("option",
"translations.msgNoData","");c.hK(c.Vq);if(c.ce[0].scrollWidth>c.ce[0].clientWidth){var a=c.hKa(),d="rtl"===c.Qc();c.ce.css(d?"padding-left":"padding-right",a+1)}c.i4()})},SI:function(){this.VY();this.ffa=a.Ma.Kk(a.Rh.CONVERTER_TYPE_COLOR);this.UZ=this.ffa.createConverter({format:"hex"});this.R("labelNone");this.mJ=["\x3cdiv class\x3d'oj-colorpalette-container'\x3e","\x3cul class\x3d'"+("grid"===this.dg?"oj-colorpalette-grid oj-listview-card-layout":"oj-colorpalette-list")+"'/\x3e","\x3c/div\x3e"].join("")},
VY:function(){var c=this.options,b;this.qh=g(this.element);this.Vq=!1;this.CR=[];this.zD=null;b=c.swatchSize;"string"===typeof b&&(b=b.toLowerCase(),"lg"!==b&&"sm"!==b&&"xs"!==b&&(b="lg"));this.aE=b;this.Kpa="oj-colorpalette-swatchsize-"+b;b=c.labelDisplay;"string"===typeof b&&(b=b.toLowerCase(),"auto"!==b&&"off"!==b&&(b="auto"));this.mR=b;b=c.layout;"string"===typeof b&&(b=b.toLowerCase(),"grid"!==b&&"list"!==b&&(b="grid"),"grid"!==b&&"xs"===this.aE&&(b="grid"));this.dg=b;b=c.value;b instanceof a.o||
(b=null);this.Pf=b?b:a.o.BLACK;b=c.palette;g.isArray(b)||(b=[]);this.Fj=b.slice(0);b=c.disabled;"boolean"===typeof b&&(this.Vq=b)},yOa:function(a){var b=a.OE(),d=a.GE(),e=a.DE();a=a.CE();return 0===b&&0===d&&0===e&&0===a},qOa:function(a,b){var d=a.length,e=b.length,f,g;f=!1;if(d===e){for(e=0;e<d&&(f=a[e],g=b[e],!this.VO(f.color,g.color)||(f=f.label,g=g.label,f===g));e++);f=e>=d}return f},YCa:function(a){var b,d,e=a.length;for(b=0;b<e;b++)d=a[b],d.id=this.tia()},tia:function(){var a=this.Lpa.toString();
this.Lpa++;return a},My:function(){this.ffa=this.UZ=this.mJ=this.ce=null},hKa:function(){var a=g("\x3cdiv style\x3d'overflow: scroll; width: 100px; height: 100px; position: absolute; visibility: hidden;'\x3e\x3cdiv style\x3d'width: 100%; height: 100%;'\x3e\x3c/div\x3e\x3c/div\x3e");this.element.append(a);var b=a[0].offsetWidth,d=a.children()[0].offsetWidth;a.remove();return b-d},_GetMessagingLauncherElement:function(){return this.element},ve:function(){return this.ce},Zu:function(){return this.Pf},
xk:function(c){this.Pf="string"===typeof c?new a.o(c):c},Ki:function(){return this.Pf.toString()},_GetDefaultStyleClass:function(){return"oj-colorpalette"}})})();a.J.$a("oj-color-palette","editableValue",{properties:{labelDisplay:{type:"string",enumValues:["auto","off"]},labelledBy:{type:"string"},layout:{type:"string",enumValues:["grid","list"]},palette:{type:"Array"},swatchSize:{type:"string",enumValues:["lg","sm","xs"]},value:{writeback:!0}},extension:{Ya:"ojColorPalette"}});a.J.register("oj-color-palette",
{metadata:a.J.getMetadata("oj-color-palette")})});