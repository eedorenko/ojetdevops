/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojindexer","ojs/ojdatasource-common"],function(a){a.Ei=function(a,c,b,d){this.data=a;this.Pta=c;this.d_a=b;this.options=d;this.Init()};o_("IndexerModelTreeDataSource",a.Ei,a);a.f.ya(a.Ei,a.Vu,"oj.IndexerModelTreeDataSource");a.Ei.prototype.Init=function(){var g,c,b,d,e,f,h,k,l,m,p,t,r,n;a.Ei.O.Init.call(this);g=this.options.sections;null==g&&(c=a.va.R("oj-ojIndexer.indexerCharacters"),g=c.split("|"));g.push(a.oq.SECTION_OTHERS);b=this.options.groupingStrategy;null==
b&&(d=this.options.groupingAttribute,b=function(b){e=b[d]?b[d]:b;f=e.toString().toUpperCase()[0];return-1<g.indexOf(f)?f:a.oq.SECTION_OTHERS});h=this.options.sortComparatorFunction;this.data=this.data.sort(function(a,c){k=b(a);l=b(c);m=g.indexOf(k);p=g.indexOf(l);t=m-p;return 0==t&&h?h(a,c):t});for(c=0;c<this.data.length;c++)n=b(this.data[c]),r!=n&&(r=n,this.s4(n,c));this.fq=g};a.f.j("IndexerModelTreeDataSource.prototype.Init",{Init:a.Ei.prototype.Init});a.Ei.prototype.s4=function(a,c){null==this.Vk&&
(this.Vk=[]);this.Vk.push({key:a,value:c})};a.Ei.prototype.Dv=function(a){var c;for(c=0;c<this.Vk.length;c++)if(this.Vk[c].key==a)return this.Vk[c].value;return null};a.Ei.prototype.getIndexableSections=function(){return this.fq.slice(0,this.fq.length-1)};a.f.j("IndexerModelTreeDataSource.prototype.getIndexableSections",{getIndexableSections:a.Ei.prototype.getIndexableSections});a.Ei.prototype.getMissingSections=function(){var a,c,b;if(null==this.Xua){a=[];for(c=0;c<this.fq.length-1;c++)b=this.fq[c],
null==this.Dv(b)&&a.push(b);this.Xua=a}return this.Xua};a.f.j("IndexerModelTreeDataSource.prototype.getMissingSections",{getMissingSections:a.Ei.prototype.getMissingSections});a.Ei.prototype.setSection=function(a){return this.d_a.call(this,a)};a.f.j("IndexerModelTreeDataSource.prototype.setSection",{setSection:a.Ei.prototype.setSection});a.Ei.prototype.getChildCount=function(g){var c,b;if(null==g)return c=this.fq.length-this.getMissingSections().length,null!=this.Dv(a.oq.SECTION_OTHERS)?c:c-1;c=this.Dv(g);
if(null!=c){g=this.fq.indexOf(g);if(g==this.fq.length-1)return this.data.length-c;g++;b=this.fq[g];for(b=this.Dv(b);null==b&&g<this.fq.length;)g++,b=this.fq[g],b=this.Dv(b);if(isNaN(b)||null==b)b=this.data.length;return b-c}return 0};a.f.j("IndexerModelTreeDataSource.prototype.getChildCount",{getChildCount:a.Ei.prototype.getChildCount});a.Ei.prototype.fetchChildren=function(a,c,b){var d,e=this;null==a?(d=this.fq.filter(function(a){return null!=e.Dv(a)}),c={getParent:function(){return a},getStart:function(){return 0},
getCount:function(){return d.length},getData:function(a){return d[a]},getMetadata:function(a){return{key:d[a],leaf:!1,depth:0}}}):c={getParent:function(){return a},getStart:function(){return 0},getCount:function(){return e.getChildCount(a)},getData:function(b){return e.data[e.Dv(a)+b]},getMetadata:function(b){b=e.data[e.Dv(a)+b];return{key:null!=e.Pta?b[e.Pta]:b,leaf:!0,depth:1}}};null!=b&&null!=b.success&&b.success.call(null,c)};a.f.j("IndexerModelTreeDataSource.prototype.fetchChildren",{fetchChildren:a.Ei.prototype.fetchChildren})});