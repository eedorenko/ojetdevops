/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojcolor","ojs/ojslider","jqueryui-amd/widgets/draggable","ojs/ojtouchproxy","ojs/ojeditablevalue"],function(a,g){(function(){function c(a){var c;c=a.OE();var e=a.GE(),f=a.DE();c/=255;var e=e/255,f=f/255,g=Math.max(c,e,f),k=Math.min(c,e,f),l,m=(g+k)/2;if(g==k)l=k=0;else{var p=g-k,k=.5<m?p/(2-g-k):p/(g+k);switch(g){case c:l=(e-f)/p+(e<f?6:0);break;case e:l=(f-c)/p+2;break;case f:l=(c-e)/p+4}l/=6}c=[l,k,m];c[0]*=360;c[1]*=100;c[2]*=100;c.push(a.CE());
return c}a.ib("oj.ojColorSpectrum",g.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{labelledBy:null,value:null,rawValue:null},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var c=a.subId;a=this._super(a);if(!a)switch(c){case "oj-spectrum":a=this.yn[0];break;case "oj-spectrum-thumb":a=this.Qe[0];break;case "oj-hue-slider-bar":a=this.wm.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-hue-slider-bar-value":a=this.wm.ojSlider("getNodeBySubId",
{subId:"oj-slider-bar-value"});break;case "oj-hue-slider-thumb":a=this.wm.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"});break;case "oj-opacity-slider-bar":a=this.vm.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-opacity-slider-bar-value":a=this.vm.ojSlider("getNodeBySubId",{subId:"oj-slider-bar-value"});break;case "oj-opacity-slider-thumb":a=this.vm.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"})}return a},getSubIdByNode:function(a){if(!a)return null;var c=g(a),
e=null,f;c.hasClass("oj-colorspectrum-spectrum")?e="oj-spectrum":c.hasClass("oj-colorspectrum-thumb")?e="oj-spectrum-thumb":(f=c.closest(".oj-slider"),f=f.hasClass("oj-slider-vertical")?"hue":"opacity",c.hasClass("oj-slider-bar")?e="oj-"+f+"-slider-bar":c.hasClass("oj-slider-bar-value")?e="oj-"+f+"-slider-bar-value":c.hasClass("oj-slider-thumb")&&(e="oj-"+f+"-slider-thumb"));return null!=e?{subId:e}:this._super(a)},_destroy:function(){this.qh&&(this.QEa(),this.NGa(),this.ERa(),this.qh.removeClass("oj-colorspectrum"),
this.My());this._super()},qc:function(){this._super();this.pNa()},Df:function(){var b;this._super();this.Mj(null,this.options.labelledBy,this.Qe);this.Y()||(b=this.ky());b?(b=b.attr("id"))?this.Qe.attr("aria-labelledby",b):a.D.warn("JET Color Spectrum: The label for this component needs an id in order to be accessible"):(b=this.element.attr("aria-label"))&&this.Qe.attr("aria-label",b)},_setOption:function(a,c,e){var f=this.options.labelledBy;switch(a){case "value":this.C4(c);break;case "disabled":this.hK(c,
!0);break;case "labelledBy":this.Mj(f,c,this.Qe)}this._super(a,c,e)},Gm:function(b,c){if("string"===typeof b)try{b=new a.o(b)}catch(e){a.D("ojColorSpectrum (id\x3d'"+this.element.attr("id")+"'): invalid rawValue ("+b+"), defaulting to black"),b=a.o.BLACK}var f={};f._context={originalEvent:c,gd:!0,ob:!0,readOnly:!0};this.oFa(this.options.rawValue,b)||this.option("rawValue",b,f)},Mj:a.ia.Mj,oFa:function(a,c){return a.OE()===c.OE()&&a.GE()===c.GE()&&a.DE()===c.DE()&&a.CE()===c.CE()},VO:function(b,c){var e=
c instanceof a.o;return b instanceof a.o&&e&&b.isEqual(c)},hK:function(a,c){var e=!c||c&&a!==this.Vq;e&&(this.FHa(!a),a?(this.element.addClass("oj-disabled"),this.Rla(!1)):(this.element.removeClass("oj-disabled"),this.Rla(!0)),this.Vq=a);return e},C4:function(b){b instanceof a.o&&!this.VO(this.Pf,b)&&(this.xoa(b),this.$oa(this.jr,!0),this.$oa(this.Xo,!1),this.G4(this.jr,this.ND,this.tD,this.Xo,!0))},sma:function(b,c){var e,f,h,k,l;if(this.xpa&&("rawValue"==c.option||"value"==c.option)&&void 0!==c.value&&
("value"==c.option&&(this.lla=!!b.originalEvent),f=g(b.target),e=f.hasClass("oj-colorspectrum-hue"),f=f.hasClass("oj-colorspectrum-alpha"),e||f)){f=this.jr;h=this.ND;k=this.tD;l=this.Xo;e?(f=c.value,this.OS(f,h,k),this.G4(f,h,k,l,!1)):(l=c.value,this.aK(f,h,k,l));e=new a.o({h:f,s:h,l:k,a:l});if(b.originalEvent||this.lla)this.lla=!1,"rawValue"===c.option?this.Gm(e,b):"value"===c.option&&this.jc(e,b);this.xoa(e)}},$oa:function(a,c){(c?this.wm:this.vm).ojSlider("option","value",a)},G4:function(a,c,e,
f,g){this.yn.css("background-color","hsl("+a+", 100%, 50%)");g&&(g=this.fKa(c,e),this.QD(g.x,g.y));this.aK(a,c,e,f)},ITa:function(){var b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)";switch(a.Wa.fo().browser){case a.Wa.hk.KM:b="moz";break;default:b="webkit";break;case a.Wa.hk.VF:b="ms"}b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)".replace(/___/g,
b);this.yn.css("backgroundImage",b)},QD:function(a,c){isNaN(a)||(this.Ew=a);isNaN(c)||(this.Fw=c);this.bma(0,0)},fKa:function(a,c){var e=Math.min(a/100*this.Pt,this.Pt),f=this.Ap-Math.min(c/100*this.Ap,this.Ap);return{x:Math.round(e),y:Math.round(f)}},bma:function(a,c){var e,f;e=this.Ew+a;f=this.Fw+c;0>e&&(e=0);0>f&&(f=0);e>=this.Pt&&(e=this.Pt-1);f>=this.Ap&&(f=this.Ap-1);this.Ew=e;this.Fw=f;e=e-this.Hl+"px";f=f-this.Hl+"px";this.Qe[0].style.left=e;this.Qe[0].style.top=f},kUa:function(b){if(!this.Vq){var c=
this.yn.offset(),e=b.pageX-c.left,c=b.pageY-c.top,f,g,k,e=Math.round(e),c=Math.round(c);f=this.W0(e,c);g=f.uV;k=f.X7;f=this.jr;this.OS(f,g,k);var l=new a.o({h:f,s:g,l:k,a:this.Xo});this.Gm(l,b);this.jc(l,b);this.aK(f,g,k,this.Xo);this.Pf=l;this.Zoa(g,k);this.QD(e,c);this.Qe.focus()}},FOa:function(a){var c,e,f,g=1;this.Dla=(new Date).getTime();0>this.bw&&(this.bw=this.Dla,this.Cla=0);c=this.Dla-this.bw;this.Cla++;if(1400<c||25<this.Cla)g=3;e=f=0;c=a.keyCode;if(40==c)f=g;else if(38==c)f=-g;else if(39==
c)e=g;else if(37==c)e=-g;else if(36==c)this.QD(0,0),this.bw=-1;else if(35==c)this.QD(this.Pt-1,this.Ap-1),this.bw=-1;else if(33==c)this.QD(NaN,0),this.bw=-1;else if(34==c)this.QD(NaN,this.Ap-1),this.bw=-1;else return;this.bma(e,f);this.Rja(a,this.Ew,this.Fw);a.preventDefault();return!1},HOa:function(a){this.bw=-1;var c=this.W0(this.Ew,this.Fw);this.aK(this.jr,c.uV,c.X7,this.Xo);this.jc(this.options.rawValue,a)},zNa:function(){this.yn[0].getBoundingClientRect();this.j5||(this.j5=this.CUa.bind(this));
this.Qe.draggable({drag:this.j5,stop:this.j5})},Rla:function(a){this.Qe.draggable(a?"enable":"disable")},CUa:function(a,c){var e,f,g,k;c.position.left<-this.Hl?(c.position.left=-this.Hl,e=0):c.position.left+this.Hl>=this.Pt&&(c.position.left=this.Pt-1-this.Hl,f=this.Pt-1);c.position.top<-this.Hl?(c.position.top=-this.Hl,f=0):c.position.top+this.Hl>=this.Ap&&(c.position.top=this.Ap-1-this.Hl,f=this.Ap-1);g=this.Qe.offset();k=this.yn.offset();0!=e&&(e=g.left+this.Hl-k.left);0!=f&&(f=g.top+this.Hl-k.top);
if(this.Ew!==e||this.Fw!==f)"drag"===a.type?(this.Ew=e,this.Fw=f):(e=this.Ew,f=this.Fw),this.Rja(a,e,f)},Rja:function(b,c,e){var f,g,k=!1;f=this.jr;e=this.W0(c,e);c=e.uV;e=e.X7;this.OS(f,c,e);g=new a.o({h:f,s:c,l:e,a:this.Xo});this.Gm(g,b);"dragstop"===b.type&&(this.jc(g,b.originalEvent),k=!0);this.Pf=g;this.Zoa(c,e);k&&this.aK(f,c,e,this.Xo)},W0:function(a,c){return{uV:a/(this.Pt-1)*100,X7:100-c/(this.Ap-1)*100}},OS:function(a,c,e){var f="hsla("+a+","+c+"%,"+e+"%, 0)";c="hsla("+a+","+c+"%,"+e+"%, 1.0)";
this.oD&&(a=c,c=f,f=a);this.v_=a="linear-gradient(90deg, "+f+", "+c+"),"+this.NY;this.jG.css("background",a)},cKa:function(a,c,e,f){var g="number"===typeof f&&1>f;a=Math.round(a);c=Math.round(100*c)/100;e=Math.round(100*e)/100;return a="hsl"+(g?"a(":"(")+(a+", "+c+"%, "+e+"%"+(g?","+f:"")+")")},Zoa:function(a,c){this.ND=a;this.tD=c},xoa:function(a){a&&(this.Pf=a,a=c(a),this.jr=a[0],this.ND=a[1],this.tD=a[2],this.Xo=a[3])},aK:function(a,c,e,f){this.Qe.attr("aria-valuetext",this.cKa(a,c,e,f))},pNa:function(){this.SI();
this.sb()},sb:function(){this.qh.append(this.mJ);this.qh.addClass("oj-colorspectrum");g(".oj-colorspectrum-hue").uniqueId();g(".oj-colorspectrum-alpha").uniqueId();this.qh.find(".oj-colorspectrum-container");this.wm=this.qh.find(".oj-colorspectrum-hue");this.vm=this.qh.find(".oj-colorspectrum-alpha");this.yn=this.qh.find(".oj-colorspectrum-spectrum");this.Qe=this.qh.find(".oj-colorspectrum-thumb");this.Hl=this.Qe[0].offsetWidth/2;0>=this.Hl&&(this.Hl=this.Qe.width()/2);this.tz=a.T.ie();this.Pt=this.yn.width();
this.Ap=this.yn.height();this.Qe.attr("aria-describedby",this.qh.find(".oj-colorspectrum-thumb-description").uniqueId().attr("id"));this.NY="url('"+a.sa.Cb("common/images/spectrum-opacity-slider-bg.png")+"')";this.NY=this.NY.replace("js","css");var b=this.Vq?!0:!1,d=c(this.Pf);this.jr=d[0];this.ND=d[1];this.tD=d[2];this.Xo=d[3];this.xpa=!1;this.wm.ojSlider({max:360,min:0,step:1,value:this.jr,orientation:"vertical",optionChange:this.sma.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal",
"");this.vm.ojSlider({max:1,min:0,step:.01,value:this.Xo,orientation:"horizontal",optionChange:this.sma.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal","");this.xNa();this.ITa();this.G4(this.jr,this.ND,this.tD,this.Xo,!0);this.yn.click(this.kUa.bind(this));this.zNa();this.hK(b);this.Qe.keydown(this.FOa.bind(this));this.Qe.keyup(this.HOa.bind(this));this.yn.focus(this.KPa.bind(this));this._focusable({element:this.Qe,u3a:!0});a.T.ie()&&this.N4(this.Qe)},KPa:function(){this.Qe.focus();
return!1},xNa:function(){var a={subId:"oj-slider-bar"};this.kG=g(this.wm.ojSlider("getNodeBySubId",a));this.jG=g(this.vm.ojSlider("getNodeBySubId",a));a.g4a="oj-slider-bar-value";g(this.wm.ojSlider("getNodeBySubId",a));g(this.vm.ojSlider("getNodeBySubId",a));this.kG.css("background","linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)");this.x_="linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)";
this.OS(this.jr,this.ND,this.tD);this.xpa=!0},SI:function(){this.VY();this.Fw=this.Ew=0;var a=this.tg(this.R("labelHue")),c=this.tg(this.R("labelOpacity"));this.mJ=["\x3cdiv class\x3d'oj-colorspectrum-container'\x3e\x3cdiv class\x3d'oj-colorspectrum-spectrum' tabindex\x3d'-1' style\x3d'position:relative'\x3e\x3cdiv class\x3d'oj-colorspectrum-thumb' role\x3d'slider' aria-describedby\x3d'' style\x3d'position:absolute;top:-9999px;left:-9999px;' tabIndex\x3d'0'\x3e\x3c/div\x3e\x3c/div\x3e","\x3cdiv class\x3d'oj-colorspectrum-thumb-description oj-helper-hidden-accessible'\x3e"+
this.tg(this.R("labelThumbDesc"))+"\x3c/div\x3e","\x3cinput class\x3d'oj-colorspectrum-hue' aria-label\x3d'"+a+"'\x3e\x3c/input\x3e","\x3cinput class\x3d'oj-colorspectrum-alpha' aria-label\x3d'"+c+"'\x3e\x3c/input\x3e","\x3c/div\x3e"].join("");this.bw=-1;this.oD="rtl"===this.Qc()},VY:function(){var b=this.options,c;this.qh=g(this.element);this.Vq=!1;c=b.value;c instanceof a.o||(c=null);this.Pf=c?c:a.o.BLACK;b.rawValue=this.Pf;c=b.disabled;this.Vq="boolean"===typeof c?c:!1},FHa:function(a){var c=!a;
a?(this.wm.ojSlider("option","disabled",c),this.vm.ojSlider("option","disabled",c),c={subId:"oj-slider-bar"},this.wm=this.qh.find(".oj-colorspectrum-hue"),this.vm=this.qh.find(".oj-colorspectrum-alpha"),this.kG=g(this.wm.ojSlider("getNodeBySubId",c)),this.jG=g(this.vm.ojSlider("getNodeBySubId",c)),this.v_&&this.jG.css("background",this.v_),this.x_&&this.kG.css("background",this.x_)):((a=this.kG.css("background"))&&0<a.length&&(this.x_=a),(a=this.jG.css("background"))&&0<a.length&&(this.v_=a),this.kG.css("background",
""),this.jG.css("background",""),this.wm.ojSlider("option","disabled",c),this.vm.ojSlider("option","disabled",c))},NGa:function(){this.wm.ojSlider("destroy");this.vm.ojSlider("destroy")},ERa:function(){this.qh.empty()},QEa:function(){this.yn.off("click");this.Qe.off("mousedown");this.Qe.off("keydown");this.Qe.off("keyup");this.wK&&this.g5(this.Qe)},My:function(){this.mJ=this.qh=this.wm=this.vm=this.yn=this.Qe=null},N4:function(b){this.wK=a.Vg.Z5(b)},g5:function(b){a.Vg.T8(b)},_GetMessagingLauncherElement:function(){return this.element},
ve:function(){return this.Qe},Zu:function(){return this.Pf},xk:function(b){this.Pf="string"===typeof b?new a.o(b):b},Ki:function(){return this.Pf.toString()},_GetDefaultStyleClass:function(){return"oj-colorspectrum"},tg:function(a){return g("\x3cspan\x3e"+a+"\x3c/span\x3e").text()}})})();a.J.$a("oj-color-spectrum","editableValue",{properties:{labelledBy:{type:"string"},value:{writeback:!0}},methods:{},extension:{Ya:"ojColorSpectrum"}});a.J.register("oj-color-spectrum",{metadata:a.J.getMetadata("oj-color-spectrum")})});