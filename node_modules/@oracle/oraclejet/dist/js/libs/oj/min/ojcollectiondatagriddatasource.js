/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojmodel"],function(a){a.lf=function(g,c,b,d,e){a.C.JK(b);this.Qd=g;this.Oh=c;this.QU=b;this.Aa=d;this.Ie=e};o_("CollectionHeaderSet",a.lf,a);a.lf.prototype.jwa=function(g){a.C.hT(g);null!=g&&g.length===this.getCount()&&(this.RA=g)};a.lf.prototype.getData=function(g,c){var b;a.C.assert(g<=this.Oh&&g>=this.Qd,"index out of bounds");a.C.assert(null==c||0==c,"level out of bounds");if(null!=this.Aa){if(null==this.RA)return null;b=this.RA[g-this.Qd];
return b.get(this.Aa)}return this.QU[g]};a.f.j("CollectionHeaderSet.prototype.getData",{getData:a.lf.prototype.getData});a.lf.prototype.getMetadata=function(g,c){var b;a.C.assert(g<=this.Oh&&g>=this.Qd,"index out of bounds");a.C.assert(null==c||0==c,"level out of bounds");if(null!=this.Aa){if(null==this.RA)return null;b=this.RA[g-this.Qd];return{key:a.Jx.WC(b)}}b=this.getData(g,c);return this.Ie.key===b?{key:b,sortDirection:this.Ie.direction}:{key:b}};a.f.j("CollectionHeaderSet.prototype.getMetadata",
{getMetadata:a.lf.prototype.getMetadata});a.lf.prototype.getLevelCount=function(){return 0<this.getCount()?1:0};a.f.j("CollectionHeaderSet.prototype.getLevelCount",{getLevelCount:a.lf.prototype.getLevelCount});a.lf.prototype.getExtent=function(g,c){a.C.assert(g<=this.Oh&&g>=this.Qd,"index out of bounds");a.C.assert(null==c||0==c,"level out of bounds");return{extent:1,more:{before:!1,after:!1}}};a.f.j("CollectionHeaderSet.prototype.getExtent",{getExtent:a.lf.prototype.getExtent});a.lf.prototype.getDepth=
function(g,c){a.C.assert(g<=this.Oh&&g>=this.Qd,"index out of bounds");a.C.assert(null==c||0==c,"level out of bounds");return 1};a.f.j("CollectionHeaderSet.prototype.getDepth",{getDepth:a.lf.prototype.getDepth});a.lf.prototype.getCount=function(){return Math.max(0,this.Oh-this.Qd)};a.f.j("CollectionHeaderSet.prototype.getCount",{getCount:a.lf.prototype.getCount});a.lf.prototype.getStart=function(){return this.Qd};a.f.j("CollectionHeaderSet.prototype.getStart",{getStart:a.lf.prototype.getStart});a.lf.prototype.qsa=
function(){return this.Oh};a.f.j("CollectionHeaderSet.prototype.getEnd",{qsa:a.lf.prototype.qsa});a.lf.prototype.wsa=function(){return this.QU};a.f.j("CollectionHeaderSet.prototype.getHeaders",{wsa:a.lf.prototype.wsa});a.lf.prototype.jL=function(){return this.Aa};a.f.j("CollectionHeaderSet.prototype.getRowHeader",{jL:a.lf.prototype.jL});a.Uf=function(g,c,b,d,e){a.C.JK(e);this.Za=g;this.Pa=c;this.fs=b;this.NA=d;this.gh=e};o_("CollectionCellSet",a.Uf,a);a.Uf.prototype.jwa=function(g){a.C.hT(g);null!=
g&&g.length===this.getCount("row")&&(this.RA=g)};a.Uf.prototype.getData=function(a){var c,b;b=this.yd(a);if(null==b)return null;c=this.gh[a.column];a={};Object.defineProperty(a,"data",{enumerable:!0,get:function(){return b.get(c)},set:function(a){b.set(c,a,{silent:!0})}});return a};a.f.j("CollectionCellSet.prototype.getData",{getData:a.Uf.prototype.getData});a.Uf.prototype.getMetadata=function(g){var c;c=this.yd(g);return null==c?null:{keys:{row:a.Jx.WC(c),column:this.gh[g.column]}}};a.f.j("CollectionCellSet.prototype.getMetadata",
{getMetadata:a.Uf.prototype.getMetadata});a.Uf.prototype.yd=function(g){var c;if(null==this.RA)return null;a.C.Oj(g);c=g.row;g=g.column;a.C.assert(c>=this.Za&&c<=this.Pa&&g>=this.fs&&g<=this.NA);return this.RA[c-this.Za]};a.Uf.prototype.getCount=function(a){return"row"===a?Math.max(0,this.Pa-this.Za):"column"===a?Math.max(0,this.NA-this.fs):0};a.f.j("CollectionCellSet.prototype.getCount",{getCount:a.Uf.prototype.getCount});a.Uf.prototype.getExtent=function(){return{row:{extent:1,more:{before:!1,after:!1}},
column:{extent:1,more:{before:!1,after:!1}}}};a.f.j("CollectionCellSet.prototype.getExtent",{getExtent:a.Uf.prototype.getExtent});a.Uf.prototype.RE=function(){return this.Za};a.f.j("CollectionCellSet.prototype.getStartRow",{RE:a.Uf.prototype.RE});a.Uf.prototype.ssa=function(){return this.Pa};a.f.j("CollectionCellSet.prototype.getEndRow",{ssa:a.Uf.prototype.ssa});a.Uf.prototype.QE=function(){return this.fs};a.f.j("CollectionCellSet.prototype.getStartColumn",{QE:a.Uf.prototype.QE});a.Uf.prototype.rsa=
function(){return this.NA};a.f.j("CollectionCellSet.prototype.getEndColumn",{rsa:a.Uf.prototype.rsa});a.Uf.prototype.Pw=function(){return this.gh};a.f.j("CollectionCellSet.prototype.getColumns",{Pw:a.Uf.prototype.Pw});a.Jx=function(){};a.Jx.WC=function(a){var c;c=a.ok();null==c&&(c=a.Tx());return c};a.pb=function(g,c){this.zb=g;null!=c&&(this.dq=c.rowHeader,this.columns=c.columns);this.apa();a.pb.O.constructor.call(this)};o_("CollectionDataGridDataSource",a.pb,a);a.f.ya(a.pb,a.Lu,"oj.CollectionDataGridDataSource");
a.pb.prototype.Init=function(){a.pb.O.Init.call(this);this.Bu={};this.QJ()};a.f.j("CollectionDataGridDataSource.prototype.Init",{Init:a.pb.prototype.Init});a.pb.prototype.QJ=function(){this.zb.on("add",this.bMa.bind(this));this.zb.on("remove",this.fMa.bind(this));this.zb.on("change",this.cMa.bind(this));this.zb.on("refresh",this.ZKa.bind(this));this.zb.on("reset",this.$Ka.bind(this))};a.pb.prototype.WNa=function(){return null!=this.data};a.pb.prototype.getCount=function(a){var c;void 0==this.precision&&
(this.precision={});if("row"==a){c=this.ah();if(-1===c||0===c&&(!this.WNa()||0<this.ww()))return this.precision[a]="estimate",-1;this.precision[a]="exact";return this.ww()}if("column"==a){if(null!=this.columns)return this.precision[a]="exact",this.columns.length;this.precision[a]="estimate";return-1}return 0};a.f.j("CollectionDataGridDataSource.prototype.getCount",{getCount:a.pb.prototype.getCount});a.pb.prototype.getCountPrecision=function(a){null!=this.precision&&null!=this.precision[a]||this.getCount(a);
return this.precision[a]};a.f.j("CollectionDataGridDataSource.prototype.getCountPrecision",{getCountPrecision:a.pb.prototype.getCountPrecision});a.pb.prototype.fetchHeaders=function(a,c,b){var d,e;null!=c&&(d=a.axis,e={},e.Jta=a,e.callbacks=c,e.MK=b,this.Bu[d]=e)};a.f.j("CollectionDataGridDataSource.prototype.fetchHeaders",{fetchHeaders:a.pb.prototype.fetchHeaders});a.pb.prototype.LLa=function(g,c,b,d){var e,f,h,k;e=g.axis;f=g.start;h=g.count;if("column"===e)null!=this.columns&&(d=Math.min(this.columns.length,
f+h),k=new a.lf(f,d,this.columns,void 0,this.jK));else if("row"===e&&null!=this.dq){null!=d&&(h=d.count);d=Math.min(this.ww(),f+h);k=new a.lf(f,d,this.columns,this.dq);this.Wna(f,d,k,g,c,b);return}null!=c&&c.success&&c.success.call(b.success,k,g,null)};a.pb.prototype.Hia=function(a){var c,b,d,e,f,h;for(c=0;c<a.length;c+=1)b=a[c],"row"===b.axis?(d=b.start,e=b.count):"column"===b.axis&&(f=b.start,h=b.count);return{rowStart:d,rowCount:e,colStart:f,colCount:h}};a.pb.prototype.SKa=function(g,c,b,d){var e,
f,h;e=this.Hia(g);f=e.rowStart;d=null!=d?Math.min(this.ww(),f+d.count):Math.min(this.ww(),f+e.rowCount);h=e.colStart;e=Math.min(null==this.columns?0:this.columns.length,h+e.colCount);e=new a.Uf(f,d,h,e,this.columns);this.Wna(f,d,e,g,c,b)};a.pb.prototype.Wna=function(a,c,b,d,e,f){var h;for(h=[];a<c;a++)h.push(this.zb.at(a,{deferred:!0}));Promise.all(h).then(function(a){b.jwa(a);e.success.call(f.success,b,d)})};a.pb.prototype.fetchCells=function(a,c,b){null!=c&&(this.dj={},this.dj.j6=a,this.dj.callbacks=
c,this.dj.MK=b);this.RHa(a)};a.f.j("CollectionDataGridDataSource.prototype.fetchCells",{fetchCells:a.pb.prototype.fetchCells});a.pb.prototype.Mma=function(a){var c,b,d,e,f;c=this.Bu[a];null!=c&&(b=c.Jta,d=c.callbacks,e=c.MK,"row"===a&&(f=c.V5),this.LLa(b,d,e,f),this.Bu[a]=null)};a.pb.prototype.AQa=function(){this.SKa(this.dj.j6,this.dj.callbacks,this.dj.MK,this.dj.V5);this.dj=null};a.pb.prototype.RHa=function(a){var c,b;c=this.Hia(a);b=c.rowStart;this.zb.BF(b,c.rowCount).then(function(c){this.data=
!0;this.OSa(c.start,c.count);void 0===this.columns?this.zb.at(b,{deferred:!0}).then(function(b){null!=b&&this.J4(b);this.Iga(a)}.bind(this)):this.Iga(a)}.bind(this),function(a){this.SHa(a)}.bind(this))};a.pb.prototype.SHa=function(g){a.D.error(g);null!=this.Bu&&(this.Nma("column",g),this.Nma("row",g));null!=this.dj&&this.BQa(g)};a.pb.prototype.Nma=function(a,c){var b,d,e;b=this.Bu[a];null!=b&&(d=b.callbacks,e=b.MK,b=b.Jta,d.error&&d.error.call(e.error,c,b),this.Bu[a]=null)};a.pb.prototype.BQa=function(a){var c,
b,d;c=this.dj.callbacks;b=this.dj.MK;d=this.dj.j6;c.error&&c.error.call(b.error,a,d);this.dj=null};a.pb.prototype.Iga=function(a){this.dj.j6==a&&(null!=this.Bu&&(this.Mma("column"),this.Mma("row")),null!=this.dj&&this.AQa())};a.pb.prototype.OSa=function(a,c){var b={start:a,count:c};null!=this.Bu.row&&(this.Bu.row.V5=b);null!=this.dj&&(this.dj.V5=b)};a.pb.prototype.J4=function(a){this.columns=a.keys();-1!=this.columns.indexOf(this.dq)&&this.columns.splice(this.columns.indexOf(this.dq),1)};a.pb.prototype.keys=
function(g){var c,b,d,e,f;c=g.row;b=g.column;f=this;return new Promise(function(g){f.zb.at(c,{deferred:!0}).then(function(c){null==c?g({row:null,column:null}):(d=a.Jx.WC(c),null==f.columns&&f.J4(c),e=f.columns[b],g({row:d,column:e}))}.bind(f))})};a.f.j("CollectionDataGridDataSource.prototype.keys",{keys:a.pb.prototype.keys});a.pb.prototype.indexes=function(a){var c,b,d,e;c=a.row;b=a.column;e=this;return new Promise(function(a){e.zb.indexOf(c,{deferred:!0}).then(function(c){-1===c?a({row:-1,column:-1}):
null==e.columns?e.zb.at(c,{deferred:!0}).then(function(g){e.J4(g);d=e.columns.indexOf(b);-1===d&&(c=-1);a({row:c,column:d})}.bind(e)):(d=e.columns.indexOf(b),-1===d&&(c=-1),a({row:c,column:d}))}.bind(e))})};a.f.j("CollectionDataGridDataSource.prototype.indexes",{indexes:a.pb.prototype.indexes});a.pb.prototype.getCapability=function(a){return"sort"===a?"column":"move"===a?"row":null};a.f.j("CollectionDataGridDataSource.prototype.getCapability",{getCapability:a.pb.prototype.getCapability});a.pb.prototype.sort=
function(a,c,b){var d,e,f;null==b&&(b={});null==a?this.f4(c,b):(e=a.direction,f=a.key,a=a.axis,"column"===a?(this.zb.Qb()?(this.zb.comparator=f,this.zb.sortDirection="ascending"===e?1:-1):("ascending"===e&&(d=function(a,b){var c,d;a=a.get(f);b=b.get(f);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString(),c=!0);b instanceof Date&&(b=b.toISOString(),d=!0);return c&&d?a<b?-1:a===b?0:1:c?1:d?-1:a-b}),"descending"===e&&(d=function(a,b){var c,d;a=a.get(f);b=b.get(f);c=isNaN(a);d=isNaN(b);a instanceof
Date&&(a=a.toISOString());b instanceof Date&&(b=b.toISOString());return c&&d?a>b?-1:a===b?0:1:c?-1:d?1:b-a}),this.zb.comparator=d),this.zb.sort(),this.apa(f),null!=c&&null!=c.success&&c.success.call(b.success)):null!=c&&null!=c.error&&c.error.call(b.error,"Axis value not supported"))};a.f.j("CollectionDataGridDataSource.prototype.sort",{sort:a.pb.prototype.sort});a.pb.prototype.f4=function(a,c){this.zb.comparator=null;this.zb.reset();null!=a&&null!=a.success&&a.success.call(c.success)};a.pb.prototype.apa=
function(a){var c,b;c=this.zb.comparator;b=-1===this.zb.sortDirection?"descending":"ascending";null==a&&"function"===typeof c?this.jK={}:(this.jK={},this.jK.axis="column",this.jK.direction=b,this.jK.key=null==a?c:null)};a.pb.prototype.move=function(a,c,b,d,e){var f;this.zb.get(a,{deferred:!0}).then(function(b){null==c?(this.zb.remove(b),this.zb.add(b),null!=d&&null!=d.success&&d.success.call(e.success)):(a===c?(f=this.zb.indexOf(c,{deferred:!0}),this.zb.remove(b)):(this.zb.remove(b),f=this.zb.indexOf(c,
{deferred:!0})),f.then(function(a){this.zb.add(b,{at:a,F3a:!0});null!=d&&null!=d.success&&d.success.call(e.success)}.bind(this)))}.bind(this))};a.f.j("CollectionDataGridDataSource.prototype.move",{move:a.pb.prototype.move});a.pb.prototype.moveOK=function(){return"valid"};a.f.j("CollectionDataGridDataSource.prototype.moveOK",{moveOK:a.pb.prototype.moveOK});a.pb.prototype.br=function(a,c,b,d,e){var f={source:this};f.operation=a;f.keys={row:c,column:b};f.indexes={row:d,column:e};return f};a.pb.prototype.bMa=
function(g){this.handleEvent("change",this.br("insert",a.Jx.WC(g),null,g.index,-1))};a.pb.prototype.fMa=function(g,c,b){this.handleEvent("change",this.br("delete",a.Jx.WC(g),null,b.index,-1))};a.pb.prototype.cMa=function(g){this.handleEvent("change",this.br("update",a.Jx.WC(g),null,g.index,-1))};a.pb.prototype.ZKa=function(){this.data=null;this.handleEvent("change",this.br("refresh",null,null))};a.pb.prototype.$Ka=function(){this.data=null;this.handleEvent("change",this.br("reset",null,null))};a.pb.prototype.ww=
function(){return this.zb.size()};a.pb.prototype.ah=function(){return void 0===this.zb.totalResults?-1:this.zb.totalResults};a.pb.prototype.jsa=function(){return this.zb};a.f.j("CollectionDataGridDataSource.prototype.getCollection",{jsa:a.pb.prototype.jsa});a.pb.prototype.Pw=function(){return this.columns};a.f.j("CollectionDataGridDataSource.prototype.getColumns",{Pw:a.pb.prototype.Pw});a.pb.prototype.jL=function(){return this.dq};a.f.j("CollectionDataGridDataSource.prototype.getRowHeader",{jL:a.pb.prototype.jL});
a.pb.prototype.getData=function(){return this.data};a.f.j("CollectionDataGridDataSource.prototype.getData",{getData:a.pb.prototype.getData})});