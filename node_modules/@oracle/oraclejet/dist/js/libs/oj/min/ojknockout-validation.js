/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","knockout","ojs/ojknockout","ojs/ojmessaging"],function(a,g,c){a.Xc=function(){};a.Xc.mG="invalidComponentTracker";a.Xc.dba="ojoptionchange";a.Xc.Us="messagesShown";a.Xc.cv="messagesHidden";a.Xc.Eq="disabled";a.Xc.BG="readOnly";a.Xc.Bw=function(b,d,e,f,h){var k={};h=h.call()[a.Xc.mG];var g;if(b===a.Xc.Eq||b===a.Xc.BG)return g=h&&h.peek()||null,null!==g&&c.isWriteableObservable(h)&&g.Bw.call(g,f,e,b,d)&&h.valueHasMutated(),k[b]=d,k};a.Xc._init=function(a,c){var e={};e[a]=
c;return e};a.Xc.wDa=function(b,c,e,f){f=f.call();var h;b===a.Xc.mG&&(h=f[b]?!0:!1)&&a.Xc.gRa(b,f,c,e);return{}};a.Xc.ZDa=function(b,d,e,f){d=g(d);f=f.call()[b];b===a.Xc.mG&&d&&(d.off(a.Xc.dba,a.Xc.uqa),f&&c.isWriteableObservable(f)&&(b=f.peek(),b.Nf.call(b,e)&&f.valueHasMutated()))};a.Xc.uqa=function(b,d){var e=b.data.w9,f,h=b.data.V,k=b.data.element,g=d.option,m=d.value;(g===a.Xc.Us||g===a.Xc.cv)&&e&&c.isWriteableObservable(e)&&(f=e.peek())&&f.Bw.call(f,h,k,g,m)&&e.valueHasMutated()};a.Xc.gRa=function(b,
d,e,f){d=d[b];var h,k,l;b=g(e);if(c.isObservable(d))l=d.peek(),null==l&&(l=new a.rd,d(l));else throw Error("Binding attribute "+a.Xc.mG+" should be bound to a ko observable.");null!==l&&(c.isWriteableObservable(d)&&(h=f.call(f,"option",a.Xc.Us),k=f.call(f,"option",a.Xc.cv),l.Bw.call(l,f,e,a.Xc.Us,h),l.Bw.call(l,f,e,a.Xc.cv,k),d.valueHasMutated()),e={w9:d,V:f,element:e},b.on(a.Xc.dba,e,a.Xc.uqa))};a.za.fh().lh({"for":"editableValue",attributes:[a.Xc.mG,a.Xc.Eq,a.Xc.BG],init:a.Xc._init,update:a.Xc.Bw,
afterCreate:a.Xc.wDa,beforeDestroy:a.Xc.ZDa});a.rd=function(){this.Init()};o_("InvalidComponentTracker",a.rd,a);a.f.ya(a.rd,a.f,"oj.InvalidComponentTracker");a.rd.Us="messagesShown";a.rd.cv="messagesHidden";a.rd.Eq="disabled";a.rd.BG="readOnly";a.rd.prototype.Init=function(){a.rd.O.Init.call(this);this.iE=[];this.Vv=[];this.iD=[];this.invalidHidden=this.invalidShown=!1};a.rd.prototype.Wra=function(){var b=null,c=this,e=this.RS,f;f=a.Context.g7().md().ad({description:"Setting Focus to first invalid component."});
this.invalidShown&&(b=this.u0());setTimeout(function(){(b=e===c.RS?b||c.u0():c.u0())&&b.call(b,"Focus");f()},1);return b?!0:!1};a.f.j("InvalidComponentTracker.prototype.focusOnFirstInvalid",{Wra:a.rd.prototype.Wra});a.rd.prototype.showMessages=function(){var a,c,e;if(this.invalidHidden)for(c=this.iD.length,a=0;a<c;a++)this.iD[a]&&(e=this.iE[a].component.call(e,"showMessages"))};a.f.j("InvalidComponentTracker.prototype.showMessages",{showMessages:a.rd.prototype.showMessages});a.rd.prototype.u0=function(){for(var a,
c=0,e=[],f=this.Vv.length,c=0;c<f;c++)(a=this.Vv[c])&&e.push(this.iE[c]);if(0===e.length)return null;e.sort(function(a,b){return a.element.compareDocumentPosition(b.element)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1});return e[0].component};a.rd.prototype.Nf=function(a){var c=-1,e=!1;g.each(this.iE,function(e,h){0>c&&h.component===a&&(c=e)});0<=c&&(this.iE.splice(c,1),this.Vv.splice(c,1),this.iD.splice(c,1),this.K5(),e=!0);return e};a.rd.prototype.Bw=function(b,c,e,f){var h=b.call(b,"isValid"),k=!0,l,
m=-1;g.each(this.iE,function(a,c){0>m&&c.component===b&&(m=a)});switch(e){case a.rd.Us:case a.rd.cv:l=!1;f&&(0>m&&(m=this.iE.push({component:b,element:c})-1,this.JNa(m,l)),!h&&a.rd.c2(f)&&(l=!0,e===a.rd.Us&&(c=b.call(b,"option",a.rd.Eq),f=b.call(b,"option",a.rd.BG),l=c||f?!1:!0)),k=this.AK(e,m||0,l),this.K5(),k&&(void 0===this.RS&&(this.RS=0),this.RS++));break;case a.rd.Eq:case a.rd.BG:k=!1,f&&(k=this.AK(a.rd.Us,m||0,!1),k=this.AK(a.rd.cv,m||0,!1)||k,this.K5())}return k};a.rd.prototype.JNa=function(b,
c){void 0===this.Vv[b]&&this.AK(a.rd.Us,b,c);void 0===this.iD[b]&&this.AK(a.rd.cv,b,c)};a.rd.prototype.K5=function(){this.invalidShown=0<=this.Vv.indexOf(!0);this.invalidHidden=0<=this.iD.indexOf(!0)};a.rd.prototype.AK=function(b,c,e){var f=!1;b=b===a.rd.Us?this.Vv:b===a.rd.cv?this.iD:[];0<=c&&void 0!==b[c]?(f=b[c]!==e?!0:!1)&&(b[c]=e):(b.push(e),f=!0);return f};a.rd.c2=function(b){return!a.ua.isValid(b)}});