/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery"],function(a,g){a.Vf=function(a,b,d){d=d||{};this.p=b;this.zk=g(a)[0];this.KC=d.fetchSize;this.KC=0<this.KC?this.KC:25;this.uD=d.maxCount;this.uD=0<this.uD?this.uD:500;this.wp=0<d.initialRowCount?d.initialRowCount:0;this.Ipa=d.success;this.HHa=d.error;this.Nz();this.fp=d.fetchTrigger;if(null==this.fp||isNaN(this.fp))this.fp=0;this.GNa=this.zk.scrollTop;g(this.kQ()).on("scroll.domscroller",function(){var a=this.zk,b=this.gKa(a),a=a.scrollHeight-a.clientHeight;0<a&&this.T1(b,
a)}.bind(this))};a.Vf.prototype.M0a=function(a){null!=a&&!isNaN(a)&&0<=a&&(this.fp=a)};a.Vf.prototype.kQ=function(){return this.zk==document.body||this.zk==document.documentElement?window:this.zk};a.Vf.pWa=function(a,b){for(var d=0,e=b;e&&e!=a&&g.contains(a,e);)d+=e.offsetTop,e=e.offsetParent;return d};a.Vf.prototype.gKa=function(a){var b=this.fp;return a==document.documentElement&&(void 0===this.Cqa&&(this.Cqa=this.GNa==a.scrollTop?!0:!1),this.Cqa)?b+document.body.scrollTop:b+a.scrollTop};a.Vf.prototype.destroy=
function(){this.Bp();g(this.kQ()).off("scroll.domscroller")};a.f.j("DomScroller.prototype.destroy",{destroy:a.Vf.prototype.destroy});a.Vf.prototype.checkViewport=function(){return 0<this.zk.clientHeight&&!this.EEa()?this.Lga():Promise.resolve(null)};a.f.j("DomScroller.prototype.checkViewport",{checkViewport:a.Vf.prototype.checkViewport});a.Vf.prototype.T1=function(a,b){if(1>=b-a&&!this.WH){var d=this;this.Lga().then(function(a){null!=d.Ipa&&d.Ipa(a)},this.HHa)}};a.Vf.prototype.EEa=function(){var a=
this.zk;return a.scrollHeight>a.clientHeight+this.fp?!0:!1};a.Vf.prototype.Lga=function(){if(this.WH)return this.WH;var a=this.uD-this.wp;if(0<a){var b=this.KC,d=this;a<this.KC&&(b=a);var e=this.THa({pageSize:b});return this.WH=new Promise(function(b){e.then(function(e){d.WH=null;null!=e&&0<e.data.length&&(d.wp=e.data.length+e.startIndex,a<d.KC&&(e.maxCount=d.uD,e.maxCountLimit=!0));b(e)})})}return Promise.resolve({maxCount:this.uD,maxCountLimit:!0})};a.Vf.prototype.THa=function(a){a=a||{};var b=
a.pageSize;this.ul=this.ul?this.ul+b:this.wp;if(-1==this.p.totalSize()||!this.$g()||this.$g()&&this.p.totalSize()>this.ul){var d=this;return new Promise(function(a,c){d.p.fetch({startIndex:d.ul,pageSize:b}).then(function(b){a(b)},function(){c(null)})})}return Promise.resolve()};a.Vf.prototype.Ov=function(){this.ul=null;this.wp=0};a.Vf.prototype.hLa=function(a){this.ul=a.startIndex;0<a.data.length&&(this.wp=a.data.length+this.ul)};a.Vf.prototype.uja=function(c){return function(b){b=b||{};b=b.indexes;
var d,e=b.length;for(d=0;d<e;d++){var f=b[d];void 0!==f&&0<this.wp&&f<=this.wp&&(c==a.na.fa.ADD?this.wp+=1:c==a.na.fa.REMOVE&&(this.wp-=1))}}};a.Vf.prototype.$g=function(){var a=this.p;return null!=a&&"actual"==a.totalSizeConfidence()?!0:!1};a.Vf.prototype.Nz=function(){var c=this.p;if(null!=c){this.Bp();this.Wb=[];this.Wb.push({eventType:a.na.fa.SORT,eventHandler:this.Ov.bind(this)});this.Wb.push({eventType:a.na.fa.REFRESH,eventHandler:this.Ov.bind(this)});this.Wb.push({eventType:a.na.fa.RESET,eventHandler:this.Ov.bind(this)});
this.Wb.push({eventType:a.na.fa.SYNC,eventHandler:this.hLa.bind(this)});this.Wb.push({eventType:a.na.fa.ADD,eventHandler:this.uja(a.na.fa.ADD).bind(this)});this.Wb.push({eventType:a.na.fa.REMOVE,eventHandler:this.uja(a.na.fa.REMOVE).bind(this)});var b,d;for(b=0;b<this.Wb.length;b++)(d=c.on(this.Wb[b].eventType,this.Wb[b].eventHandler))&&(this.Wb[b].eventHandler=d)}};a.Vf.prototype.Bp=function(){var a=this.p;if(null!=this.Wb&&null!=a){var b;for(b=0;b<this.Wb.length;b++)a.off(this.Wb[b].eventType,this.Wb[b].eventHandler)}}});