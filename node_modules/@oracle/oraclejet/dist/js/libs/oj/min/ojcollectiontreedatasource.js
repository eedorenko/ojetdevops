/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojmodel"],function(a){a.Qh=function(a,c,b,d,e,f){this.hV=a;this.zb=c;this.hs=b;this.l6=[];this.GF=d;this.start=e<b.length?e:0===b.length?0:b.length-1;this.count=-1===f?b.length:Math.min(b.length,f)};o_("CollectionNodeSet",a.Qh,a);a.Qh.prototype.d$=function(a){this.Kga(this).then(function(){a.success&&a.success()})};a.Qh.prototype.Kga=function(a){return new Promise(function(c){function b(e){e<d?a.xxa(e,{success:function(c){null!==c?a.Kga(c).then(function(){b(e+
1)}):b(e+1)}}):c(void 0)}var d=a.getCount();b(0)})};a.Qh.prototype.xxa=function(a,c){var b=this.hs[a];if(this.GF.tF(b).leaf)this.l6[a]=null,c.success(null);else{var d=this.GF.NM(b),b=this.GF.tF(b).key,e=this;this.GF.OF(d,0,-1,{success:function(b){e.l6[a]=b;c.success(b)}},b)}};a.Qh.prototype.getParent=function(){return this.hV};a.f.j("CollectionNodeSet.prototype.getParent",{getParent:a.Qh.prototype.getParent});a.Qh.prototype.getStart=function(){return this.start};a.f.j("CollectionNodeSet.prototype.getStart",
{getStart:a.Qh.prototype.getStart});a.Qh.prototype.getCount=function(){return this.count};a.f.j("CollectionNodeSet.prototype.getCount",{getCount:a.Qh.prototype.getCount});a.Qh.prototype.getData=function(a){this.EZ(a);return this.hs[a].attributes};a.f.j("CollectionNodeSet.prototype.getData",{getData:a.Qh.prototype.getData});a.Qh.prototype.EZ=function(a){if(a<this.start||a>this.start+this.count)throw"Out of range";};a.Qh.prototype.getMetadata=function(a){this.EZ(a);var c={};a=this.GF.tF(this.hs[a]);
c.key=a.key;c.leaf=a.leaf;c.depth=a.depth;return c};a.f.j("CollectionNodeSet.prototype.getMetadata",{getMetadata:a.Qh.prototype.getMetadata});a.Qh.prototype.Tj=function(a){if(this.GF.R5)return null;this.EZ(a);return this.l6[a]};a.f.j("CollectionNodeSet.prototype.getChildNodeSet",{Tj:a.Qh.prototype.Tj});a.Ib=function(g){g=g||{};this.oM=g.root;this.tWa=g.childCollectionCallback;this.tF=g.parseMetadata;this.hB=null;this.DF="none";this.mi={};this.R5=!1;a.Ib.O.constructor.call(this)};o_("CollectionTreeDataSource",
a.Ib,a);a.Ib.prototype.tF=function(a){return{key:a.idAttribute+"\x3d"+a.id}};a.f.ya(a.Ib,a.Vu,"oj.CollectionTreeDataSource");a.Ib.prototype.Init=function(){a.Ib.O.Init.call(this)};a.f.j("CollectionTreeDataSource.prototype.Init",{Init:a.Ib.prototype.Init});a.Ib.prototype.getChildCount=function(a){return(a=this.FY(a))&&0<a.length?a.length:-1};a.f.j("CollectionTreeDataSource.prototype.getChildCount",{getChildCount:a.Ib.prototype.getChildCount});a.Ib.prototype.hsa=function(a,c){this.fetchChildren(a,null,
{success:function(a){c.success(a.zb)},error:c.error})};a.f.j("CollectionTreeDataSource.prototype.getChildCollection",{hsa:a.Ib.prototype.hsa});a.Ib.prototype.fetchChildren=function(a,c,b){c=c||{};var d=c.start?c.start:0,e=c.count?c.count:-1;if(null===a)this.OF(null,d,e,b,null);else{var f=this;this.N0(this.oM,d,e,a,0).then(function(c){if(c){c=f.NM(c.Ao);try{f.OF(c,d,e,b,a)}catch(k){b&&b.error&&b.error({status:k.message})}}else b&&b.error&&b.error(a)})}};a.f.j("CollectionTreeDataSource.prototype.fetchChildren",
{fetchChildren:a.Ib.prototype.fetchChildren});a.Ib.prototype.Yxa=function(a,c,b){var d=0;b&&b.at&&(d=b.at);c=this.cQ(c);a=this.$O(this,"insert",d,c,this.Sma(null!=c&&0<c.length?c[c.length-1]:null,a));this.handleEvent("change",a)};a.Ib.prototype.Zxa=function(a,c,b){var d=0;b&&b.index&&(d=b.index);this.qRa(a);a=this.$O(this,"delete",d,this.cQ(c),null);this.handleEvent("change",a)};a.Ib.prototype.$xa=function(a){var c=a.collection,b=a.l$(),d=null;c&&(d=this.cQ(c));a=this.$O(this,"update",b,d,this.Sma(null!=
d&&0<d.length?d[d.length-1]:null,a));this.handleEvent("change",a)};a.Ib.prototype.lxa=function(a){a=this.$O(this,"refresh",null,this.cQ(a),null);this.handleEvent("refresh",a)};a.Ib.prototype.Sma=function(g,c){var b=new a.t;b.add(c);return this.wia(b,g,0,1,[c])};a.Ib.prototype.cQ=function(g){var c=[],b=null;do b=this.TJa(g),null!==b&&(b!==a.Ib.V$&&c.unshift(b),g=this.IIa(b));while(null!=b);return c};a.Ib.V$="%!@ROOT%#@!";a.Ib.prototype.HP=function(g){var c=g instanceof a.U?this.tF(g).key:g;return g?
c:a.Ib.V$};a.Ib.prototype.FY=function(a){return this.mi[this.HP(a)]};a.Ib.prototype.woa=function(g,c){c.on(a.ta.fa.ADD,this.Yxa,this);c.on(a.ta.fa.REMOVE,this.Zxa,this);c.on(a.ta.fa.CHANGE,this.$xa,this);c.on(a.ta.fa.SYNC,this.lxa,this);var b=this.HP(g);this.mi[b]=c};a.Ib.prototype.qRa=function(a){a=this.HP(a);for(var c in this.mi)if(this.mi.hasOwnProperty(c)&&c===a){this.mi[a].off(null,null,this);delete this.mi[a];break}};a.Ib.prototype.GOa=function(a,c){for(var b=c.length,d=null,e=0;e<b;e++)if(d=
c.models[e])if(d=this.HP(d),a===d)return!0;return!1};a.Ib.prototype.IIa=function(a){for(var c in this.mi)if(this.mi.hasOwnProperty(c)){var b=this.mi[c];if(this.GOa(a,b))return b}return null};a.Ib.prototype.TJa=function(a){for(var c in this.mi)if(this.mi.hasOwnProperty(c)&&this.mi[c]===a)return c;return null};a.Ib.prototype.NM=function(a){var c=!0,b=this.FY(a);b||(c=!1,b=this.tWa(this.oM,a),null!=b&&(this.Dda(b),this.woa(a,b)));return{zb:b,h6:c}};a.Ib.prototype.$O=function(a,c,b,d,e){return{source:a,
operation:c,index:b,parent:d,data:e}};a.Ib.prototype.OF=function(a,c,b,d,e){var f=this;null===a&&((a=this.FY(null))?a={zb:a,h6:!0}:(a={zb:f.oM,h6:!1},f.woa(null,this.oM)));a&&f.Gga(a,c,b,function(a,g){a.Qb()&&(f.R5=!0);d.success&&d.success(f.wia(a,e,c,b,g))},d.error)};a.Ib.prototype.wia=function(g,c,b,d,e){return new a.Qh(c,g,e,this,b,d)};a.Ib.prototype.ESa=function(a,c){var b=this,d=Array(a.length);return new Promise(function(e){function f(a,c,g){a<c.length?c.at(a,{deferred:!0}).then(function(m){if(d[a]=
m){var p=b.tF(m);if(g===p.key){e({Ao:m,hs:d});return}}a++;f(a,c,g)}):e({Ao:null,hs:d})}f(0,a,c)})};a.Ib.prototype.N0=function(a,c,b,d,e){var f=this;return new Promise(function(h){f.ESa(a,d).then(function(a){function g(a,f,k){if(a<f.length){var r=k.NM(f[a]);r.zb?k.Gga(r,c,b,function(n){k.N0(n,c,b,d,e+1).then(function(b){b?h(b):(a++,g(a,f,k))})},null):(a++,g(a,f,k))}else h(null)}a.Ao?h({Ao:a.Ao,depth:e}):g(0,a.hs,f)})})};a.Ib.prototype.qia=function(a){function c(a,b,c){return new Promise(function(g,
k){function l(b){return new Promise(function(e,g){a.at(b).then(function(a){c[b]=a;e(b+1)},g)})}var m,p=Promise.resolve(0);for(m=0;m<b;m++)p=p.then(l);return p.then(g,k)})}if(a.Qb()){var b=Array(a.length);return new Promise(function(d){c(a,a.length,b).then(function(){d(b)})})}return new Promise(function(b){b(a.models)})};a.Ib.prototype.Gga=function(a,c,b,d,e){var f=this;a.h6?this.qia(a.zb).then(function(b){d(a.zb,b)}):(this.hB&&"none"!==this.hB&&(a.zb.eo=this.hB,a.zb.m9=this.DF),0<a.zb.length||!a.zb.Lxa()?
d(a.zb,a.zb.models):-1===b?(a.zb.modelLimit=-1,a.zb.fetch({success:function(a){f.qia(a).then(function(b){d(a,b)})},error:e})):(a.zb.modelLimit=-1,a.zb.BF(c,b).then(function(b){a.hs=b.models;d(a.zb,b.models)})))};a.Ib.prototype.fetchDescendants=function(g,c){this.R5&&a.C.Ze();var b=this;null===g?this.OF(null,0,-1,{success:function(a){a.d$({success:function(){c.success&&c.success(a)}})}},null):this.N0(this.oM,0,-1,g,0).then(function(a){a&&(a=b.NM(a.Ao),b.OF(a,0,-1,{success:function(a){a.d$({success:function(){c.success&&
c.success(a)}})}},g))})};a.f.j("CollectionTreeDataSource.prototype.fetchDescendants",{fetchDescendants:a.Ib.prototype.fetchDescendants});a.Ib.prototype.sort=function(a,c){var b=a.key,d=a.direction,e=!1;b!==this.hB&&(this.hB=b,e=!0);d!==this.DF&&(this.DF=d,e=!0);if(e){"none"===this.DF&&(this.mi={});for(var f in this.mi)this.mi.hasOwnProperty(f)&&this.Dda(this.mi[f])}c&&c.success&&c.success()};a.f.j("CollectionTreeDataSource.prototype.sort",{sort:a.Ib.prototype.sort});a.Ib.prototype.Dda=function(a){a.comparator=
this.hB;a.sortDirection="ascending"===this.DF?1:-1;a.sort()};a.Ib.prototype.getSortCriteria=function(){return{key:this.hB,direction:this.DF}};a.f.j("CollectionTreeDataSource.prototype.getSortCriteria",{getSortCriteria:a.Ib.prototype.getSortCriteria});a.Ib.prototype.move=function(){a.C.Ze()};a.f.j("CollectionTreeDataSource.prototype.move",{move:a.Ib.prototype.move});a.Ib.prototype.moveOK=function(){return"invalid"};a.f.j("CollectionTreeDataSource.prototype.moveOK",{moveOK:a.Ib.prototype.moveOK});a.Ib.prototype.getCapability=
function(a){return"sort"===a?"default":"move"===a?"none":"batchFetch"===a||"fetchDescendants"===a?"disable":null};a.f.j("CollectionTreeDataSource.prototype.getCapability",{getCapability:a.Ib.prototype.getCapability})});