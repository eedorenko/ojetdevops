/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","require","ojs/ojcomponentcore","ojs/ojdomscroller","ojs/ojanimation","promise","ojs/ojdataprovideradapter","ojs/ojkeyset"],function(t,e,i){t.DataSourceContentHandler=function(t,e,i){this.m_root=e,this.m_widget=t,this.m_fetching=!1,this.setDataSource(i),this.Init()},t.Object.createSubclass(t.DataSourceContentHandler,t.Object,"oj.DataSourceContentHandler"),t.DataSourceContentHandler.prototype.Init=function(){t.DataSourceContentHandler.superclass.Init.call(this)},t.DataSourceContentHandler.prototype.HandleResize=function(t,e){},t.DataSourceContentHandler.prototype.notifyShown=function(){},t.DataSourceContentHandler.prototype.notifyAttached=function(){},t.DataSourceContentHandler.prototype.Destroy=function(){null!=this.m_superRoot&&(this.m_root=this.m_superRoot),e(this.m_root).empty(),this.m_widget=null,this.m_root=null,this.m_superRoot=null},t.DataSourceContentHandler.prototype.IsReady=function(){return!this.m_fetching},t.DataSourceContentHandler.prototype.setRootAriaProperties=function(){this.shouldUseGridRole()?this.m_root.setAttribute("role","grid"):this.IsHierarchical()?this.m_root.setAttribute("role","tree"):this.m_root.setAttribute("role","listbox")},t.DataSourceContentHandler.prototype.RenderContent=function(){var t,i;this.signalTaskStart("rendering content"),this.setRootAriaProperties(),this.shouldUseGridRole()&&this.isCardLayout()&&!this.IsHierarchical()&&(t=document.createElement("li"),i=document.createElement("ul"),t.appendChild(i),e(t).attr("role","presentation").css("width","100%"),e(i).attr("role","row").addClass(this.m_widget.getGroupStyleClass()),this.m_root.appendChild(t),this.m_superRoot=this.m_root,this.m_root=i),this.fetchRows(!1),this.signalTaskEnd()},t.DataSourceContentHandler.prototype.GetKey=function(t){return t.key},t.DataSourceContentHandler.prototype.FindElementByKey=function(i){var n,s,o;for(n=e(this.m_root).find("."+this.m_widget.getItemElementStyleClass()),s=0;s<n.length;s++)if(o=n[s],i==this.GetKey(o)||t.Object.compareValues(i,this.GetKey(o)))return o;return null},t.DataSourceContentHandler.prototype.getDataSource=function(){return this.m_dataSource},t.DataSourceContentHandler.prototype.setDataSource=function(t){this.m_dataSource=t},t.DataSourceContentHandler.prototype.loadTemplateEngine=function(){var e=this;return null!=this.m_widget.getItemTemplate()&&null==this.m_widget._getItemRenderer()?new Promise(function(i,n){t.Config.__getTemplateEngine().then(function(t){e.m_engine=t,i(t)},function(t){throw"Error loading template engine: "+t})}):Promise.resolve(null)},t.DataSourceContentHandler.prototype.getTemplateEngine=function(){return this.m_engine},t.DataSourceContentHandler.prototype.fetchRows=function(t){this.m_widget.showStatusText()},t.DataSourceContentHandler.prototype.addItem=function(t,i,n,s,o,l){var r,a,h,c;return r=document.createElement("li"),e(r).uniqueId(),a=-1===i?null:i===(h=e(t).children("."+this.m_widget.getItemElementStyleClass()+", ."+this.m_widget.getEmptyTextStyleClass()+", .oj-listview-temp-item")).length?null:h[i],this.m_widget.BeforeInsertItem(),t.insertBefore(r,a),c=e(t).children().index(r),this._addOrReplaceItem(r,c,t,i,n,s,o,l)},t.DataSourceContentHandler.prototype.replaceItem=function(t,i,n,s,o,l){var r,a,h;this.signalTaskStart("replace item"),r=t.parentNode,a=e(r).children().index(t),h=document.createElement("li"),e(t).replaceWith(h),this._addOrReplaceItem(h,a,r,i,n,s,o,l)},t.DataSourceContentHandler.prototype._addOrReplaceItem=function(t,i,n,s,o,l,r,a){var h,c,d,u,m,p,g;return null==a&&(a=this.afterRenderItem.bind(this)),h=this.createContext(s,o,l,t),c=this.m_widget._getItemRenderer(),d=this.m_widget.getItemTemplate(),null!=c?null!=(u=c.call(this,h))&&(null===u.parentNode||u.parentNode instanceof DocumentFragment?t.appendChild(u):null!=u.parentNode||u.toString&&((m=document.createElement("span")).appendChild(document.createTextNode(u.toString())),t.appendChild(m))):null!=d&&null!=r?(p=this.m_widget.getRootElement()[0],g=this.GetBindingContext(h),r.execute(p,d,g).forEach(function(e){t.appendChild(e)})):((m=document.createElement("span")).appendChild(document.createTextNode(null==o?"":o.toString())),t.appendChild(m)),t=n.children?n.children[i]:this._getItemFromDocumentFragment(n,i),h.parentElement=t,e.data(t,"data",o),a(t,h),{item:t,context:h}},t.DataSourceContentHandler.prototype._getItemFromDocumentFragment=function(t,e){var i,n,s=0,o=0;for(i=t.childNodes;n=i[s++];)if(1===n.nodeType){if(o===e)return n;o++}return null},t.DataSourceContentHandler.prototype.GetBindingContext=function(t){var e,i,n;return(e={}).data=t.data,e.index=t.index,e.key=t.key,e.componentElement=t.componentElement,n={$current:e},null!=(i=this.m_widget.GetOption("as"))&&i.length>0&&(n[i]=e),n},t.DataSourceContentHandler.prototype.afterRenderItem=function(t,i){var n;t.key=i.key,(t=e(t)).uniqueId(),n=this.m_widget.getSingleFocusableElement(t),this.shouldUseGridRole()?null==i.leaf||i.leaf?this.isCardLayout()?n.attr("role","gridcell"):(t.attr("role","row"),n!=t?n.attr("role","gridcell"):n.children().wrapAll("<div role='gridcell' class='oj-listview-cell-element'></div>")):t.attr("role","presentation"):(n.attr("role",this.IsHierarchical()?"treeitem":"option"),n!=t&&t.attr("role","presentation")),n.addClass(this.m_widget.getFocusedElementStyleClass()),this.isFocusable(i)||t.addClass("oj-skipfocus"),t.addClass(this.m_widget.getItemElementStyleClass())},t.DataSourceContentHandler.prototype.createContext=function(t,e,i,n){var s,o;for(o in(s={}).parentElement=n,s.index=t,s.data=e,s.component=this.m_widget.getWidgetConstructor(),s.datasource=this.getDataSource(),s=this.m_widget._FixRendererContext(s),i)i.hasOwnProperty(o)&&(s[o]=i[o]);return s},t.DataSourceContentHandler.prototype.isFocusable=function(t){return this.m_widget.getItemFocusable(t)},t.DataSourceContentHandler.prototype.isSelectable=function(t){return this.m_widget.getItemSelectable(t)},t.DataSourceContentHandler.prototype.isCardLayout=function(){return this.m_widget.isCardLayout()},t.DataSourceContentHandler.prototype.shouldUseGridRole=function(){return this.m_widget.ShouldUseGridRole()},t.DataSourceContentHandler.prototype.isAsyncRendering=function(){return!1},t.DataSourceContentHandler.prototype.signalTaskStart=function(t){this.m_widget&&this.m_widget.signalTaskStart("DataSource ContentHandler "+t)},t.DataSourceContentHandler.prototype.signalTaskEnd=function(){this.m_widget&&this.m_widget.signalTaskEnd()},t.TreeDataSourceContentHandler=function(e,i,n){t.TreeDataSourceContentHandler.superclass.constructor.call(this,e,i,n)},t.Object.createSubclass(t.TreeDataSourceContentHandler,t.DataSourceContentHandler,"oj.TreeDataSourceContentHandler"),t.TreeDataSourceContentHandler.prototype.Init=function(){t.TreeDataSourceContentHandler.superclass.Init.call(this)},t.TreeDataSourceContentHandler.prototype.IsHierarchical=function(){return!0},t.TreeDataSourceContentHandler.prototype.fetchRows=function(e){this.signalTaskStart("fetching rows"),t.TreeDataSourceContentHandler.superclass.fetchRows.call(this,e),this.fetchChildren(0,null,this.m_root,null),this.signalTaskEnd()},t.TreeDataSourceContentHandler.prototype.fetchChildren=function(t,i,n,s){var o,l,r,a,h,c=this;this.signalTaskStart("fetching children from index: "+t),o=this.loadTemplateEngine(),null!=i&&(l=n.parentNode.firstElementChild.firstElementChild.firstElementChild)&&(l=e(l),r=this.m_widget.getCollapseIconStyleClass(),l.hasClass(r)&&(a=this.m_widget.getExpandingIconStyleClass(),l.removeClass(r).addClass(a))),this.m_fetching=!0,h={start:t,count:this.m_dataSource.getChildCount(i)},this.signalTaskStart("first fetch"),this.m_dataSource.fetchChildren(i,h,{success:function(t){o.then(function(e){c._handleFetchSuccess(t,i,n,s,e),c.signalTaskEnd()})},error:function(t){c._handleFetchError(t),c.signalTaskEnd()}}),this.signalTaskEnd()},t.TreeDataSourceContentHandler.prototype._handleFetchSuccess=function(i,n,s,o,l){var r,a,h,c,d,u,m,p,g=this;if(null!=this.m_widget){for(this.signalTaskStart("handling successful fetch"),(r=i.getStart())+(a=i.getCount()),h=document.createDocumentFragment(),c=0;c<a;c++)d=i.getData(r+c),u=i.getMetadata(r+c),this.addItem(h,-1,d,u,l);s.appendChild(h),this.shouldUseGridRole()&&this.isCardLayout()&&null!=n&&a>1&&(m=s.parentNode.firstElementChild.firstElementChild,e(m).attr("aria-colspan",a)),this.m_fetching=!1,p=function(){g.m_widget&&(null!=o&&o.call(null,s),g.m_widget.renderComplete())},this.isAsyncRendering()?t.Context.getContext(this.m_root).getBusyContext().whenReady().then(function(){p()}):p(),this.m_initialized=!0,this.signalTaskEnd()}},t.TreeDataSourceContentHandler.prototype.GetBindingContext=function(e){var i,n;return(n=(i=t.TreeDataSourceContentHandler.superclass.GetBindingContext.call(this,e)).$current).depth=e.depth,n.leaf=e.leaf,n.parentKey=e.parentKey,i},t.TreeDataSourceContentHandler.prototype.afterRenderItem=function(i,n){var s,o,l,r,a,h,c,d,u;this.signalTaskStart("after rendering an item"),t.TreeDataSourceContentHandler.superclass.afterRenderItem.call(this,i,n),s=this.m_widget.getGroupStyleClass(),o=this.m_widget.getItemStyleClass(),l=this.m_widget.getGroupItemStyleClass(!0),r=this.m_widget.getGroupCollapseStyleClass(),h=this.m_widget.getCollapseIconStyleClass(),a=this.m_widget.getFocusedElementStyleClass(),i=e(i),0==n.leaf?(i.children().wrapAll("<div></div>"),i.hasClass(a)?i.removeClass(a).children().first().addClass(a).attr("aria-expanded","false"):i.children().first().attr("role","presentation").find("."+a).attr("aria-expanded","false"),(c=i.children().first()).uniqueId().addClass(l),this.m_widget.isExpandable()&&(i.addClass("oj-collapsed"),d=document.createElement("a"),e(d).attr("href","#").attr("aria-labelledby",c.get(0).id).addClass("oj-component-icon oj-clickable-icon-nocontext").addClass(h),c.prepend(d)),this.shouldUseGridRole()&&(c.get(0).removeAttribute("aria-expanded"),c.removeClass(a),c.attr("role","row"),c.children().wrapAll("<div role='gridcell' aria-expanded='false' class='oj-listview-cell-element "+a+"'></div>")),u=document.createElement("ul"),e(u).addClass(s).addClass(r).attr("role",this.shouldUseGridRole()?this.isCardLayout()?"row":"presentation":"group"),i.append(u)):1==n.leaf&&i.addClass(o),this.m_widget._isSelectionEnabled()&&this.isSelectable(n)&&this.m_widget.getFocusItem(i).attr("aria-selected",!1),this.m_widget.itemRenderComplete(i[0],n),this.signalTaskEnd()},t.TreeDataSourceContentHandler.prototype._handleFetchError=function(e){null!=this.m_widget?(this.signalTaskStart("handling fetch error: "+e),t.Logger.error(e),this.m_widget.renderComplete(),this.signalTaskEnd()):t.Logger.info("handleFetchError: widget has already been destroyed")},t.TreeDataSourceContentHandler.prototype.Expand=function(t,e){var i,n;this.signalTaskStart("expanding an item"),i=this.GetKey(t[0]),n=t.children("ul")[0],this.fetchChildren(0,i,n,e),this.signalTaskEnd()},t.TreeDataSourceContentHandler.prototype.Collapse=function(t){t.empty()},t.StaticContentHandler=function(t,e){this.m_widget=t,this.m_root=e},t.Object.createSubclass(t.StaticContentHandler,t.Object,"oj.StaticContentHandler"),t.StaticContentHandler.prototype.Init=function(){t.StaticContentHandler.superclass.Init.call(this)},t.StaticContentHandler.prototype.Destroy=function(){this.m_root.hasAttribute("role")&&(this.restoreContent(this.m_root,0),this.unsetRootAriaProperties(),this.shouldUseGridRole()&&this.isCardLayout()&&!this.IsHierarchical()&&e(this.m_root).children().first().children().unwrap().children().unwrap())},t.StaticContentHandler.prototype.IsReady=function(){return!0},t.StaticContentHandler.prototype.HandleResize=function(t,e){},t.StaticContentHandler.prototype.notifyShown=function(){},t.StaticContentHandler.prototype.notifyAttached=function(){},t.StaticContentHandler.prototype.RenderContent=function(){var t=this.m_root;this.shouldUseGridRole()&&this.isCardLayout()&&!this.IsHierarchical()&&e(t).children("li").length>0&&(e(this.m_root).children().wrapAll("<li role='presentation' style='width:100%'><ul role='row' class='"+this.m_widget.getGroupStyleClass()+"'></ul></li>"),t=e(this.m_root).children("li").first().children("ul").first().get(0)),this.modifyContent(t,0),this.setRootAriaProperties(),this.m_widget.renderComplete()},t.StaticContentHandler.prototype.Expand=function(t,i){var n,s;n="."+this.m_widget.getGroupStyleClass(),s=e(t).children(n)[0],e(s).css("display",""),i.call(null,s)},t.StaticContentHandler.prototype.Collapse=function(t){},t.StaticContentHandler.prototype.IsHierarchical=function(){return null==this.m_hier&&(this.m_hier=e(this.m_root).children("li").children("ul").length>0),this.m_hier},t.StaticContentHandler.prototype.restoreContent=function(t,i){var n,s,o,l,r,a,h,c,d,u,m;for(n=this.m_widget.getGroupStyleClass(),s=this.m_widget.getGroupCollapseStyleClass(),o=this.m_widget.getGroupExpandStyleClass(),l=this.m_widget.getGroupItemStyleClass(!0),r=this.m_widget.getItemStyleClass(),a=this.m_widget.getItemElementStyleClass(),h=t.children,c=0;c<h.length;c++)(d=e(h[c])).hasClass(a)&&(this.unsetAriaProperties(d.get(0)),d.removeClass(a).removeClass(r).removeClass(this.m_widget.getDepthStyleClass(i)).removeClass("oj-skipfocus").removeClass("oj-focus").removeClass("oj-hover").removeClass("oj-expanded").removeClass("oj-collapsed").removeClass("oj-selected"),(u=d.children("ul")).length>0&&(d.children("."+l).children().unwrap(),this.shouldUseGridRole()&&this.unsetGroupAriaProperties(d),d.children(".oj-component-icon").remove(),(m=e(u[0])).removeClass(n).removeClass(o).removeClass(s).removeAttr("role"),this.restoreContent(m[0],i+1)))},t.StaticContentHandler.prototype.modifyContent=function(t,i){var n,s,o,l,r,a,h,c,d,u,m,p,g,_,f,C,S;for(n=this.m_widget.getItemStyleClass(),s=this.m_widget.getItemElementStyleClass(),o=this.m_widget.getGroupStyleClass(),l=this.m_widget.getGroupItemStyleClass(!0),r=this.m_widget.getGroupCollapseStyleClass(),a=this.m_widget.getCollapseIconStyleClass(),h=this.m_widget.getFocusedElementStyleClass(),c=t.children,d=this.m_widget.isExpandable(),u=0;u<c.length;u++)m=e(c[u]),p=this.createContext(m),this.setAriaProperties(m,p),m.uniqueId().addClass(s),i>0&&m.addClass(this.m_widget.getDepthStyleClass(i)),this.isFocusable(p)||m.addClass("oj-skipfocus"),(g=m.children("ul")).length>0?(this.m_hier=!0,m.children(":not(ul)").wrapAll("<div></div>"),(_=m.children().first()).addClass(l),(S=this.getItemsCount(g[0]))>0&&(m.hasClass(h)?(m.removeClass(h),_.addClass(h).attr("aria-expanded","false")):(_.attr("role","presentation"),_.find("."+h).attr("aria-expanded","false")),d&&(m.addClass("oj-collapsed"),_.uniqueId(),f=document.createElement("a"),e(f).attr("href","#").attr("role","button").attr("aria-labelledby",_.get(0).id).addClass("oj-component-icon oj-clickable-icon-nocontext").addClass(a),_.prepend(f))),this.shouldUseGridRole()&&this.setGroupAriaProperties(_,S),(C=e(g[0])).addClass(o).addClass(r).attr("role",this.shouldUseGridRole()?this.isCardLayout()?"row":"presentation":"group").css("display","none"),this.modifyContent(C[0],i+1)):m.addClass(n),this.m_widget._isSelectionEnabled()&&this.isSelectable(p)&&this.m_widget.getFocusItem(m).attr("aria-selected",!1),this.m_widget.itemRenderComplete(m[0],p)},t.StaticContentHandler.prototype.setRootAriaProperties=function(){this.shouldUseGridRole()?this.m_root.setAttribute("role","grid"):this.IsHierarchical()?this.m_root.setAttribute("role","tree"):this.m_root.setAttribute("role","listbox")},t.StaticContentHandler.prototype.unsetRootAriaProperties=function(){this.m_root.removeAttribute("role")},t.StaticContentHandler.prototype.getItemsCount=function(t){return e(t).children("li").length},t.StaticContentHandler.prototype.createContext=function(t){var e,i;return(e={}).key=t.attr("id"),e.parentElement=t.children().first()[0],e.index=t.index(),e.data=t[0],e.component=this.m_widget.getWidgetConstructor(),e=this.m_widget._FixRendererContext(e),this.IsHierarchical()&&(e.leaf=0==t.children("ul").length,i=t.parents("li."+this.m_widget.getItemElementStyleClass()),e.depth=i.length,0==i.length?e.parentKey=null:e.parentKey=i.first().attr("id")),e},t.StaticContentHandler.prototype.setAriaProperties=function(t,e){var i=this.m_widget.getSingleFocusableElement(t);this.shouldUseGridRole()?null==e.leaf||e.leaf?this.isCardLayout()?i.attr("role","gridcell"):(t.attr("role","row"),i!=t?i.attr("role","gridcell"):i.children().wrapAll("<div role='gridcell' class='oj-listview-cell-element'></div>")):(t.attr("role","presentation"),i!=t&&i.attr("role","gridcell")):(i.attr("role",this.IsHierarchical()?"treeitem":"option"),i!=t&&t.attr("role","presentation")),i.addClass(this.m_widget.getFocusedElementStyleClass())},t.StaticContentHandler.prototype.setGroupAriaProperties=function(t,e){var i=this.m_widget.getFocusedElementStyleClass();t.get(0).removeAttribute("aria-expanded"),t.removeClass(i),t.attr("role","row"),t.children().wrapAll("<div role='gridcell' aria-expanded='false' class='oj-listview-cell-element "+i+"'></div>"),this.isCardLayout()&&e>1&&t.children().first().attr("aria-colspan",e)},t.StaticContentHandler.prototype.unsetGroupAriaProperties=function(t){t.children("div").first().children().unwrap()},t.StaticContentHandler.prototype.unsetAriaProperties=function(t){var i=this.m_widget.getSingleFocusableElement(e(t));i.removeAttr("role"),i.removeAttr("aria-selected"),i.removeAttr("aria-expanded"),i.removeClass(this.m_widget.getFocusedElementStyleClass()),this.shouldUseGridRole()&&!this.isCardLayout()&&(i!=t?(e(t).removeAttr("role"),i.children().first().children().unwrap()):i.children().first().children().unwrap().children().unwrap())},t.StaticContentHandler.prototype.GetKey=function(t){return e(t).attr("id")},t.StaticContentHandler.prototype.FindElementByKey=function(t){return document.getElementById(t)},t.StaticContentHandler.prototype.isFocusable=function(t){return this.m_widget.getItemFocusable(t)},t.StaticContentHandler.prototype.isSelectable=function(t){return this.m_widget.getItemSelectable(t)},t.StaticContentHandler.prototype.isCardLayout=function(){return this.m_widget.isCardLayout()},t.StaticContentHandler.prototype.shouldUseGridRole=function(){return this.m_widget.ShouldUseGridRole()},t.KeyMap=function(){},t.KeyMap.prototype.set=function(t,e){var i;void 0===this._mapKeys&&void 0===this._mapValues&&(this._mapKeys=[],this._mapValues=[]),(i=this._mapKeys.indexOf(t))>-1?this._mapValues.splice(i,1,e):(this._mapKeys.push(t),this._mapValues.push(e))},t.KeyMap.prototype.get=function(t){var e;return this._mapKeys&&this._mapValues&&(e=this._mapKeys.indexOf(t))>-1&&this._mapValues.length>e?this._mapValues[e]:null},t.KeyMap.prototype.deleteValue=function(t){for(var e=this._mapValues.indexOf(t);e>-1;)this._mapValues.splice(e,1),this._mapKeys.splice(e,1),e=this._mapValues.indexOf(t,e)},t._ojListViewExpandedKeySet=function(){t._ojListViewExpandedKeySet.superclass.constructor.call(this)},t.Object.createSubclass(t._ojListViewExpandedKeySet,t.ExpandedKeySet,"ListViewExpandedKeySet");var n=function(i,n){var s=function(){};return t.Object.createSubclass(s,i,""),s.prototype=e.extend(s.prototype,n),s};t._ojListView=n(Object,{LEFT_KEY:37,RIGHT_KEY:39,DOWN_KEY:40,UP_KEY:38,TAB_KEY:9,ENTER_KEY:13,ESC_KEY:27,F2_KEY:113,SPACE_KEY:32,STATE_EXPANDED:0,STATE_COLLAPSED:1,STATE_NONE:2,MINIMUM_ITEM_HEIGHT:20,init:function(e){var i,n=this;this.readinessStack=[],this.element=e.element,this.ojContext=e.ojContext,this.OuterWrapper=e.OuterWrapper,this.options=e,this.element.uniqueId().addClass(this.GetStyleClass()+" oj-component-initnode"),this.OuterWrapper&&this.element[0].setAttribute("data-oj-context",""),this.signalTaskStart("Initializing"),this.SetRootElementTabIndex(),(i=this.GetDnDContext())&&(this.m_dndContext=i,this.ojContext._on(this.element,{dragstart:function(t){return i._handleDragStart(t)},dragenter:function(t){return i._handleDragEnter(t)},dragover:function(t){return i._handleDragOver(t)},dragleave:function(t){return i._handleDragLeave(t)},dragend:function(t){return n.m_preActive=!1,i._handleDragEnd(t)},drag:function(t){return i._handleDrag(t)},drop:function(t){return n.m_preActive=!1,i._handleDrop(t)}})),this.ojContext._on(this.element,{click:function(t){n.HandleMouseClick(t)},touchstart:function(t){n.HandleMouseDownOrTouchStart(t)},touchend:function(t){n.HandleTouchEndOrCancel(t)},touchcancel:function(t){n.HandleTouchEndOrCancel(t)},mousedown:function(t){0===t.button?n._recentTouch()||n.HandleMouseDownOrTouchStart(t):n.m_preActive=!0},mouseup:function(t){n._handleMouseUpOrPanMove(t),n.m_preActive=!1},mouseout:function(t){n._handleMouseOut(t)},mouseover:function(t){n._handleMouseOver(t)},keydown:function(t){n.HandleKeyDown(t)},keyup:function(t){n.HandleKeyUp(t)},ojpanmove:function(t){n._handleMouseUpOrPanMove(t)}}),this.ojContext._on(this.ojContext.element,{focus:function(t){n.HandleFocus(t)},blur:function(t){n.HandleBlur(t)}}),t.AgentUtils.getAgentInfo().browser===t.AgentUtils.BROWSER.FIREFOX&&this._getListContainer().attr("tabIndex",-1),this.ojContext._on(this.ojContext.element,{focusin:function(t){n.HandleFocus(t)},focusout:function(t){n.HandleFocusOut(t)}}),this._registerScrollHandler(),this.ojContext._focusable({applyHighlight:n.ShouldApplyHighlight(),recentPointer:n.RecentPointerCallback(),setupHandlers:function(t,e){n._focusInHandler=t,n._focusOutHandler=e}})},setupResources:function(){this.ojContext.document.bind("touchend.ojlistview touchcancel.ojlistview",this.HandleTouchEndOrCancel.bind(this)),this._initContentHandler(),this._registerResizeListener(this._getListContainer()[0])},releaseResources:function(){this.ojContext.document.off(".ojlistview"),this._destroyContentHandler(),this._unregisterResizeListener(this._getListContainer())},afterCreate:function(){this._buildList(),this.signalTaskEnd()},refresh:function(){this._resetInternal(),this.signalTaskStart("Refresh"),this.SetAriaProperties(),this._initContentHandler(),this._registerScrollHandler(),this.signalTaskEnd()},whenReady:function(){return this.readyPromise},destroy:function(){this.element.removeClass(this.GetStyleClass()+" oj-component-initnode"),this._unregisterResizeListener(this._getListContainer()),this._resetInternal(),t.DomUtils.unwrap(this.element,this._getListContainer())},_clearBusyState:function(){if(this.readinessStack&&this.readinessStack.length>0)for(t.Logger.warn("ListView did not end with a clean state, this could happen if ListView is detached before fetch is complete.  State: "+this.readinessStack);this.readinessStack.length>0;)this.signalTaskEnd()},_resetInternal:function(){var t=this;this.UnsetAriaProperties(),this._cleanupTabbableElementProperties(this.element),this._destroyContentHandler(),this.m_active=null,this.m_isExpandAll=null,this.m_disclosing=null,this.m_itemHeight=null,this.readyPromise=new Promise(function(e,i){t.readyResolve=e}),this.ClearCache(),null!=this.m_dndContext&&this.m_dndContext.reset()},notifyAttached:function(){null!=this.m_contentHandler&&(this.syncScrollPosition(),this.m_contentHandler.notifyAttached())},notifyDetached:function(){this._getListContainer().removeClass("oj-focus-ancestor"),null!=this.m_active&&e(this.m_active.elem).removeClass("oj-focus oj-focus-highlight"),null!=this.m_hoverItem&&this._unhighlightElem(this.m_hoverItem,"oj-hover")},notifyShown:function(){null!=this.m_contentHandler&&(this.syncScrollPosition(),this.m_contentHandler.notifyShown())},getNodeBySubId:function(t){var i,n,s,o;if(null==t)return this.element[0];if("oj-listview-disclosure"===(i=t.subId)||"oj-listview-icon"===i){if(null!=(n=t.key)&&null!=(s=this.FindElementByKey(n))&&(o=e(s).find(".oj-clickable-icon-nocontext").first(),this._isExpandCollapseIcon(o)))return o.get(0)}else if("oj-listview-item"===i&&null!=(n=t.key))return this.FindElementByKey(n);return null},getSubIdByNode:function(t){var e,i;return null!=t&&this._isExpandCollapseIcon(t)&&null!=(e=this.FindItem(t))&&e.length>0&&null!=(i=this.GetKey(e[0]))?{subId:"oj-listview-disclosure",key:i}:null},getContextByNode:function(t){var e,i,n,s;return null!=(e=this.FindItem(t))&&e.length>0&&null!=(i=this.GetKey(e[0]))?(s={subId:"oj-listview-item",key:i,index:(n=e.parent()).children("."+this.getItemElementStyleClass()).index(e)},n.get(0)!=this.element.get(0)&&(s.parent=n.parent().get(0)),e.children().first().hasClass(this.getGroupItemStyleClass())?s.group=!0:s.group=!1,s):null},getDataForVisibleItem:function(t){var i,n,s,o;return null!=(i=t.key)&&(o=this.FindElementByKey(i)),null==o&&(n=t.index,s=null==(s=t.parent)?this.element.get(0):e(s).children("ul."+this.getGroupStyleClass()).first(),o=e(s).children("li").get(n)),null!=o&&e(o).hasClass(this.getItemStyleClass())?this._getDataForItem(o):null},_getDataForItem:function(t){return null==this.GetOption("data")?t:e.data(t,"data")},_unregisterResizeListener:function(e){e&&this._resizeHandler&&t.DomUtils.removeResizeListener(e,this._resizeHandler)},_registerResizeListener:function(e){e&&(null==this._resizeHandler&&(this._resizeHandler=this.HandleResize.bind(this)),t.DomUtils.addResizeListener(e,this._resizeHandler))},GetDnDContext:function(){if(void 0!==t.ListViewDndContext)return new t.ListViewDndContext(this)},HandleResize:function(t,e){t>0&&e>0&&null!=this.m_contentHandler&&this.m_contentHandler.HandleResize(t,e)},ShouldApplyHighlight:function(){return!0},RecentPointerCallback:function(){return function(){return!1}},ShouldRefresh:function(t){return null!=t.data||null!=t.drillMode||null!=t.groupHeaderPosition||null!=t.item||null!=t.scrollPolicy||null!=t.scrollPolicyOptions},_isKeySet:function(t){return t.values&&t.isAddAll},setOptions:function(t,i){var n,s,o,l,r,a=this;if(this.ShouldRefresh(t))return!0;if(null!=t.expanded&&this.m_contentHandler.IsHierarchical())if(this._collapsedKeys=void 0,s=t.expanded,Array.isArray(s)||s.values){this.signalTaskStart("Set expanded option"),this._collapseAll(),this._ignoreExpanded=!0;try{(this._isKeySet(s)?s.values():s).forEach(function(t){a.expandKey(t,!0,!0,!0)})}finally{this._ignoreExpanded=void 0,this.signalTaskEnd()}}else if("all"===s||s.deletedValues)return!0;return null!=t.currentItem?null!=(n=this.FindElementByKey(t.currentItem))&&(n=e(n),this.SkipFocus(n)||((o=document.activeElement)&&this.element.get(0).contains(o)?this.ActiveAndFocus(n,null):this._setActive(n,null,!0))):null===t.currentItem&&(this.UnhighlightActive(),this.m_active=null,this.SetRootElementTabIndex()),this.HandleSelectionOption(t),null!=t.selectionMode&&(this._clearSelection(!0),this.SetAriaProperties(),this.UpdateItemAriaProperties(t.selectionMode)),null!=t.scrollTop&&(l=this._getScroller(),null==(r=t.scrollTop)||isNaN(r)||(l.scrollTop=r)),null!=t.scrollPosition&&(this._setCurrentScrollPosition(t.scrollPosition),delete t.scrollPosition),this._shouldDragSelectedItems()&&null!=this.m_active&&null!=t.dnd&&null!=t.dnd.reorder&&("enabled"===t.dnd.reorder.items?this.m_dndContext._setItemDraggable(this.m_active.elem):"disabled"===t.dnd.reorder.items&&this.m_dndContext._unsetItemDraggable(this.m_active.elem)),!1},HandleSelectionOption:function(t){var e,i,n;if(null!=t.selection&&this._isSelectionEnabled())for(t.selection=this._filterSelection(t.selection),i=t.selection,this._clearSelection(!1),n=0;n<i.length;n++)null!=(e=this.FindElementByKey(i[n]))&&this._applySelection(e,i[n])},Trigger:function(t,e,i){return this.ojContext._trigger(t,e,i)},SetOption:function(t,e,i){this.ojContext.option(t,e,i)},GetOption:function(t){return this.ojContext.option(t)},_getBusyDescription:function(t){return"The component identified by '"+(this.ojContext._IsCustomElement()?this.getRootElement().attr("id"):this.element.attr("id"))+"', "+t},signalTaskStart:function(e){var i,n,s=this;this.readinessStack&&(0==this.readinessStack.length&&(this.readyPromise=new Promise(function(t,e){s.readyResolve=t}),i=t.Context.getContext(this.element[0]).getBusyContext(),n=null!=e?{description:this._getBusyDescription(e)}:{},s.busyStateResolve=i.addBusyState(n)),this.readinessStack.push(null!=e?e:"unknown task"))},signalTaskEnd:function(){this.readinessStack&&this.readinessStack.length>0&&(this.readinessStack.pop(),0==this.readinessStack.length&&(this.readyResolve(null),this.busyStateResolve(null),this.busyStateResolve=null))},isReady:function(){return null==this.busyStateResolve},throwError:function(t){if(this.readinessStack)for(;this.readinessStack.length>0;)this.signalTaskEnd();throw t},getItems:function(t){var i,n=this,s=[];return e.each(t,function(t,e){null!=(i=n.FindElementByKey(e))&&s.push(i)}),s},isCardLayout:function(){return(this.ojContext._IsCustomElement()?this.getRootElement():this.element).hasClass("oj-listview-card-layout")},ShouldUseGridRole:function(){return!0},ShouldUpdateScrollPosition:function(){return this.ShouldUseGridRole()&&this.ojContext._IsCustomElement()},_destroyContentHandler:function(){null!=this.m_contentHandler&&(this.m_contentHandler.Destroy(),delete this.m_contentHandler,this.m_contentHandler=null),this._clearBusyState()},_initContentHandler:function(){var e;this.signalTaskStart("Initialize ContentHandler"),this.showStatusText(),null!=(e=this.GetOption("data"))?void 0!==t.TableDataSource&&e instanceof t.TableDataSource?this.m_contentHandler=new t.IteratingDataProviderContentHandler(this,this.element[0],new t.TableDataSourceAdapter(e)):void 0!==t.TreeDataSource&&e instanceof t.TreeDataSource?this.m_contentHandler=new t.TreeDataSourceContentHandler(this,this.element[0],e):t.DataProviderFeatureChecker.isIteratingDataProvider(e)?this.m_contentHandler=new t.IteratingDataProviderContentHandler(this,this.element[0],e):this.throwError("Invalid data or missing module"):this.m_contentHandler=new t.StaticContentHandler(this,this.element[0]),this.m_contentHandler.RenderContent(),this.signalTaskEnd()},UpdateActiveDescendant:function(t){this.element.attr("aria-activedescendant",t.attr("id"))},SetAriaProperties:function(){this._isMultipleSelection()?this.element.attr("aria-multiselectable",!0):this._isSelectionEnabled()&&this.element.attr("aria-multiselectable",!1)},UnsetAriaProperties:function(){this.element.removeAttr("aria-activedescendant").removeAttr("aria-multiselectable")},UpdateItemAriaProperties:function(t){var i,n,s,o=this;for("none"==t?(this.element.removeAttr("aria-multiselectable"),i=function(t){o.getFocusItem(t).removeAttr("aria-selected")}):("single"==t?this.element.attr("aria-multiselectable",!1):this.element.attr("aria-multiselectable",!0),i=function(t){o.getFocusItem(t).attr("aria-selected","false")}),n=this._getItemsCache(),s=0;s<n.length;s++)i(e(n[s]))},_buildList:function(t){var e,i,n;e=this._getListContainer(),this.SetAriaProperties(),this.m_elementOffset=this.element.get(0).offsetTop,i=this._buildStatus(),e.append(i),this.m_status=i,n=this._buildAccInfo(),e.append(n),this.m_accInfo=n,this._isTouchSupport()&&null!=this.m_dndContext&&e.append(this._buildAccInstructionText())},_buildStatus:function(){var t,i;return(t=e(document.createElement("div"))).addClass("oj-icon oj-listview-loading-icon"),(i=e(document.createElement("div"))).addClass("oj-listview-status-message oj-listview-status").attr({id:this._createSubId("status"),role:"status"}),i.append(t),i},_buildAccInfo:function(){var t=e(document.createElement("div"));return t.addClass("oj-helper-hidden-accessible").attr({id:this._createSubId("info"),role:"status"}),t},_buildAccInstructionText:function(){var t=e(document.createElement("div"));return t.addClass("oj-helper-hidden-accessible").attr({id:this._createSubId("instr")}),t.text(this.ojContext.getTranslatedString("accessibleReorderTouchInstructionText")),t},_setAccInfoText:function(t){""!=t&&this.m_accInfo.text()!=t&&this.m_accInfo.text(t)},showStatusText:function(){var t,i,n,s,o=this;this.m_showStatusTimeout||(this.m_showStatusTimeout=setTimeout(function(){e(document.getElementById(o._createSubId("empty"))).remove(),t=o.ojContext.getTranslatedString("msgFetchingData"),n=o._getListContainer(),o.m_status.attr("aria-label",t).css("left",Math.max(0,n.outerWidth()/2-o.m_status.outerWidth()/2)).css("top",Math.max(0,n.outerHeight()/2-o.m_status.outerHeight()/2)).show(),void 0===o.m_minHeightSet&&(i=o.m_status.get(0).offsetHeight,s=n.get(0).offsetHeight,n.css("minHeight",Math.max(s,i+o._getListContainerBorderWidth())),o.m_minHeightSet=!0),o.m_showStatusTimeout=null},this._getShowStatusDelay()))},_getShowStatusDelay:function(){var e;return null==this.defaultOptions&&(this.defaultOptions=t.ThemeUtils.parseJSONFromFontFamily(this.getOptionDefaultsStyleClass())),e=parseInt(this.defaultOptions.showIndicatorDelay,10),isNaN(e)?0:e},hideStatusText:function(){this.m_showStatusTimeout&&(clearTimeout(this.m_showStatusTimeout),this.m_showStatusTimeout=null),this.m_status.hide()},getRootElement:function(){return this._getListContainer()},_getListContainer:function(){return null==this.m_container&&(this.m_container=this._createListContainer()),this.m_container},_createListContainer:function(){var t;return this.OuterWrapper?t=e(this.OuterWrapper):(t=e(document.createElement("div")),this.element.parent()[0].replaceChild(t[0],this.element[0])),t.addClass(this.GetContainerStyleClass()).addClass("oj-component"),t.prepend(this.element),t},_getEmptyText:function(){return this.ojContext.getTranslatedString("msgNoData")},_buildEmptyText:function(){var t,e;return t=this._getEmptyText(),(e=document.createElement("li")).id=this._createSubId("empty"),e.className=this.getEmptyTextStyleClass()+" "+this.getEmptyTextMarkerClass(),e.textContent=t,e},GetState:function(t){var e=this.getFocusItem(t).attr("aria-expanded");return"true"==e?this.STATE_EXPANDED:"false"==e?this.STATE_COLLAPSED:this.STATE_NONE},SetState:function(t,e){var i=this.isExpandable();e==this.STATE_EXPANDED?(this.getFocusItem(t).attr("aria-expanded","true"),i&&t.removeClass("oj-collapsed").addClass("oj-expanded")):e==this.STATE_COLLAPSED&&(this.getFocusItem(t).attr("aria-expanded","false"),i&&t.removeClass("oj-expanded").addClass("oj-collapsed"))},_getItemOption:function(t,e,i){var n;return"function"==typeof(n=this.GetOption("item")[t])&&i?n.call(this,e):n},getItemFocusable:function(t){return this._getItemOption("focusable",t,!0)},getItemSelectable:function(t){return this.getItemFocusable(t)&&this._getItemOption("selectable",t,!0)},_getItemRenderer:function(){var t=this._getItemOption("renderer",null,!1);return"function"!=typeof t?null:this._WrapCustomElementRenderer(t)},getItemTemplate:function(){var e;return void 0===this.m_template&&(this.m_template=null,this.ojContext._IsCustomElement()&&(e=t.BaseCustomElementBridge.getSlotMap(this.getRootElement()[0]).itemTemplate)&&e.length>0&&"template"===e[0].tagName.toLowerCase()&&(this.m_template=e[0])),this.m_template},itemInsertComplete:function(t,e){},BeforeInsertItem:function(){},itemRemoveComplete:function(t){if(null!=this.m_active&&this.m_active.elem&&e(this.m_active.elem).get(0)==t){var i=t.nextElementSibling;null!=i&&e(i).hasClass(this.getItemElementStyleClass())||null!=(i=t.previousElementSibling)&&e(i).hasClass(this.getItemElementStyleClass())||this.SetOption("currentItem",null),null!=i&&e(i).hasClass(this.getItemElementStyleClass())&&this.SetOption("currentItem",this.GetKey(i))}null!=t&&t.id&&null!=this.m_keyElemMap&&this.m_keyElemMap.deleteValue(t.id)},itemRenderComplete:function(i,n){var s,o,l,r,a,h,c,d;if(null!=this.m_dndContext&&this.m_dndContext.itemRenderComplete(i),this._disableAllTabbableElements(i),s=n.key,this._isSelectionEnabled())if(o=this.GetOption("selection"),this.IsSelectable(i)){for(r=0;r<o.length;r++)if((o[r]==s||t.Object.compareValues(o[r],s))&&(this._applySelection(i,o[r]),!this._isMultipleSelection())){o.length>1&&(l=this.FindElementByKey(s),this._setSelectionOption([s],null,l,n.data));break}0==o.length&&this._isSelectionRequired()&&(this._applySelection(i,s),this._setSelectionOption([s],null,[i],n.data))}else if((a=this.GetIndexOf(o,s))>-1){for((h=o.slice(0)).splice(a,1),l=new Array(h.length),r=0;r<h.length;r++)l[r]=this.FindElementByKey(h[r]);this._setSelectionOption(h,null,l)}this.m_contentHandler.IsHierarchical()&&null==this._ignoreExpanded&&this.GetState(e(i))==this.STATE_COLLAPSED&&(c=this.GetOption("expanded"),this._isExpandAll()?(this.ojContext._IsCustomElement()||null==this._collapsedKeys)&&this.ExpandItem(e(i),null,!1,null,!1,!1,!1):!this.ojContext._IsCustomElement()&&Array.isArray(c)?(d=this,e.each(c,function(t,n){n!=s||null!=d._collapsedKeys&&-1!=d._collapsedKeys.indexOf(n)||d.ExpandItem(e(i),null,!1,null,!1,!1,!1)})):c.has&&c.has(s)&&this.ExpandItem(e(i),null,!1,null,!1,!1,!1)),null!=this.m_active&&s==this.m_active.key&&null!=this.m_active.elem&&i!=this.m_active.elem.get(0)&&(this.m_active.elem=e(i))},renderComplete:function(){var t,i,n,s;if(this.hideStatusText(),e(document.getElementById(this._createSubId("empty"))).remove(),this.m_items=null,this.m_groupItems=null,0==this.element[0].childElementCount)return t=this._buildEmptyText(),this.element.append(t),void this.Trigger("ready",null,{});this.ShouldUpdateScrollPosition()&&null==this.m_itemHeight&&(this.m_contentHandler.IsHierarchical()?(i=this.element.children("li."+this.getItemElementStyleClass()).first()).length>0&&(this.m_itemHeight=i.get(0).firstElementChild.offsetHeight):(i=e(this._getRootNodeForItems()).children("li."+this.getItemStyleClass()).first()).length>0&&(this.m_itemHeight=i.get(0).offsetHeight)),null!=(n=this.GetOption("currentItem"))&&(null==(s=this.FindElementByKey(n))?this.SetOption("currentItem",null):null!=this.m_active||this.SkipFocus(e(s))||this.ActiveAndFocus(e(s),null)),this._getListContainer().hasClass("oj-focus-ancestor")&&null==this.m_active&&null==n&&this._initFocus(),this.m_scrollAndFetch=void 0,this.m_ticking&&null==this.m_scrollPosition||this.syncScrollPosition(),this.Trigger("ready",null,{})},_setScrollY:function(t,e){this._skipScrollUpdate||this.signalTaskStart("waiting for scroll handler"),this._skipScrollUpdate=!0,t.scrollTop=e,this._handlePinGroupHeader()},_setScrollX:function(e,i){this._skipScrollUpdate||this.signalTaskStart("waiting for scroll handler"),this._skipScrollUpdate=!0,t.DomUtils.setScrollLeft(e,i)},_getScrollX:function(e){return t.DomUtils.getScrollLeft(e)},syncScrollPosition:function(t){var e,i,n,s,o,l,r;if((e=this._getScroller()).scrollHeight!=e.clientHeight)if(this.ShouldUpdateScrollPosition()&&(null!=this.m_scrollPosition?t=this.m_scrollPosition:void 0===t&&(t=this.GetOption("scrollPosition")),n=(i=this._getScrollCoordinates(t)).x,s=i.y,isNaN(n)&&isNaN(s)))null!=this.m_scrollPosition&&(this.SetOption("scrollPosition",this._getCurrentScrollPosition(o),{_context:{originalEvent:null,internalSet:!0}}),this.signalTaskEnd(),this.m_scrollPosition=null);else{if(void 0===i&&(s=this.GetOption("scrollTop")),o=e.scrollTop,!isNaN(n)&&isNaN(s)||!isNaN(n)&&s==o&&n!=this._getScrollX(e,n))this._setScrollX(e,n),l=this.GetOption("scrollPosition"),r={x:n=this._getScrollX(e),y:l.y,index:l.index,key:l.key,offsetX:n,offsetY:l.offsetY},l.parent&&(r.parent=l.parent),this.SetOption("scrollPosition",r,{_context:{originalEvent:null,internalSet:!0}});else if(s!=o){if(this._setScrollY(e,s),isNaN(n)||n==this._getScrollX(e,n)||this._setScrollX(e,n),o=e.scrollTop,Math.abs(o-s)>=1&&this.m_contentHandler.hasMoreToFetch&&this.m_contentHandler.hasMoreToFetch())return null==this.m_scrollPosition&&this.signalTaskStart("Scroll position needs to resolve further"),this.m_scrollAndFetch=!0,void(this.m_scrollPosition=t);this.SetOption("scrollPosition",this._getCurrentScrollPosition(o),{_context:{originalEvent:null,internalSet:!0}})}else t&&(null==t.key||isNaN(t.index))&&this.SetOption("scrollPosition",this._getCurrentScrollPosition(o),{_context:{originalEvent:null,internalSet:!0}});null!=this.m_scrollPosition&&(this.signalTaskEnd(),this.m_scrollPosition=null)}},restoreCurrentItem:function(){var t=this.GetOption("currentItem");if(null!=t){var i=this.FindElementByKey(t);null==i||this.SkipFocus(e(i))||this.ActiveAndFocus(e(i),null)}},ClearCache:function(){this.m_items=null,this.m_groupItems=null},StartAnimation:function(e,i,n){return null==n&&(n=this.getAnimationEffect(i)),t.AnimationUtils.startAnimation(e,i,n,this.ojContext)},notifyContextMenuGesture:function(t,i,n){var s,o,l;if(this.IsNodeEditableOrClickable(e(i.target)))return!1;s=e(i.target).closest("."+this.getItemElementStyleClass()),this.PrepareContextMenu(s),s.length>0&&!this.SkipFocus(e(s[0]))&&this.SetCurrentItem(e(s[0]),null),l=this.element,2===i.button?l=this._findItem(e(i.target)):null!=this.m_active&&(l=this.m_active.elem),o={launcher:l,initialFocus:"menu"},"keyboard"===n&&(o.position={my:"start top",at:"start bottom",of:this.m_active.elem}),this.ojContext._OpenContextMenu(i,n,o)},PrepareContextMenu:function(t){null!=this.m_dndContext&&this.m_dndContext.prepareContextMenu(this.ojContext._GetContextMenu())},IsElementEditableOrClickable:function(t){return null!=t.prop("nodeName").match(/^INPUT|SELECT|OPTION|BUTTON|^A\b|TEXTAREA/)},IsNodeEditableOrClickable:function(t){for(;null!=t&&t[0]!=this.element[0]&&"LI"!=t.prop("nodeName");)if(3!=t[0].nodeType){var e=t.attr("tabIndex"),i=t.attr("data-oj-tabindex");if(null!=e&&e>=0&&!t.hasClass(this.getFocusedElementStyleClass())&&!t.hasClass("oj-listview-cell-element"))return!0;if(this.IsElementEditableOrClickable(t)&&(-1!=e||-1!=i))return!0;t=t.parent()}else t=t.parent();return!1},_disableAllTabbableElements:function(t,i){var n,s;(n=e(t)).hasClass(this.getItemStyleClass())||(n=e(n.get(0).firstElementChild)),n.children().first().hasClass("oj-listview-cell-element")&&(n=e(n.get(0).firstElementChild)),n.find("a, input, select, textarea, button, object, .oj-component-initnode, [tabIndex]").each(function(t){e(this).removeAttr("data-first").removeAttr("data-last"),s=parseInt(e(this).attr("tabIndex"),10),!(isNaN(s)||s>=0)||void 0!==i&&this==document.activeElement||e(this).attr("tabIndex",-1).attr("data-tabmod",isNaN(s)?-1:s)})},_disableAllTabbableElementsBeforeItem:function(t){var e,i,n;for(i=(e=this._getItemsCache()).index(t),n=0;n<=i;n++)this._disableAllTabbableElements(e[n],!0)},_disableAllTabbableElementsAfterItem:function(t){var e,i,n;if(-1!=(i=(e=this._getItemsCache()).index(t)))for(n=i;n<=e.length-1;n++)this._disableAllTabbableElements(e[n],!0)},_enableAllTabbableElements:function(t){var i,n;(i=(i=e(t).find("[data-tabmod]").each(function(t){n=parseInt(e(this).attr("data-tabmod"),10),e(this).removeAttr("data-tabmod"),-1==n?e(this).removeAttr("tabIndex"):e(this).attr("tabIndex",n)})).filter(":visible")).first().attr("data-first","true"),i.last().attr("data-last","true")},_cleanupTabbableElementProperties:function(t){e(t).find("[data-tabmod]").removeAttr("tabIndex").removeAttr("data-tabmod").removeAttr("data-first").removeAttr("data-last")},SkipFocus:function(t){return t.hasClass("oj-skipfocus")},GetFocusElement:function(){var t;if(this._getListContainer().hasClass("oj-focus-ancestor")){if(this.m_active)return this.getFocusItem(this.m_active.elem)[0];if((t=this.element.children("."+this.getEmptyTextStyleClass()).first()).length>0&&0==t.attr("tabIndex"))return t[0]}return this.element[0]},_isFocusBlurTriggeredByDescendent:function(t){return void 0===t.relatedTarget||!(null==t.relatedTarget||!e.contains(this.ojContext.element.get(0),t.relatedTarget))},HandleFocus:function(t){var i;this._getListContainer().addClass("oj-focus-ancestor"),null==this.m_active?(i=this._findItem(e(t.target)),this.m_preActive||this._isFocusBlurTriggeredByDescendent(t)||null!=i&&!this.SkipFocus(i)||this._initFocus(t)):(this.m_preActive||t.target!==this.ojContext.element[0]||this._isFocusBlurTriggeredByDescendent(t)||(this.HighlightActive(),this._focusItem(this.m_active.elem)),this.RemoveRootElementTabIndex(),this._setTabIndex(this.m_active.elem))},_initFocus:function(t){var i,n,s,o;for(i=this._getItemsCache(),n=0;n<i.length;n++)if(s=e(i[n]),!this.SkipFocus(s)){this.SetCurrentItem(s,t);break}0==i.length&&(o=this.element.children("."+this.getEmptyTextStyleClass()).first()).length>0&&(o.attr("tabIndex",0),o.focus(),this.RemoveRootElementTabIndex())},HandleFocusOut:function(t){this.HandleBlur(t)},_supportRelatedTargetOnBlur:function(){var e=t.AgentUtils.getAgentInfo();return!(e.browser==t.AgentUtils.BROWSER.FIREFOX&&parseInt(e.browserVersion,10)<48)},_isExtraBlurEvent:function(e){var i=t.AgentUtils.getAgentInfo();return null==e.relatedTarget&&i.browser==t.AgentUtils.BROWSER.IE&&e.target==this.ojContext.element.get(0)},HandleBlur:function(t){this._supportRelatedTargetOnBlur()&&!this._isExtraBlurEvent(t)&&(this._isFocusBlurTriggeredByDescendent(t)||this.m_preActive||this._doBlur(),this._isExpandCollapseIcon(t.target)&&this._focusOutHandler(e(t.target)))},_doBlur:function(){var t;this._getListContainer().removeClass("oj-focus-ancestor"),this.UnhighlightActive(),null!=this.m_active?(this._resetTabIndex(this.m_active.elem),this._removeSkipItemAriaLabel(this.m_active.elem)):(t=this.element.children("."+this.getEmptyTextStyleClass()).first()).length>0&&t.removeAttr("tabIndex"),this.SetRootElementTabIndex()},_handleMouseOut:function(t){var e=this.FindItem(t.target);null!=e&&(this.m_hoverItem=null,this._unhighlightElem(e,"oj-hover"))},_handleMouseOver:function(t){if(!this._recentTouch()){var e=this.FindItem(t.target);null==e||this.SkipFocus(e)||(this.m_hoverItem=e,this._highlightElem(e,"oj-hover"))}},_recentTouch:function(){return Date.now()-this._lastTouch<500},HandleKeyDown:function(t){var e,i,n;if(this.isExpandable()&&((e=t.keyCode)===this.LEFT_KEY||e===this.RIGHT_KEY))if(i=this.m_active.elem,e===this.LEFT_KEY){if(this.GetState(i)==this.STATE_EXPANDED)return void this.CollapseItem(i,t,!0,this.m_active.key,!0,!0)}else if(this.GetState(i)==this.STATE_COLLAPSED)return void this.ExpandItem(i,t,!0,this.m_active.key,!0,!0,!0);n=this.HandleSelectionOrActiveKeyDown(t),null!=this.m_dndContext&&(n=n||this.m_dndContext.HandleKeyDown(t)),!0===n&&t.preventDefault(),this.m_keyProcessed=n},HandleKeyUp:function(t){t.keyCode==this.ESC_KEY&&this.m_keyProcessed&&t.stopPropagation(),this.m_keyProcessed=void 0},_handleMouseUpOrPanMove:function(t){this.m_preActiveItem&&this._unhighlightElem(this.m_preActiveItem,"oj-focus"),null!=this.m_dndContext&&this.m_dndContext._unsetDraggable(e(t.target))},HandleMouseDownOrTouchStart:function(t){var i,n;n=e(t.target),null!=this.m_dndContext&&this.m_dndContext._setDraggable(n),null!=(i=this._findItem(n,!0))&&this._isClickthroughDisabled(i)&&(this.m_preActive=!0,i=null),null==i||0==i.length||this.SkipFocus(i)||n.hasClass("oj-listview-drag-handle")||(this.m_preActive=!0,this._getListContainer().hasClass("oj-focus-ancestor")||this._getListContainer().addClass("oj-focus-ancestor"),this.m_preActiveItem=i,this._highlightElem(i,"oj-focus"),this._makeFocusable(i),i.get(0).contains(document.activeElement)||this._focusItem(i),this.RemoveRootElementTabIndex(),null!=this.m_active&&this.m_active.elem.get(0)!=i.get(0)&&this._resetTabIndex(this.m_active.elem),t.originalEvent.touches&&t.originalEvent.touches.length>0&&(this.m_touchPos={x:t.originalEvent.changedTouches[0].pageX,y:t.originalEvent.changedTouches[0].pageY}))},HandleTouchEndOrCancel:function(t){var e,i,n,s;null!=this.m_preActiveItem&&(this._unhighlightElem(this.m_preActiveItem,"oj-focus"),null!=this.m_touchPos&&(e=this.m_preActiveItem.offset(),(i=this.getAnimationEffect("pointerUp")).offsetX=this.m_touchPos.x-e.left+"px",i.offsetY=this.m_touchPos.y-e.top+"px",n=(s=this.m_preActiveItem.children("."+this.getGroupItemStyleClass())).length>0?s.get(0):this.getFocusItem(this.m_preActiveItem).get(0),this.StartAnimation(n,"pointerUp",i),this.m_touchPos=null)),this._lastTouch=Date.now(),this._handleMouseOut(t)},_enterActionableMode:function(){var t;t=this.m_active.elem,this._disableAllTabbableElements(t),this._enableAllTabbableElements(t),t.find("[data-first]").length>0&&this._setActionableMode(!0)},_exitActionableMode:function(){this._setActionableMode(!1),this._disableAllTabbableElements(this.m_active.elem)},HandleMouseClick:function(t){var i,n,s,o,l;if(0===t.button)if(i=this.getCollapseIconStyleClass(),n=this.getExpandIconStyleClass(),s=this.getGroupItemStyleClass(),(o=e(t.target)).hasClass(n))this._collapse(t),t.preventDefault();else if(o.hasClass(i))this._expand(t),t.preventDefault();else{if(null==(l=this._findItem(o))||0==l.length||this.SkipFocus(l))return;if(this._isActionableMode()&&null!=this.m_active&&this.m_active.elem.get(0)!=l.get(0)&&this._exitActionableMode(),this._getListContainer().hasClass("oj-focus-ancestor")||this._getListContainer().addClass("oj-focus-ancestor"),this._isSelectionEnabled()&&this.IsSelectable(l[0])?(this._isTouchSupport()?this._handleTouchSelection(l,t):this.HandleClickSelection(l,t),this.ShouldUseGridRole()&&t.target==l.get(0)&&this._focusItem(l),this._shouldDragSelectedItems()&&this.m_dndContext.setSelectionDraggable()):this.HandleClickActive(l,t),this._isInputElement(o.get(0)))return void this._enterActionableMode();this.isExpandable()&&o.closest("."+s)&&(this.GetState(l)==this.STATE_COLLAPSED?this._expand(t):this.GetState(l)==this.STATE_EXPANDED&&this._collapse(t))}},_shouldDragSelectedItems:function(){return null!=this.m_dndContext&&!this.m_dndContext.shouldDragCurrentItem()},_isTouchSupport:function(){return t.DomUtils.isTouchSupported()},_isNonWindowTouch:function(){return this._isTouchSupport()&&t.AgentUtils.getAgentInfo().os!=t.AgentUtils.OS.WINDOWS},_ctrlEquivalent:function(e){return t.DomUtils.isMetaKeyPressed(e)},_createSubId:function(t){return[this.element.attr("id"),t].join(":")},FindItem:function(t){return e(t).closest("."+this.getItemElementStyleClass())},_isClickthroughDisabled:function(t){return t.hasClass("oj-clickthrough-disabled")},_findItem:function(t,e){for(var i=t;i.length>0;){if(this._isClickthroughDisabled(i))return e?i:null;if(i.hasClass(this.getItemElementStyleClass()))return i;i=i.parent()}return null},_getListContainerBorderWidth:function(){return null==this.m_borderWidth&&(this.m_borderWidth=parseInt(this._getListContainer().css("border-top-width"),10)+parseInt(this._getListContainer().css("border-bottom-width"),10)),this.m_borderWidth},scrollToItem:function(t){var i,n,s;null!=(i=t.key)&&null!=(n=this.FindElementByKey(i))&&(e(n).hasClass(this.getItemStyleClass())?this._scrollToVisible(n):(s=e(n).children("."+this.getGroupItemStyleClass()).first(),this._scrollToGroupHeader(s.get(0))))},_scrollToVisible:function(t){var i,n,s,o,l,r,a,h,c=0;i=t.offsetTop,n=t.offsetHeight,o=(s=this._getListContainer()[0]).scrollTop,l=s.offsetHeight,null!=this.m_groupItemToPin&&(r=parseInt(this.m_groupItemToPin.style.top,10),a=e(this.m_groupItemToPin).outerHeight(),i<=r&&r<i+n?c=(n+i-r)/2:i>=r&&i<r+a&&(c=(r+a-i)/2)),i>=o&&i+n<=o+l?c>0&&(s.scrollTop=o-c):((h=Math.max(0,Math.min(i-c,Math.abs(i+n-l))))>o&&(h+=this._getListContainerBorderWidth()),s.scrollTop=h)},GetKey:function(t){return this.m_contentHandler.GetKey(t)},FindElementByKey:function(t){var e;return null!=this.m_keyElemMap&&null!=(e=this.m_keyElemMap.get(t))?document.getElementById(e):this.m_contentHandler.FindElementByKey(t)},GetIndexOf:function(e,i){var n;for(n=0;n<e.length;n++)if(i==e[n]||t.Object.compareValues(i,e[n]))return n;return-1},_isExpandCollapseIcon:function(t){return e(t).hasClass(this.getExpandIconStyleClass())||e(t).hasClass(this.getCollapseIconStyleClass())},IsArrowKey:function(t){return this.isCardLayout()?t==this.UP_KEY||t==this.DOWN_KEY||t==this.LEFT_KEY||t==this.RIGHT_KEY:t==this.UP_KEY||t==this.DOWN_KEY},_getItemsCache:function(){var t,i;return null==this.m_items&&(t=this.getGroupCollapseStyleClass(),i="."+this.getItemElementStyleClass()+":visible",this.m_items=this.element.find(i).filter(function(i){return!e(this).parent().hasClass(t)||!e(this).parent().parent().hasClass("oj-collapsed")})),this.m_items},_handleLastItemKeyboardFocus:function(t){var i=t.get(0).nextElementSibling;if(null==i||!e(i).hasClass(this.getItemElementStyleClass())){if(this.m_contentHandler.IsHierarchical()&&t.parent().hasClass(this.getGroupStyleClass())&&null!=t.parent().parent().get(0).nextElementSibling)return;var n=this._getScroller();n.scrollTop<n.scrollHeight&&(n.scrollTop=n.scrollHeight)}},HandleArrowKeys:function(t,i,n){var s,o;if(!this.m_contentHandler.IsReady())return!0;switch(s=!i||this.m_isNavigate?this.m_active.elem:this.m_selectionFrontier,o=!1,t){case this.UP_KEY:this.isCardLayout()&&e(s).hasClass(this.getItemStyleClass())?this._gotoItemAbove(s,i,n):this._gotoPrevItem(s,i,n),o=!0;break;case this.DOWN_KEY:this.isCardLayout()&&e(s).hasClass(this.getItemStyleClass())?this._gotoItemBelow(s,i,n):this._gotoNextItem(s,i,n),o=!0;break;case this.LEFT_KEY:case this.RIGHT_KEY:this.isCardLayout()&&("rtl"==this.ojContext._GetReadingDirection()&&(t=t==this.LEFT_KEY?this.RIGHT_KEY:this.LEFT_KEY),t==this.LEFT_KEY?this._gotoPrevItem(s,i,n):this._gotoNextItem(s,i,n),o=!0)}return o},_gotoNextItem:function(t,i,n){var s,o,l;if(o=(s=this._getItemsCache()).index(t),++o<s.length){for(l=e(s[o]);this.SkipFocus(l);){if(++o==s.length)return;l=e(s[o])}i?(this._extendSelection(l,n),this.m_isNavigate=!1):(this.SetCurrentItem(l,n),this.m_isNavigate=!0),this._handleLastItemKeyboardFocus(l)}},_gotoPrevItem:function(t,i,n){var s,o,l;if(o=(s=this._getItemsCache()).index(t),--o>=0){for(l=e(s[o]);this.SkipFocus(l);){if(--o<0)return;l=e(s[o])}i?(this._extendSelection(l,n),this.m_isNavigate=!1):(this.SetCurrentItem(l,n),this.m_isNavigate=!0)}},_getColumnCount:function(t){var e,i,n;return t.each(function(t){if(i=this.offsetTop,void 0===n)n=i;else if(n!=i)return!1;e=t}),e+1},_updateSkipItemAriaLabel:function(t,i){var n,s,o;n=this._createSubId("extra_info"),null==this.m_skipAriaLabelText&&((s=e(document.createElement("div"))).addClass("oj-helper-hidden-accessible").attr("id",n),this._getListContainer().append(s),this.m_skipAriaLabelText=s),this.m_skipAriaLabelText.text(this.ojContext.getTranslatedString("accessibleNavigateSkipItems",{numSkip:i})),(o=this.getFocusItem(t)).uniqueId().attr("aria-labelledby",n+" "+o.prop("id"))},_removeSkipItemAriaLabel:function(t){var e=this.getFocusItem(t);e.length>0&&e.get(0).removeAttribute("aria-labelledby")},_gotoItemAbove:function(t,i,n){var s,o,l,r,a,h,c;if(t.hasClass(this.getItemStyleClass())){if(o=(s=t.parent()).children("li."+this.getItemStyleClass()),l=this._getColumnCount(o),(a=(r=o.index(t))-l)<0?s.hasClass(this.getGroupStyleClass())&&(h=s.parent(),c=r):(h=e(o.get(a)),c=l-1),h.length>0){if(this.SkipFocus(h))return;i?(this._extendSelection(h,n),this.m_isNavigate=!1):(null!=c&&c>0&&this._updateSkipItemAriaLabel(h,c),this.SetCurrentItem(h,n),this.m_isNavigate=!0)}}else this._gotoPrevItem(t)},_gotoItemBelow:function(t,i,n){var s,o,l,r,a,h,c,d;if(t.hasClass(this.getItemStyleClass())){if(o=(s=t.parent()).children("li."+this.getItemStyleClass()),l=this._getColumnCount(o),(a=(r=o.index(t))+l)>=o.length?(h=Math.ceil(o.length/l),d=o.length-1-r,r<Math.max(0,(h-1)*l)?(c=o.last(),d--):s.hasClass(this.getGroupStyleClass())&&(c=s.parent().next("li."+this.getItemElementStyleClass()))):(c=e(o.get(a)),d=l-1),c.length>0){if(this.SkipFocus(c))return;i?(this._extendSelection(c,n),this.m_isNavigate=!1):(null!=d&&d>0&&this._updateSkipItemAriaLabel(c,d),this.SetCurrentItem(c,n),this.m_isNavigate=!0)}}else this._gotoNextItem(t)},_isActionableMode:function(){return"actionable"==this.m_keyMode},_setActionableMode:function(t){this.m_keyMode=t?"actionable":"navigation",t||this.element[0].focus()},getFocusItem:function(t){var i;return t.hasClass(this.getFocusedElementStyleClass())?this.ShouldUseGridRole()&&"row"==t.attr("role")?0==(i=t.children(".oj-listview-cell-element").first()).length?t.children().first():i:t:e(t.find("."+this.getFocusedElementStyleClass()).first())},SetRootElementTabIndex:function(){this.element.attr("tabIndex",0)},RemoveRootElementTabIndex:function(){this.element.removeAttr("tabIndex")},_setTabIndex:function(t){this.getFocusItem(t).attr("tabIndex",0)},_resetTabIndex:function(t){var e;e=!0,"presentation"===t.attr("role")&&(e=!1),t=this.getFocusItem(t),e?t.removeAttr("tabIndex"):t.attr("tabIndex",-1)},_makeFocusable:function(t){this._setTabIndex(t)},getSingleFocusableElement:function(t){var e,i;return e="a, input, select, textarea, button",1===(i=t.children(e)).length&&0===i.first().find(e).length?i.first():t},_setCurrentItemOption:function(t,i,n){var s={item:this.ojContext._IsCustomElement()?n:e(n)};this.SetOption("currentItem",t,{_context:{originalEvent:i,internalSet:!0,extraData:s},changed:!0})},_setActive:function(t,e,i){var n,s,o,l;if(null!=t){if(n=t[0],s=this.GetKey(n),null==this.m_active||s!=this.m_active.key)return o={key:s,item:t},null!=this.m_active&&(o.previousKey=this.m_active.key,o.previousItem=this.m_active.elem,this._shouldDragSelectedItems()&&this._isTouchSupport()&&this.m_dndContext._unsetDraggable(o.previousItem),this._removeSkipItemAriaLabel(o.previousItem)),!!this.Trigger("beforeCurrentItem",e,o)&&(l={key:s,elem:t},this.m_active=l,this._shouldDragSelectedItems()&&this._isTouchSupport()&&this.m_dndContext._setDraggable(t),void 0!==i&&i||(this._makeFocusable(t),this.HighlightActive(),(null==e||e.originalEvent&&"click"!=e.originalEvent.type)&&this._focusItem(t),this.RemoveRootElementTabIndex(),o.previousItem&&this._resetTabIndex(o.previousItem)),!0);s==this.m_active.key&&(l={key:s,elem:t},this.m_active=l,void 0!==i&&i||(this._makeFocusable(t),this.RemoveRootElementTabIndex()))}else this.m_active=null;return!1},_focusItem:function(t){this.getFocusItem(t).focus()},HighlightActive:function(){var t;null!=this.m_active&&this._getListContainer().hasClass("oj-focus-ancestor")&&(t=this.m_active.elem,this._highlightElem(t,"oj-focus"))},UnhighlightActive:function(){null!=this.m_active&&this._unhighlightElem(this.m_active.elem,"oj-focus")},HandleClickActive:function(t,i){var n=null!=this.m_active?this.m_active.elem.get(0):null;null==n||e(n).hasClass(this.getItemStyleClass())||(n=n.firstElementChild),null!=i&&null!=n&&n!=i.target&&n.contains(i.target)||this.SetCurrentItem(t,i,!this.ShouldUseGridRole()||i.target!=t.get(0))},SetCurrentItem:function(t,e,i){this.ActiveAndFocus(t,e,i)&&this._setCurrentItemOption(this.GetKey(t[0]),e,t.get(0))},ActiveAndFocus:function(t,e,i){var n;return this._scrollToVisible(t[0]),this.UnhighlightActive(),n=this._setActive(t,e,i),this.HighlightActive(),n},enforceSelectionRequired:function(){var t;this._isSelectionEnabled()&&this._isSelectionRequired()&&(null!=(t=this.GetOption("selection"))&&0!=t.length||this._selectFirstSelectableItem())},_getFirstSelectableItem:function(){var t=this.element[0].querySelector(".oj-listview-cell-element[aria-selected]");return null==t?null:t.parentNode},_selectFirstSelectableItem:function(){var t,e;(t=this._getFirstSelectableItem())&&null!=(e=this.m_contentHandler.GetKey(t))&&(this._applySelection(t,e),this._setSelectionOption([e],null,[t]))},_isSelectionEnabled:function(){return"none"!=this.GetOption("selectionMode")},_isSelectionRequired:function(){return this.GetOption("selectionRequired")},_isMultipleSelection:function(){return"multiple"==this.GetOption("selectionMode")},IsSelectable:function(t){return(t=this.getFocusItem(e(t)).get(0)).hasAttribute("aria-selected")},_filterSelection:function(t){var e,i,n;for(e=[],i=0;i<t.length&&(!(null==(n=this.FindElementByKey(t[i]))||null!=n&&this.IsSelectable(n))||(e.push(t[i]),this._isMultipleSelection()));i++);return e},_setSelectionOption:function(i,n,s,o){var l,r,a={key:null,data:null};null!=(l=this.GetOption("firstSelectedItem"))&&((null==i||0==i.length)&&null!=l.key||i[0]!=l.key&&!t.Object.compareValues(i[0],l.key))&&(null!=i&&i.length>0&&(a={key:i[0],data:null!=o?o:this.getDataForVisibleItem({key:i[0]})}),this.SetOption("firstSelectedItem",a,{_context:{originalEvent:n,internalSet:!0},changed:!0})),r={items:this.ojContext._IsCustomElement()?s:e(null==s?{}:s)},this.SetOption("selection",i,{_context:{originalEvent:n,internalSet:!0,extraData:r},changed:!0})},_unhighlightSelection:function(){var t,i;null!=this.m_keyElemMap&&(t=this,e.each(this.GetOption("selection"),function(e,n){null!=(i=t.FindElementByKey(n))&&t._unhighlightElem(i,"oj-selected")}))},_highlightElem:function(t,e){this.HighlightUnhighlightElem(t,e,!0)},_unhighlightElem:function(t,e){this.HighlightUnhighlightElem(t,e,!1)},HighlightUnhighlightElem:function(t,i,n){var s;t=e(t),"oj-selected"==i&&this.getFocusItem(t).attr("aria-selected",n?"true":"false"),(s=t.children("."+this.getGroupItemStyleClass())).length>0&&(t=e(s[0])),"oj-focus"===i?n?"actionable"!=this.m_keyMode&&this._focusInHandler(t):this._focusOutHandler(t):n?t.addClass(i):t.removeClass(i)},HandleClickSelection:function(t,e){var i,n;this._scrollToVisible(t[0]),i=this._ctrlEquivalent(e),n=e.shiftKey,this._isMultipleSelection()&&(i||n)?!i&&n?this._extendSelection(t,e):this._augmentSelectionAndFocus(t,e):this.SelectAndFocus(t,e)},_handleTouchSelection:function(t,e){this._isMultipleSelection()?e.shiftKey?this._extendSelection(t,e):this._augmentSelectionAndFocus(t,e):this.SelectAndFocus(t,e)},_clearSelection:function(t,e){this._unhighlightSelection(),t&&(this._isSelectionRequired()?this._selectFirstSelectableItem():this._setSelectionOption([],null,null)),this.m_selectionFrontier=void 0===e?null:e},SelectAndFocus:function(t,e){var i,n,s;i=this.GetKey(t[0]),n=this.GetOption("selection"),s=this.GetIndexOf(n,i),this._clearSelection(s>-1),-1==s&&this._augmentSelectionAndFocus(t,e,[])},_extendSelection:function(t,e){null!=this.m_active&&this.m_selectionFrontier!=t&&(this._unhighlightElem(t,"oj-focus"),this._extendSelectionRange(this.m_active.elem,t,e))},_extendSelectionRange:function(t,e,i,n){!0===n?this._clearSelection(!1,this.m_selectionFrontier):this._clearSelection(!1,e),this._highlightRange(t,e,i),this.HighlightActive(),this._scrollToVisible(e[0])},_highlightRange:function(t,e,i){var n,s,o,l,r,a,h,c,d,u;for(n=[],s=[],(l=(o=this._getItemsCache()).index(t))>(r=o.index(e))?(a=r,h=l):(a=l,h=r),c=a;c<=h;c++)d=o[c],this.IsSelectable(d)&&(u=this.m_contentHandler.GetKey(d),this._applySelection(d,u),n.push(u),s.push(d));this._setSelectionOption(n,i,s)},_applySelection:function(i,n){null==this.m_keyElemMap&&(this.m_keyElemMap=new t.KeyMap),this.m_keyElemMap.set(n,e(i).attr("id")),this._highlightElem(i,"oj-selected")},_augmentSelectionAndFocus:function(t,i,n){var s,o,l,r,a,h;if(s=t,o=this.GetKey(t[0]),null==n&&(n=this.GetOption("selection").slice(0)),null==(l=null!=this.m_active?this.m_active.elem.get(0):null)||e(l).hasClass(this.getItemStyleClass())||(l=l.firstElementChild),null==i||null!=l&&l!=i.target&&l.contains(i.target)||(this.UnhighlightActive(),this._setActive(s,i)&&this._setCurrentItemOption(o,i,s.get(0)),this.HighlightActive()),null!=(l=null!=this.m_active?this.m_active.elem.get(0):null)&&l==s.get(0)){for((r=this.GetIndexOf(n,o))>-1?(this._unhighlightElem(t,"oj-selected"),n.splice(r,1)):(this.m_selectionFrontier=t,this._applySelection(t,o),n.push(o)),a=new Array(n.length),h=0;h<n.length;h++)a[h]=this.FindElementByKey(n[h]);this._setSelectionOption(n,i,a)}else null!=n&&0==n.length&&this._setSelectionOption(n,i,[])},ToggleSelection:function(t,e,i){var n,s,o,l,r,a;if(n=this.GetOption("selection").slice(0),o=this.m_active.elem,l=this.m_active.key,(r=this.GetIndexOf(n,l))>-1){if(i||1==n.length&&this._isSelectionRequired())return;this._unhighlightElem(o,"oj-selected"),n.splice(r,1),0==n.length&&(this.m_selectionFrontier=null)}else this.IsSelectable(o[0])&&(e||(this._clearSelection(!1),n.length=0),this.m_selectionFrontier=o,this._applySelection(o,l),n.push(l));for(s=new Array(n.length),a=0;a<n.length;a++)s[a]=this.FindElementByKey(n[a]);this._setSelectionOption(n,t,s)},_isInputElement:function(t){return null!=t.nodeName.match(/^INPUT|SELECT|OPTION|TEXTAREA/)&&!t.readOnly},HandleSelectionOrActiveKeyDown:function(t){var e,i,n,s,o,l,r=!1;return null!=this.m_active&&(e=t.keyCode,i=this.m_active.elem,this._isActionableMode()?e==this.ESC_KEY?(this._exitActionableMode(),this.HighlightActive(),this._focusItem(i),this._setTabIndex(i),r=!0):e===this.TAB_KEY&&(o=i.find("[data-first]"),l=i.find("[data-last]"),t.shiftKey?o.length>0&&l.length>0&&o!=l&&t.target==o[0]&&(l[0].focus(),r=!0):o.length>0&&l.length>0&&o!=l&&t.target==l[0]&&(o[0].focus(),r=!0)):e==this.F2_KEY?(this._enterActionableMode(),(o=i.find("[data-first]")).length>0&&(o[0].focus(),this._isExpandCollapseIcon(o)&&this._focusInHandler(o),i.hasClass(this.getItemStyleClass())||(i=i.children("."+this.getGroupItemStyleClass()).first()),i.removeClass("oj-focus-highlight"))):e==this.SPACE_KEY&&this._isSelectionEnabled()?(n=this._ctrlEquivalent(t),(s=t.shiftKey)&&!n&&null!=this.m_selectionFrontier&&this._isMultipleSelection()?this._extendSelectionRange(this.m_selectionFrontier,this.m_active.elem,t,!0):this.ToggleSelection(t,n&&!s&&this._isMultipleSelection(),!1),r=!0):e==this.ENTER_KEY&&this._isSelectionEnabled()?this.ToggleSelection(t,!1,!0):this.IsArrowKey(e)?(n=this._ctrlEquivalent(t),s=t.shiftKey,n||(r=this.HandleArrowKeys(e,s&&this._isSelectionEnabled()&&this._isMultipleSelection(),t))):e===this.TAB_KEY&&(t.shiftKey?this._disableAllTabbableElementsBeforeItem(i):this._disableAllTabbableElementsAfterItem(i)),r)},_isDisclosing:function(t){return!(!t||!this.m_disclosing)&&this.m_disclosing.indexOf(t)>-1},_setDisclosing:function(t,e){var i;if(null!=t)if(null==this.m_disclosing&&(this.m_disclosing=[]),e)this.m_disclosing.push(t);else for(i=this.m_disclosing.indexOf(t);i>-1;)this.m_disclosing.splice(i,1),i=this.m_disclosing.indexOf(t)},getAnimationEffect:function(e){var i;return null==this.defaultOptions&&(this.defaultOptions=t.ThemeUtils.parseJSONFromFontFamily(this.getOptionDefaultsStyleClass())),null==(i=this.defaultOptions.animation)?null:i[e]},isExpandable:function(){return"none"!=this.GetOption("drillMode")},_isExpandAll:function(){var e=this.GetOption("expanded");if("auto"===e){if(!this.isExpandable())return!0}else if("all"===e)return!0;return!!e.isAddAll&&(!this.isExpandable()&&e instanceof t._ojListViewExpandedKeySet||e.isAddAll())},expandKey:function(t,i,n,s,o){var l=this.FindElementByKey(t);null!=l&&this.ExpandItem(e(l),null,o,t,i,s,n)},_expand:function(t){var e=this.FindItem(t.target);null!=e&&e.length>0&&this.ExpandItem(e,t,!0,null,!0,!0,!0)},ExpandItem:function(t,e,i,n,s,o,l){var r,a;this.GetState(t)==this.STATE_COLLAPSED&&(null==n&&(n=this.GetKey(t[0])),i&&this._isDisclosing(n)||(r={item:t,key:n},l&&!this.Trigger("beforeExpand",e,r)&&s||(this.signalTaskStart("Expand item: "+n),i&&this._setDisclosing(n,!0),this.m_contentHandler.Expand(t,function(t){this._expandSuccess(t,i,e,r,o)}.bind(this)),this.m_items=null,null!=e&&e.stopPropagation(),this.ojContext._IsCustomElement()||null==this._collapsedKeys||-1!=(a=this._collapsedKeys.indexOf(n))&&this._collapsedKeys.splice(a,1),this.signalTaskEnd())))},_expandSuccess:function(t,i,n,s,o){var l,r,a,h,c,d,u,m,p=this;this.signalTaskStart("Handle results from successful expand"),t.key=s.key,l=this.AnimateExpand(e(t),i,n),r=t.parentNode,r=e(r),this.SetState(r,this.STATE_EXPANDED),a=this.getCollapseIconStyleClass(),h=this.getExpandIconStyleClass(),c=this.getExpandingIconStyleClass(),d=this.getGroupItemStyleClass(),r.children("."+d).find("."+a+", ."+c).removeClass(a).removeClass(c).addClass(h),o&&l.then(function(){p.ojContext._IsCustomElement()&&(u=p.GetOption("expanded"),p._isKeySet(u)&&!u.has(t.key)&&(m=u.add([t.key]),p.SetOption("expanded",m,{_context:{originalEvent:n,internalSet:!0},changed:!0}))),p.Trigger("expand",n,s)}),l.then(function(){p.signalTaskEnd()})},_adjustAncestorsMaxHeight:function(t,i){var n;t.parentsUntil("ul.oj-component-initnode","ul."+this.getGroupStyleClass()).each(function(t){(n=parseInt(e(this).css("maxHeight"),10))>0&&e(this).css("maxHeight",n+i+"px")})},AnimateExpand:function(t,i,n){var s,o,l,r=0,a=this;return s=new Promise(function(t,e){o=t}),i?(this.signalTaskStart("Animate expand of group item"),t.children().each(function(){r+=e(this).outerHeight(!0)}),this._isTouchSupport()&&this._adjustAncestorsMaxHeight(t,r),t.css("maxHeight",r+"px"),this.signalTaskStart("Kick off expand animation"),l=t.get(0),this.StartAnimation(l,"expand").then(function(e){a._handleExpandTransitionEnd(t,o)}),this.signalTaskEnd()):(this._isTouchSupport()?(t.children().each(function(){r+=e(this).outerHeight(!0)}),t.css("maxHeight",r+"px"),this._adjustAncestorsMaxHeight(t,r)):t.css("maxHeight",""),this.AnimateExpandComplete(t),o(null)),s},_handleExpandTransitionEnd:function(t,e){this._isTouchSupport()||t.css("maxHeight",""),this.AnimateExpandComplete(t),e(null),this.signalTaskEnd()},AnimateExpandComplete:function(t){t.removeClass(this.getGroupCollapseStyleClass()).addClass(this.getGroupExpandStyleClass()),this._setDisclosing(t[0].key,!1)},collapseKey:function(t,i,n,s){var o=this.FindElementByKey(t);null!=o&&this.CollapseItem(e(o),null,s,t,i,n)},_collapse:function(t){var e=this.FindItem(t.target);null!=e&&e.length>0&&this.CollapseItem(e,t,!0,null,!0,!0)},CollapseItem:function(t,e,i,n,s,o){var l,r,a,h,c,d,u=this;this.GetState(t)==this.STATE_EXPANDED&&(null==n&&(n=this.GetKey(t[0])),i&&this._isDisclosing(n)||(l={item:t,key:n},!this.Trigger("beforeCollapse",e,l)&&s||(this.signalTaskStart("Collapse item: "+n),i&&this._setDisclosing(n,!0),r=this.AnimateCollapse(t,n,i,e),this.SetState(t,this.STATE_COLLAPSED),a=this.getCollapseIconStyleClass(),h=this.getExpandIconStyleClass(),t.find("."+h).first().removeClass(h).addClass(a),this.m_items=null,null!=e&&e.stopPropagation(),o&&r.then(function(){u.ojContext._IsCustomElement()&&(c=u.GetOption("expanded"),u._isKeySet(c)&&(d=c.delete([n]),u.SetOption("expanded",d,{_context:{originalEvent:e,internalSet:!0},changed:!0}))),u.Trigger("collapse",e,l)}),this.ojContext._IsCustomElement()||(null==this._collapsedKeys&&(this._collapsedKeys=[]),-1==this._collapsedKeys.indexOf(n)&&this._collapsedKeys.push(n)),r.then(function(){u.signalTaskEnd()}))))},AnimateCollapse:function(t,i,n,s){var o,l,r,a,h,c=0,d=this;return l=new Promise(function(t,e){r=t}),(o=t.children("ul").first())[0].key=i,n?(this.signalTaskStart("Animate collapse"),o.children().each(function(){c+=e(this).outerHeight()}),o.css("maxHeight",c+"px"),(a=this.getAnimationEffect("collapse")).persist="all",this.signalTaskStart("Kick off collapse animation"),h=o.get(0),this.StartAnimation(h,"collapse",a).then(function(t){d._handleCollapseTransitionEnd(o,r)}),this.signalTaskEnd()):(o.css("maxHeight","0px"),this.AnimateCollapseComplete(o),r(null)),l},_handleCollapseTransitionEnd:function(t,e){this.AnimateCollapseComplete(t),e(null),this.signalTaskEnd()},AnimateCollapseComplete:function(t){t.removeClass(this.getGroupExpandStyleClass()).addClass(this.getGroupCollapseStyleClass()),null!=this.m_contentHandler&&this.m_contentHandler.Collapse(t),this._setDisclosing(t[0].key,!1)},_collapseAll:function(){var t;this.signalTaskStart("Collapse all"),t=this,this._getItemsCache().each(function(){t.CollapseItem(e(this),null,!1,null,!1,!1)}),this.signalTaskEnd()},getExpanded:function(){var t,i,n;return t=[],i=this,this._getItemsCache().each(function(){n=e(this),i.GetState(n)==i.STATE_EXPANDED&&t.push(i.GetKey(n[0]))}),t},getWidgetConstructor:function(){return t.Components.__GetWidgetConstructor(this.element)},GetContainerStyleClass:function(){return this._isNonWindowTouch()?"oj-listview oj-listview-container-touch":"oj-listview oj-listview-container"},GetStyleClass:function(){return"oj-listview-element"},getItemStyleClass:function(){return"oj-listview-item"},getFocusedElementStyleClass:function(){return"oj-listview-focused-element"},getItemElementStyleClass:function(){return"oj-listview-item-element"},getGroupItemStyleClass:function(t){return t&&this._isPinGroupHeader()&&this._isPositionStickySupported()?"oj-listview-group-item oj-sticky":"oj-listview-group-item"},getGroupStyleClass:function(){return"oj-listview-group"},getGroupExpandStyleClass:function(){return"oj-listview-collapsible-transition"},getGroupCollapseStyleClass:function(){return this.getGroupExpandStyleClass()},getCollapseIconStyleClass:function(){return"oj-listview-collapse-icon"},getExpandIconStyleClass:function(){return"oj-listview-expand-icon"},getExpandingIconStyleClass:function(){return"oj-listview-expanding-icon"},getEmptyTextStyleClass:function(){return"oj-listview-no-data-message"},getEmptyTextMarkerClass:function(){return"oj-listview-empty-text"},getDepthStyleClass:function(t){return""},getOptionDefaultsStyleClass:function(){return"oj-listview-option-defaults"},_isPositionStickySupported:function(){return this._isTouchSupport()&&t.AgentUtils.getAgentInfo().os===t.AgentUtils.OS.IOS},_preventMouseWheelOverscroll:function(t,e){var i=e.originalEvent.wheelDelta;isNaN(i)||void 0===this.m_contentHandler.hasMoreToFetch||(i<0?this.m_contentHandler.hasMoreToFetch()&&t.scrollTop+t.clientHeight+Math.abs(i)>=t.scrollHeight&&(t.scrollTop=t.scrollHeight,e.preventDefault()):t.scrollTop>0&&t.scrollTop-i<=0&&(t.scrollTop=0,e.preventDefault()))},_getScrollEventElement:function(){var t=this._getScroller();return t==document.body||t==document.documentElement?window:t},_setCurrentScrollPosition:function(e){var i,n,s,o=!0,l=this;(i=e.key)&&null==this.FindElementByKey(i)&&this.m_contentHandler instanceof t.IteratingDataProviderContentHandler&&(n=this.m_contentHandler.getDataSource()).containsKeys&&((s=new Set).add(i),n.containsKeys({keys:s}).then(function(t){0==t.results.size&&delete e.key,l.syncScrollPosition(e)}),o=!1),o&&this.syncScrollPosition(e)},_findClosestElementToTop:function(t,e,i){var n,s,o,l,r,a=!1;if(!(0==t.length||e>=t.length)){if(l={index:e,elem:n=t[e],offsetTop:s=n.offsetTop,offset:o=i-s},Math.abs(o)<1)return l;for((r=o>0)?e++:e--;!a&&e>=0&&e<t.length;){if(s=(n=t[e]).offsetTop,a=(o=Math.abs(i-s))<1||(r?i<=s:i>=s)){(o<1||!r)&&(l={index:e,elem:n,offsetTop:s,offset:o});break}r&&l.offsetTop==s||(l={index:e,elem:n,offsetTop:s,offset:o}),r?e++:e--}return a||(e=r?t.length-1:0,l.index=e,l.elem=t[e]),l}},_getRootNodeForItems:function(){return this.isCardLayout()?this.element.get(0).firstElementChild.firstElementChild:this.element.get(0)},_getCurrentScrollPosition:function(t){var i,n,s,o,l,r,a,h,c={};return i=this._getScroller(),void 0===t&&(t=i.scrollTop),c.x=this._getScrollX(i),c.y=t,n=this.m_contentHandler.IsHierarchical(),!isNaN(this.m_itemHeight)&&this.m_itemHeight>0&&(s=n?this._getItemsCache():e(this._getRootNodeForItems()).children("li."+this.getItemElementStyleClass()),o=this.GetOption("scrollPosition"),Math.abs(o.y-t)<this.MINIMUM_ITEM_HEIGHT&&null!=o.key&&!isNaN(o.index)&&(n?null!=(a=this.FindElementByKey(o.key))&&(l=s.index(a)):l=o.index),isNaN(l)&&(l=Math.floor(t/this.m_itemHeight)),null!=(r=this._findClosestElementToTop(s,l,t))&&(a=r.elem,n?((h=a.parentNode)!=this.element.get(0)&&(c.parent=this.GetKey(h.parentNode)),c.key=this.GetKey(r.elem),c.index=e(h).children().index(a)):(c.index=r.index,c.key=this.GetKey(r.elem)),c.offsetY=r.offset,c.offsetX=c.x)),c},_getOffsetTop:function(t){var e=this.element.get(0).offsetTop;return isNaN(this.m_elementOffset)||this.m_elementOffset==e?t.offsetTop:Math.max(0,t.offsetTop-e)},_getScrollTopByIndex:function(t,i){var n,s;return null!=i?null!=(n=this.FindElementByKey(i))&&(n=e(n).children("ul").first()):(n=this.element.get(0),this.isCardLayout()&&(n=n.firstElementChild.firstElementChild)),null!=n&&null!=(s=e(n).children("."+this.getItemElementStyleClass())[t])?this._getOffsetTop(s):this.m_contentHandler.hasMoreToFetch&&this.m_contentHandler.hasMoreToFetch()?this._getScroller().scrollHeight:void 0},_getScrollTopByKey:function(t){var e=this.FindElementByKey(t);return null!=e?this._getOffsetTop(e):this.m_contentHandler.hasMoreToFetch&&this.m_contentHandler.hasMoreToFetch()?this._getScroller().scrollHeight:void 0},_getScrollCoordinates:function(t){var e,i,n,s,o,l,r;return this._getScroller(),e=t.x,l=t.offsetX,isNaN(e)||isNaN(l)||(e+=l),o=t.key,isNaN(i)&&null!=o&&(i=this._getScrollTopByKey(o)),n=t.parent,s=t.index,isNaN(i)&&!isNaN(s)&&(i=this._getScrollTopByIndex(s,n)),r=t.offsetY,isNaN(i)||isNaN(r)||(i+=r),isNaN(i)&&!isNaN(t.y)&&(i=t.y),{x:e,y:i}},_handleScroll:function(t){var e;null!=this.m_contentHandler&&(e=this._getScroller().scrollTop,this.ojContext._IsCustomElement()||this.SetOption("scrollTop",e,{_context:{originalEvent:t,internalSet:!0}}),this.ShouldUpdateScrollPosition()&&this.SetOption("scrollPosition",this._getCurrentScrollPosition(e),{_context:{originalEvent:t,internalSet:!0}}),this._handlePinGroupHeader())},_registerScrollHandler:function(){var t,i=this;t=e(this._getScrollEventElement()),this.ojContext._off(t,"scroll mousewheel"),this.ojContext._on(t,{scroll:function(t){i._skipScrollUpdate||i.m_ticking||(window.requestAnimationFrame(function(){i._handleScroll(t),i.m_ticking=!1}),i.m_ticking=!0),i._skipScrollUpdate&&i.signalTaskEnd(),i._skipScrollUpdate=!1}}),"loadMoreOnScroll"==this.options.scrollPolicy&&this.ojContext._on(t,{mousewheel:function(t){i._preventMouseWheelOverscroll(i._getScroller(),t)}})},_isPinGroupHeader:function(){return"static"!=this.GetOption("groupHeaderPosition")&&this.m_contentHandler.IsHierarchical()},_getGroupItemsCache:function(){var t;return null==this.m_groupItems&&(t="."+this.getGroupItemStyleClass()+":visible",this.m_groupItems=this.element.find(t).filter(function(t){return!e(this).parent().hasClass("oj-collapsed")&&e(this).next().children().length>0})),this.m_groupItems},_unpinGroupItem:function(t){e(t).removeClass("oj-pinned"),t.style.top="auto",t.style.width="auto"},_getNextGroupItem:function(t){var e,i;return(i=(e=this._getGroupItemsCache()).index(t))>-1&&i<e.length-1?e[i+1]:null},_pinGroupItem:function(t,i){var n,s,o;n=t.offsetWidth,s=t.offsetHeight,null!=(o=this._getNextGroupItem(t))&&o.offsetTop<=i+s+5&&(i-=s),e(t).addClass("oj-pinned"),t.style.top=i+"px",t.style.width=n+"px"},_handlePinGroupHeader:function(){var t,e,i,n,s,o,l,r,a;if(this._isPinGroupHeader()&&!this._isPositionStickySupported()){if(t=this._getScroller().scrollTop,null!=this.m_groupItemToPin&&0==t)return this._unpinGroupItem(this.m_groupItemToPin),void(this.m_groupItemToPin=null);for(i=this._getGroupItemsCache(),n=0,null!=this.m_groupItemToPin&&(n=this.m_groupItemToPin.offsetHeight),s=0;s<i.length;s++)if(o=i[s],this.m_groupItemToPin!=o&&(r=(l=i[s].offsetTop)+o.parentNode.offsetHeight,l<t&&r>t+n)){e=o;break}if(null!=e&&e!=this.m_groupItemToPin)null!=this.m_groupItemToPin&&this._unpinGroupItem(this.m_groupItemToPin),this._pinGroupItem(e,t),this.m_groupItemToPin=e;else if(null!=this.m_groupItemToPin){if(null!=(a=this._getNextGroupItem(this.m_groupItemToPin))&&a.offsetTop<=t+n)return void(this.m_groupItemToPin.style.top=a.offsetTop-n+"px");this.m_groupItemToPin.style.top=t+"px"}}},_getScroller:function(){var t,e;return null!=(t=this.GetOption("scrollPolicyOptions"))&&null!=(e=t.scroller)?e:this._getListContainer().get(0)},_scrollToGroupHeader:function(t){var e,i,n;i=(e=this._getScroller()).scrollTop,null!=this.m_groupItemToPin&&(this._unpinGroupItem(this.m_groupItemToPin),this.m_groupItemToPin=null),n=t.offsetTop,this._isPinGroupHeader()&&this._isPositionStickySupported()&&n<i&&(n=Math.max(0,n-t.parentNode.offsetHeight+t.offsetHeight)),e.scrollTop=n,i==e.scrollTop&&this._handlePinGroupHeader(),this._setFirstFocusableItemInGroupCurrent(t)},_setFirstFocusableItemInGroupCurrent:function(t){var i,n=this;e(t).next().children().each(function(){if(i=e(this),!n.SkipFocus(i))return n.SetOption("currentItem",this.key),!1})}}),t.__registerWidget("oj.ojListView",e.oj.baseComponent,{widgetEventPrefix:"oj",options:{as:"",currentItem:null,data:null,dnd:{drag:null,drop:null,reorder:{items:"disabled"}},drillMode:"collapsible",expanded:new t._ojListViewExpandedKeySet,firstSelectedItem:{key:null,data:null},groupHeaderPosition:"sticky",item:{focusable:!0,renderer:null,selectable:!0},scrollPolicy:"auto",scrollPolicyOptions:{fetchSize:25,maxCount:500},scrollPosition:{x:0,y:0},scrollTop:0,selection:[],selectionMode:"none",selectionRequired:!1,animateStart:null,animateEnd:null,beforeCurrentItem:null,beforeExpand:null,beforeCollapse:null,collapse:null,copy:null,cut:null,expand:null,paste:null,ready:null,reorder:null},_ComponentCreate:function(){this._super(),this._setup()},_setup:function(){var i={};i.element=this.element,i.OuterWrapper=this.OuterWrapper,i.ojContext=this,this._IsCustomElement()||this.options.expanded instanceof t._ojListViewExpandedKeySet&&(this.options.expanded="auto"),i=e.extend(this.options,i),this.listview=new t._ojListView,this.listview.init(i)},_AfterCreate:function(){this._super();var t=this;this.listview._FixRendererContext=function(e){return t._FixRendererContext(e)},this.listview._WrapCustomElementRenderer=function(e){return t._WrapCustomElementRenderer(e)},this.listview.afterCreate()},_SetupResources:function(){this._super(),this.listview.setupResources()},_ReleaseResources:function(){this._super(),this.listview.releaseResources()},GetFocusElement:function(){return null!=this.listview?this.listview.GetFocusElement():this._super()},_destroy:function(){this.listview.destroy(),this._super()},_NotifyContextMenuGesture:function(t,e,i){this.listview.notifyContextMenuGesture(t,e,i)},_setOptions:function(t,e){var i=this.listview.setOptions(t,e);this._super(t,e),i?this.listview.refresh():(t.selectionRequired||t.selection||t.selectionMode)&&this.listview.enforceSelectionRequired()},_setOption:function(t,i,n){var s,o=!0;if("selectionMode"==t?o="none"==i||"single"==i||"multiple"==i:"drillMode"==t?o="collapsible"==i||"none"==i:"scrollPolicy"==t?o="auto"==i||"loadMoreOnScroll"==i:"groupHeaderPosition"==t?o="static"==i||"sticky"==i:"firstSelectedItem"==t&&(o=!1),!o)throw"Invalid value: "+i+" for key: "+t;"selection"==t?(s=this.listview.getItems(i),n={_context:{extraData:{items:this._IsCustomElement()?s:e(s)}}}):"currentItem"==t&&(s=this.listview.getItems([i])[0],n={_context:{extraData:{items:this._IsCustomElement()?s:e(s)}}}),this._super(t,i,n)},_NotifyAttached:function(){this.listview.notifyAttached()},_NotifyDetached:function(){this.listview.notifyDetached()},_NotifyShown:function(){this.listview.notifyShown()},widget:function(){return this.listview.getRootElement()},refresh:function(){this._super(),this.listview.refresh()},whenReady:function(){return this.listview.whenReady()},getNodeBySubId:function(t){return this.listview.getNodeBySubId(t)},getSubIdByNode:function(t){return this.listview.getSubIdByNode(t)},getContextByNode:function(t){return this.listview.getContextByNode(t)},getDataForVisibleItem:function(t){return this.listview.getDataForVisibleItem(t)},expand:function(t,e){this.listview.expandKey(t,e,!0,!0)},collapse:function(t,e){this.listview.collapseKey(t,e,!0)},getExpanded:function(){return this.listview.getExpanded()},getIndexerModel:function(){return null==this.indexerModel&&t.ListViewIndexerModel&&(this.indexerModel=new t.ListViewIndexerModel(this.listview)),this.indexerModel},scrollToItem:function(t){this.listview.scrollToItem(t)},_CompareOptionValues:function(e,i,n){switch(e){case"currentItem":case"selection":return t.Object.compareValues(i,n);default:return this._super(e,i,n)}}}),t.IteratingDataProviderContentHandler=function(e,i,n){t.IteratingDataProviderContentHandler.superclass.constructor.call(this,e,i,n)},t.Object.createSubclass(t.IteratingDataProviderContentHandler,t.DataSourceContentHandler,"oj.IteratingDataProviderContentHandler"),t.IteratingDataProviderContentHandler.prototype.Init=function(){t.IteratingDataProviderContentHandler.superclass.Init.call(this)},t.IteratingDataProviderContentHandler.prototype.IsHierarchical=function(){return!1},t.IteratingDataProviderContentHandler.prototype._destroyDomScroller=function(){null!=this.m_domScroller&&(this.m_domScroller.destroy(),this.m_domScroller=null,this.m_domScrollerMaxCountFunc=null)},t.IteratingDataProviderContentHandler.prototype.Destroy=function(){t.IteratingDataProviderContentHandler.superclass.Destroy.call(this),this._removeDataSourceEventListeners(),this._destroyDomScroller(),this.m_loadingIndicator=null},t.IteratingDataProviderContentHandler.prototype.HandleResize=function(t,e){this._isLoadMoreOnScroll()&&null!=this.m_height&&this.m_height!=e&&(this.m_height=e,this.checkViewport())},t.IteratingDataProviderContentHandler.prototype.notifyShown=function(){this._isLoadMoreOnScroll()&&this.checkViewport()},t.IteratingDataProviderContentHandler.prototype.notifyAttached=function(){var t,e;null!=(t=this._getFetchTrigger())&&null!=this.m_domScroller&&(this._getScroller(),t!=(e=this._getFetchTrigger())&&this.m_domScroller.setFetchTrigger(e),this.checkViewport())},t.IteratingDataProviderContentHandler.prototype._isLoadMoreOnScroll=function(){return"loadMoreOnScroll"==this.m_widget.options.scrollPolicy},t.IteratingDataProviderContentHandler.prototype._getFetchSize=function(){return Math.max(0,this.m_widget.options.scrollPolicyOptions.fetchSize)},t.IteratingDataProviderContentHandler.prototype._getTotalSize=function(){return-1},t.IteratingDataProviderContentHandler.prototype._getScroller=function(){var i=this.m_widget.options.scrollPolicyOptions.scroller;return null!=i&&e.contains(i,this.m_root)?(void 0===this._fetchTrigger&&(this._fetchTrigger=t.DomScroller.calculateOffsetTop(i,this.m_root)+this._getLoadingIndicatorHeight()),i):this.m_widget.getRootElement()},t.IteratingDataProviderContentHandler.prototype._getFetchTrigger=function(){return void 0===this._fetchTrigger&&(this._fetchTrigger=this._getLoadingIndicatorHeight()),this._fetchTrigger},t.IteratingDataProviderContentHandler.prototype._getLoadingIndicatorHeight=function(){var t,i,n;return(t=e(document.createElement("div"))).addClass(this.m_widget.getItemStyleClass()).css({visibility:"hidden",overflow:"hidden",position:"absolute"}),(i=e(document.createElement("div"))).addClass("oj-icon oj-listview-loading-icon"),t.append(i),e(this.m_widget.getRootElement()).append(t),n=t.get(0).offsetHeight,t.remove(),n},t.IteratingDataProviderContentHandler.prototype._getMaxCount=function(){return this.m_widget.options.scrollPolicyOptions.maxCount},t.IteratingDataProviderContentHandler.prototype.setDataSource=function(e){this._removeDataSourceEventListeners(),null!=e&&(this.m_handleModelMutateEventListener=this.handleModelMutateEvent.bind(this),this.m_handleModelRefreshEventListener=this.handleModelRefreshEvent.bind(this),e.addEventListener("mutate",this.m_handleModelMutateEventListener),e.addEventListener("refresh",this.m_handleModelRefreshEventListener)),t.IteratingDataProviderContentHandler.superclass.setDataSource.call(this,e)},t.IteratingDataProviderContentHandler.prototype._appendLoadingIndicator=function(){var t,i;null==this.m_loadingIndicator&&((t=e(document.createElement("li"))).uniqueId().attr("role","presentation").addClass(this.m_widget.getItemStyleClass()).addClass("oj-listview-loading-icon-container"),(i=e(document.createElement("div"))).addClass("oj-icon oj-listview-loading-icon"),t.append(i),e(this.m_root).append(t),this.m_loadingIndicator=t)},t.IteratingDataProviderContentHandler.prototype._removeLoadingIndicator=function(){null!=this.m_loadingIndicator&&this.m_loadingIndicator.remove(),this.m_loadingIndicator=null},t.IteratingDataProviderContentHandler.prototype.hasMoreToFetch=function(){return null!=this.m_loadingIndicator},t.IteratingDataProviderContentHandler.prototype.afterRenderItem=function(i,n){var s;t.IteratingDataProviderContentHandler.superclass.afterRenderItem.call(this,i,n),e(i).addClass(this.m_widget.getItemStyleClass()),this.m_widget._isSelectionEnabled()&&this.isSelectable(n)&&this.m_widget.getFocusItem(e(i)).attr("aria-selected",!1),this._isLoadMoreOnScroll()&&(-1===(s=Math.min(this._getTotalSize(),this._getMaxCount()))&&(s=this._getMaxCount()),s>0&&e(i).attr("aria-setsize",s).attr("aria-posinset",n.index+1)),this.m_widget.itemRenderComplete(i,n)},t.IteratingDataProviderContentHandler.prototype.afterRenderItemForInsertEvent=function(i,n){var s,o,l,r;this.signalTaskStart("after render item from model insert event"),i.setAttribute("data-oj-context",""),this.afterRenderItem(i,n),s=e(i),o=i.className,i.className="oj-listview-temp-item oj-listview-item-add-remove-transition",this.shouldUseGridRole()||s.children().wrapAll("<div></div>"),(l=s.children().first())[0].className=o,l[0].key=i.key,this.shouldUseGridRole()||(l.attr("role",i.getAttribute("role")),s[0].hasAttribute("aria-selected")&&l.attr("aria-selected",i.getAttribute("aria-selected"))),r=this,t.Context.getContext(i).getBusyContext().whenReady().then(function(){null!=r.m_widget&&(r.signalTaskStart("kick off animation for insert item"),r.m_widget.StartAnimation(i,"add").then(function(t){i.removeAttribute("data-oj-context"),r._handleAddTransitionEnd(n,i)}),r.signalTaskEnd())})},t.IteratingDataProviderContentHandler.prototype._handleScrollerMaxRowCount=function(){t.Logger.error("max count reached")},t.IteratingDataProviderContentHandler.prototype._removeDataSourceEventListeners=function(){var t=this.getDataSource();null!=t&&(t.removeEventListener("mutate",this.m_handleModelMutateEventListener),t.removeEventListener("refresh",this.m_handleModelRefreshEventListener))},t.IteratingDataProviderContentHandler.prototype.fetchRows=function(i){var n,s,o,l,r,a,h,c=0;if(this.signalTaskStart("fetching rows"),this.IsReady())return this.m_fetching=!0,t.IteratingDataProviderContentHandler.superclass.fetchRows.call(this,i),o=this.loadTemplateEngine(),this.signalTaskStart("first fetch"),(n={}).size=this._isLoadMoreOnScroll()?this._getFetchSize():-1,s=this,this.m_dataProviderAsyncIterator=this.getDataSource().fetchFirst(n)[Symbol.asyncIterator](),l=this.m_dataProviderAsyncIterator.next(),Promise.all([l,o]).then(function(i){null!=s.m_widget&&(r=i[0],a=i[1],(h=s.getDataSource())instanceof t.TableDataSourceAdapter&&(c=h.offset),0==c&&e(s.m_root).empty(),s._handleFetchedData(r,a))},function(t){s._handleFetchError(t),s.signalTaskEnd()}),void this.signalTaskEnd();this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype._handleFetchError=function(e){t.Logger.error(e),null!=this.m_widget?(this._isLoadMoreOnScroll()&&this._removeLoadingIndicator(),this.m_widget.renderComplete()):t.Logger.info("handleFetchError: widget has already been destroyed")},t.IteratingDataProviderContentHandler.prototype._handleFetchSuccess=function(t,e,i){var n,s,o,l;if(null!=this.m_widget){for(n=this.m_root.childElementCount,s=document.createDocumentFragment(),o=0;o<t.length;o++)l=t[o],this.addItem(s,-1,l,this.getMetadata(n,e[o],l),i),n+=1;this.m_root.appendChild(s)}},t.IteratingDataProviderContentHandler.prototype._registerDomScroller=function(){var e,i=this;this.m_domScrollerMaxCountFunc=function(t){null!=t?(i.signalTaskStart("handle results when maxCountLimit reached"),i._removeLoadingIndicator(),i.IsReady()&&i.signalTaskStart("dummy task"),i._handleFetchedData(t,i.getTemplateEngine()),i.signalTaskEnd(),i.signalTaskEnd()):(i._removeLoadingIndicator(),i.signalTaskEnd())},e={fetchSize:this._getFetchSize(),fetchTrigger:this._getFetchTrigger(),maxCount:this._getMaxCount(),asyncIterator:this.m_dataProviderAsyncIterator,initialRowCount:this.m_root.childElementCount,success:this.m_domScrollerMaxCountFunc,error:this.signalTaskEnd.bind(this)},this.m_domScroller=new t.DomScroller(this._getScroller(),this.getDataSource(),e),this.m_domScroller._handleScrollerScrollTop=function(e,n){n-e<=1&&i.hasMoreToFetch()&&i.signalTaskStart("starts highwatermark scrolling"),t.DomScroller.prototype._handleScrollerScrollTop.call(this,e,n)}},t.IteratingDataProviderContentHandler.prototype._pushToEventQueue=function(t){null==this.m_eventQueue&&(this.m_eventQueue=[]),this.m_eventQueue.push(t)},t.IteratingDataProviderContentHandler.prototype._clearEventQueue=function(){null!=this.m_eventQueue&&(this.m_eventQueue.length=0)},t.IteratingDataProviderContentHandler.prototype._processEventQueue=function(){var t,e;if(null!=this.m_eventQueue&&this.m_eventQueue.length>0){for(t=0;t<this.m_eventQueue.length;t++)if("refresh"==(e=this.m_eventQueue[t]).type)return void this.handleModelRefreshEvent(e.event);"mutate"==(e=this.m_eventQueue.shift()).type&&this.handleModelMutateEvent(e.event)}},t.IteratingDataProviderContentHandler.prototype.handleModelMutateEvent=function(t){null!=t.detail.remove&&this.handleModelRemoveEvent(t),null!=t.detail.add&&this.handleModelAddEvent(t),null!=t.detail.update&&this.handleModelChangeEvent(t)},t.IteratingDataProviderContentHandler.prototype._getIndex=function(t,i){var n,s;return null==t||0==t.length||i>=t.length?-1:(n=t[i],null!=(s=this.FindElementByKey(n))?e(this.m_root).children().index(s):-1)},t.IteratingDataProviderContentHandler.prototype.handleModelAddEvent=function(t){var e,i,n,s,o,l,r,a;if(null!=this.m_root)if(this.IsReady()){if(this.signalTaskStart("handling model add event"),i=(e=t.detail.add).data,n=[],e.keys.forEach(function(t){n.push(t)}),e.afterKeys&&(s=[],e.afterKeys.forEach(function(t){s.push(t)})),o=this.getTemplateEngine(),l=e.indexes,null!=i&&null!=n&&n.length>0&&i.length>0&&n.length==i.length&&(null==l||l.length==i.length)){for(r=0;r<i.length;r++)this.signalTaskStart("handling model add event for item: "+n[r]),a=null==l?this._getIndex(s,r)+1:l[r],this.addItem(this.m_root,a,i[r],this.getMetadata(a,n[r],i[r]),o,this.afterRenderItemForInsertEvent.bind(this)),this.signalTaskEnd();this.IsReady()&&this.signalTaskStart("dummy task"),this.fetchEnd()}this.signalTaskEnd()}else this._pushToEventQueue({type:t.type,event:t})},t.IteratingDataProviderContentHandler.prototype._handleAddTransitionEnd=function(t,i){var n;null!=this.m_widget?(n=e(i).children().first().attr("class"),i.className=n,this.shouldUseGridRole()?e(i).children().first()[0].className="oj-listview-cell-element":e(i).children().children().unwrap(),this.m_widget.itemInsertComplete(i,t),this.signalTaskEnd()):this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.handleModelRemoveEvent=function(t){var e,i,n,s,o,l,r,a=this;if(e=t.detail.remove.keys,null!=this.m_root&&null!=e&&0!=e.size)if(this.IsReady()){if(this.signalTaskStart("handling model remove event"),n=this.m_widget.options.selection,s=n.slice(0),e.forEach(function(t){null!=(i=a.FindElementByKey(t))&&(a.signalTaskStart("handling model remove event for item: "+t),a._removeItem(i),a.signalTaskEnd()),(o=a.m_widget.GetIndexOf(n,t))>-1&&s.splice(o,1)}),n.length!=s.length){for(r=new Array(s.length),l=0;l<s.length;l++)r[l]=this.FindElementByKey(s[l]);this.m_widget._setSelectionOption(s,null,r)}this.m_widget.ClearCache(),this.signalTaskEnd()}else this._pushToEventQueue({type:t.type,event:t})},t.IteratingDataProviderContentHandler.prototype._removeItem=function(t){var i,n,s,o,l=this;this.signalTaskStart("removing an item"),i=document.activeElement,n=t.contains(i),s=(t=e(t)).get(0).className,t.children().wrapAll("<div class='"+s+"'></div>"),t.get(0).className="oj-listview-item-add-remove-transition",this.signalTaskStart("kick off animation to remove an item"),o=t.get(0),this.m_widget.StartAnimation(o,"remove").then(function(e){l._handleRemoveTransitionEnd(t,n)}),this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype._handleRemoveTransitionEnd=function(t,i){if(null!=this.m_widget){var n=(t=e(t)).parent();0!=n.length?(this.m_widget.itemRemoveComplete(t.get(0)),t.remove(),0==n.get(0).childElementCount&&this.m_widget.renderComplete(),this.m_widget.enforceSelectionRequired(),i&&this.m_root.focus(),this.signalTaskEnd()):this.signalTaskEnd()}else this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.handleModelChangeEvent=function(t){var e,i,n,s,o,l,r,a;if(null!=this.m_root){for(this.signalTaskStart("handling model update event"),n=(e=t.detail.update).data,i=[],e.keys.forEach(function(t){i.push(t)}),s=this.getTemplateEngine(),o=e.indexes,l=0;l<i.length;l++)null!=(r=this.FindElementByKey(i[l]))&&(this.signalTaskStart("handling model update event for item: "+i[l]),a=null==o?-1:o[l],this.replaceItem(r,a,n[l],this.getMetadata(a,i[l],n[l]),s,this.afterRenderItemForChangeEvent.bind(this)),this.signalTaskEnd());this.m_widget.ClearCache(),this.signalTaskEnd()}},t.IteratingDataProviderContentHandler.prototype.afterRenderItemForChangeEvent=function(t,e){var i=this;this.signalTaskStart("after render item for model change event"),this.afterRenderItem(t,e),this.m_widget.StartAnimation(t,"update").then(function(e){i._handleReplaceTransitionEnd(t)}),this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype._handleReplaceTransitionEnd=function(t){null!=this.m_widget?(e(t).removeClass("oj-listview-item-add-remove-transition"),this.m_widget.restoreCurrentItem(),this.signalTaskEnd()):this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.handleModelRefreshEvent=function(t){null!=this.m_root&&(this.IsReady()?(this.signalTaskStart("handling model reset event"),this._clearEventQueue(),this.m_widget.ClearCache(),this._destroyDomScroller(),this.fetchRows(!0),this.signalTaskEnd()):this._pushToEventQueue({type:t.type,event:t}))},t.IteratingDataProviderContentHandler.prototype._handleFetchedData=function(e,i){var n,s,o=!1;return null==this.m_root||null==e.value?o:(n=e.value.data,s=e.value.metadata.map(function(t){return t.key}),n.length==s.length&&(this._handleFetchSuccess(n,s,i),this._isLoadMoreOnScroll()&&((o=!e.done&&this._isLoadMoreOnScroll())&&(null!=s&&0==s.length&&t.Logger.info("handleFetchedData: zero data returned while done flag is false"),null==this.m_domScroller&&this._registerDomScroller(),e.maxCountLimit||this._appendLoadingIndicator()),e.maxCountLimit&&this._handleScrollerMaxRowCount()),this.fetchEnd()),o)},t.IteratingDataProviderContentHandler.prototype.fetchEnd=function(){var e,i,n=this;this.m_fetching=!1,e=function(){n.m_widget&&(n.m_widget.renderComplete(),n._processEventQueue(),n.checkViewport())},this.isAsyncRendering()?((i=this.m_widget.m_scrollAndFetch)&&n.signalTaskEnd(),t.Context.getContext(this.m_root).getBusyContext().whenReady().then(function(){i&&n.signalTaskStart("scroll and fetch"),e()})):e(),n.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.checkViewport=function(){var t,e=this;this.signalTaskStart("checking viewport"),null!=this.m_domScroller&&this.IsReady()&&null!=(t=this.m_domScroller.checkViewport())&&(this.signalTaskStart("got promise from checking viewport"),t.then(function(t){null!=t&&e.m_domScrollerMaxCountFunc(t),e.signalTaskEnd()},null)),this.signalTaskEnd()},t.IteratingDataProviderContentHandler.prototype.getMetadata=function(t,e,i){var n=i.context;return null==n&&(n={}),null==n.index&&(n.index=t),null==n.key&&(n.key=e),n},t.CustomElementBridge.registerMetadata("oj-list-view","baseComponent",{properties:{as:{type:"string"},currentItem:{type:"any",writeback:!0},data:{},dnd:{type:"object",properties:{drag:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"Array<string>"},drag:{},dragEnd:{},dragStart:{}}}}},drop:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"Array<string>"},dragEnter:{},dragLeave:{},dragOver:{},drop:{}}}}},reorder:{type:"object",properties:{items:{type:"string",enumValues:["disabled","enabled"]}}}}},drillMode:{type:"string",enumValues:["collapsible","none"]},expanded:{type:"object",writeback:!0},firstSelectedItem:{type:"object",writeback:!0,readOnly:!0},groupHeaderPosition:{type:"string",enumValues:["sticky","static"]},item:{type:"object",properties:{focusable:{},renderer:{},selectable:{}}},scrollPolicy:{type:"string"},scrollPolicyOptions:{type:"object",properties:{fetchSize:{type:"number"},maxCount:{type:"number"},scroller:{}}},scrollPosition:{type:"object",writeback:!0,properties:{x:{type:"number"},y:{type:"number"},offsetX:{type:"number"},offsetY:{type:"number"},key:{type:"any"},index:{type:"number"},parent:{type:"any"}}},selection:{type:"Array<any>",writeback:!0},selectionMode:{type:"string",enumValues:["none","single","multiple"]},selectionRequired:{type:"boolean"},translations:{type:"Object",properties:{accessibleNavigateSkipItems:{type:"string"},accessibleReorderAfterItem:{type:"string"},accessibleReorderBeforeItem:{type:"string"},accessibleReorderInsideItem:{type:"string"},accessibleReorderTouchInstructionText:{type:"string"},indexerCharacters:{type:"string"},labelCopy:{type:"string"},labelCut:{type:"string"},labelPaste:{type:"string"},labelPasteAfter:{type:"string"},labelPasteBefore:{type:"string"},msgFetchingData:{type:"string"},msgNoData:{type:"string"}}}},events:{animateEnd:{},animateStart:{},beforeCollapse:{},beforeCurrentItem:{},beforeExpand:{},collapse:{},copy:{},cut:{},expand:{},paste:{},reorder:{}},methods:{getContextByNode:{},getDataForVisibleItem:{},getIndexerModel:{},scrollToItem:{}},extension:{_INNER_ELEM:"ul",_GLOBAL_TRANSFER_ATTRS:["aria-label"],_WIDGET_NAME:"ojListView"}}),t.CustomElementBridge.register("oj-list-view",{metadata:t.CustomElementBridge.getMetadata("oj-list-view")})});