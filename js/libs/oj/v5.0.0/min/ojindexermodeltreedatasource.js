/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojindexer","ojs/ojdatasource-common"],function(t,e){t.IndexerModelTreeDataSource=function(t,e,n,r){this.data=t,this.idAttr=e,this.listener=n,this.options=r,this.Init()},t.Object.createSubclass(t.IndexerModelTreeDataSource,t.TreeDataSource,"oj.IndexerModelTreeDataSource"),t.IndexerModelTreeDataSource.prototype.Init=function(){var e,n,r,i,s,o,u,a,l,c,h,d,g,f,p;for(t.IndexerModelTreeDataSource.superclass.Init.call(this),null==(e=this.options.sections)&&(n=t.Translations.getTranslatedString("oj-ojIndexer.indexerCharacters"),e=n.split("|")),e.push(t.IndexerModel.SECTION_OTHERS),null==(r=this.options.groupingStrategy)&&(i=this.options.groupingAttribute,r=function(n){return s=n[i]?n[i]:n,o=s.toString().toUpperCase()[0],e.indexOf(o)>-1?o:t.IndexerModel.SECTION_OTHERS}),u=this.options.sortComparatorFunction,this.data=this.data.sort(function(t,n){return a=r(t),l=r(n),c=e.indexOf(a),h=e.indexOf(l),0==(d=c-h)&&u?u(t,n):d}),f=0;f<this.data.length;f++)g!=(p=r(this.data[f]))&&(g=p,this._set(p,f));this.sections=e},t.IndexerModelTreeDataSource.prototype._set=function(t,e){null==this.pos&&(this.pos=[]),this.pos.push({key:t,value:e})},t.IndexerModelTreeDataSource.prototype._get=function(t){var e;for(e=0;e<this.pos.length;e++)if(this.pos[e].key==t)return this.pos[e].value;return null},t.IndexerModelTreeDataSource.prototype.getIndexableSections=function(){return this.sections.slice(0,this.sections.length-1)},t.IndexerModelTreeDataSource.prototype.getMissingSections=function(){var t,e,n;if(null==this.missing){for(t=[],e=0;e<this.sections.length-1;e++)n=this.sections[e],null==this._get(n)&&t.push(n);this.missing=t}return this.missing},t.IndexerModelTreeDataSource.prototype.setSection=function(t){return this.listener.call(this,t)},t.IndexerModelTreeDataSource.prototype.getChildCount=function(e){var n,r,i,s,o;if(null==e)return n=this.sections.length-this.getMissingSections().length,null!=this._get(t.IndexerModel.SECTION_OTHERS)?n:n-1;if(null!=(r=this._get(e))){if((i=this.sections.indexOf(e))==this.sections.length-1)return this.data.length-r;for(i++,s=this.sections[i],o=this._get(s);null==o&&i<this.sections.length;)i++,s=this.sections[i],o=this._get(s);return(isNaN(o)||null==o)&&(o=this.data.length),o-r}return 0},t.IndexerModelTreeDataSource.prototype.fetchChildren=function(t,e,n,r){var i,s,o=this;null==t?(i=this.sections.filter(function(t){return null!=o._get(t)}),s={getParent:function(){return t},getStart:function(){return 0},getCount:function(){return i.length},getData:function(t){return i[t]},getMetadata:function(t){return{key:i[t],leaf:!1,depth:0}}}):s={getParent:function(){return t},getStart:function(){return 0},getCount:function(){return o.getChildCount(t)},getData:function(e){return o.data[o._get(t)+e]},getMetadata:function(e){var n=o.data[o._get(t)+e];return{key:null!=o.idAttr?n[o.idAttr]:n,leaf:!0,depth:1}}},null!=n&&null!=n.success&&n.success.call(null,s)}});