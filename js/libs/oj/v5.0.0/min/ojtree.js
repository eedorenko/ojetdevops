/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojdnd"],function(e,t){function i(){}e.TreeDndContext=function(e){this.Init(e)},e.Object.createSubclass(e.TreeDndContext,e.Object,"oj.TreeDndContext"),e.TreeDndContext.prototype.Init=function(t){e.TreeDndContext.superclass.Init.call(this),this.component=t,this.options=t.options,this._reset()},e.TreeDndContext.prototype.isDragEnabled=function(){var e=this._dnd;return e.reorder||e.dragFromEnabled},e.TreeDndContext.prototype.isDropEnabled=function(){var e=this._dnd;return e.reorder||e.dropToEnabled},e.TreeDndContext.prototype.handleDnDOptionChange=function(t){var i=this._dnd,n=e.TreeDndContext,a=i.reorder,s=i.dragFromEnabled;this._dndCleanAll(),this.initDnDOpts(),a==(i=this._dnd).reorder&&s==i.dragFromEnabled||i.reorder||i.dragFromEnabled||this.component._getContainerList().find("li").removeClass(n._OJ_DRAGGABLE).removeClass(n._OJ_DRAG).removeClass(n._OJ_VALID_DROP).removeAttr("draggable"),this.initDnD()},e.TreeDndContext.prototype.initDnDOpts=function(){var i,n,a,s=this.options.dnd,r=this._dnd,o=e.TreeDndContext,d=!0;r.reorder=!1,"object"==typeof s?("string"==typeof(i=s[o._DND_REORDER])&&("enable"===i?(r.reorder=!0,d=!1):"disable"==i&&(d=!1)),d&&(this.options.dnd.reorder="disable"),"object"==typeof(i=s[o._DND_DRAG])&&"object"==typeof(a=i[o._DND_NODE])&&("function"==typeof(n=a[o._DND_DRAGSTART_CB])&&(r.dragStartCallback=n,r.dragFromEnabled=!0),"function"==typeof(n=a[o._DND_DRAGDRAG_CB])&&(r.dragDragCallback=n,r.dragFromEnabled=!0),"function"==typeof(n=a[o._DND_DRAGEND_CB])&&(r.dragEndCallback=n,r.dragFromEnabled=!0),n=a[o._DND_DATATYPES],t.isArray(n)?(r.dragDataTypes=n.slice(),r.dragFromEnabled=!0):"string"==typeof n&&(r.dragDataTypes=[n],r.dragFromEnabled=!0)),"object"==typeof(i=s[o._DND_DROP])&&"object"==typeof(a=i[o._DND_NODE])&&("function"==typeof(n=a[o._DND_DROPDRAGENTER_CB])&&(r.dropDragEnterCallback=n,r.dropToEnabled=!0),"function"==typeof(n=a[o._DND_DROPDRAGOVER_CB])&&(r.dropDragOverCallback=n,r.dropToEnabled=!0),"function"==typeof(n=a[o._DND_DROPDRAGLEAVE_CB])&&(r.dropDragLeaveCallback=n,r.dropToEnabled=!0),"function"==typeof(n=a[o._DND_DROPDROP_CB])&&(r.dropDropCallback=n,r.dropToEnabled=!0),n=a[o._DND_DATATYPES],t.isArray(n)?(r.dropDataTypes=n.slice(),r.dropToEnabled=!0):"string"==typeof n&&(r.dropDataTypes=[n],r.dropToEnabled=!0)),r.reorder||(r.dragDataTypes||r.dragStartCallback||(r.dragFromEnabled=!1,r.dragStartCallback=r.dragDragCallback=r.dragEndCallback=r.dragDataTypes=null),r.dropDropCallback||(r.dropToEnabled=!1,r.dropDragEnterCallback=r.dropDragOverCallback=r.dropDragLeaveCallback=r.dropDropCallback=r.dropDataTypes=null)),r.pureReorder=r.reorder&&!r.dragFromEnabled):this.options.dnd={reorder:"disable"}},e.TreeDndContext.prototype.initDnD=function(){var i=this._dnd,n=i.vars,a=e.TreeDndContext;if(i.dragFromEnabled||i.dropToEnabled||i.reorder){e.TreeDndContext._dragMarker?(n.m=e.TreeDndContext._dragMarker,n.ml=e.TreeDndContext._dragMarkerLine):(n.m=t("<div class='oj-tree-drop-marker'><span class='oj-tree-drop-ptr oj-component-icon'>&#160;</span></div>").css("pointer-events","none").hide().appendTo("body"),n.ml=t("<div />").addClass(a._OJT_DROP_MARKER_LINE).css("pointer-events","none").hide().appendTo("body"),e.TreeDndContext._dragMarker=n.m,e.TreeDndContext._dragMarkerLine=n.ml),i.ml_width=n.ml.width();var s=this.component.element[0],r=t(s).children("ul:eq(0)");(i.reorder||i.dragFromEnabled)&&(i.fnDragStart=this._dragStart.bind(this),i.fnDragEnd=this._dragEnd.bind(this),t(s).on("dragstart",i.fnDragStart),t(s).on("dragend",i.fnDragEnd),r.length&&r.find("li").addClass(a._OJ_DRAGGABLE).addClass(a._OJ_DRAG).addClass(a._OJ_VALID_DROP).attr("draggable","true")),(i.reorder||i.dropToEnabled)&&(i.fnDrag=this._drag.bind(this),i.fnDragEnter=this._dragEnter.bind(this),i.fnDragOver=this._dragOver.bind(this),i.fnDragLeave=this._dragLeave.bind(this),i.fnDragDrop=this._dragDrop.bind(this),t(s).on("drag",i.fnDrag),t(s).on("dragenter",i.fnDragEnter),t(s).on("dragover",i.fnDragOver),t(s).on("dragleave",i.fnDragLeave),t(s).on("drop",i.fnDragDrop))}},e.TreeDndContext.prototype._closedown=function(){this._dndCleanAll()},e.TreeDndContext.prototype._dragStart=function(n){var a,s,r,o,d,l=t(n.target).closest("li"),h=n.originalEvent.dataTransfer;e.TreeDndContext;if((s=(a=this._dnd).vars).o=null,s.r=null,a.nodeLastEnter=null,a.nodeLastLeft=null,a.nodeDraggedId=null,a.dragStarted=!1,!a.reorder&&!a.dragFromEnabled||l.hasClass(i._OJ_DISABLED)||this.component._isTreeDisabled())n.preventDefault();else{if(!this.component._canTypedNodeMove(l,"move"))return!1;if(o=this.component.isSelected(l)?this.component._getNode(null,!0):o=l,(a.dragFromEnabled||a.pureReorder)&&this._setDataTypes(h,o),this._setDragImage(h,o),a.dragStartCallback){if(r=this._getDraggedItemArray(o),d=a.dragStartCallback(n,{item:r}),n.isDefaultPrevented()||"boolean"==typeof d&&!d)return d;if(!a.dragDataTypes&&!this._checkAddedDataTypes(h)&&!a.reorder)return n.preventDefault(),!1}"uninitialized"===h.effectAllowed&&(a.pureReorder?h.effectAllowed="move":h.effectAllowed=e.DomUtils.isMetaKeyPressed(n)?"copy":"move"),this._dndStartDrag(o,l,n)}},e.TreeDndContext.prototype._drag=function(e){var t=this._dnd;t.dragDragCallback&&t.dragDragCallback(e)},e.TreeDndContext.prototype._dragEnter=function(n){this.component._$container_ul[0].firstChild||this._addInternalNode();var a,s=t(n.target),r=this.component._getNode(s),o=this._dnd,d=o.vars,l=r&&r.length>0&&r.hasClass("oj-tree-node"),h=n.originalEvent.dataTransfer,c=e.TreeDndContext,_=!1,u=!1;if(l&&r.hasClass(i._OJ_TEMPNODE)&&(o.bInternalNode=!0),!l||"UL"!=n.target.tagName||"group"!=n.target.getAttribute("role"))if(o.foreign=!o.dragStarted,!o.foreign&&!o.reorder||o.foreign&&this._isDtType(h,c._DND_INTERNAL_DT_REORDER))this._dndClean();else if(!o.foreign||(_=this._isDtType(h,c._DND_INTERNAL_DT),o.dropToEnabled)){if(d.r=!1,o.nodeLastEnter&&this._clearDropClasses(o.nodeLastEnter),s.hasClass("oj-tree")&&(r=o.nodeLastEnter),!r||!r.length||r.attr("id")!=o.nodeDraggedId)return _&&l&&(o.nodeLastEnter=null,d.o=2),o.foreign&&!_&&(d.o=1),d.r=r,o.nodeLastEnter=r,this._dndPlacement(n,r),this._dndEnter(r)?(d.r.removeClass(c._OJ_INVALID_DROP).addClass(c._OJ_VALID_DROP).addClass(c._OJ_ACTIVE_DROP),o.dropDragEnterCallback&&(a=o.dropDragEnterCallback(n,{item:o.bInternalNode?null:r,position:o.bInternalNode?"first":o.place,reference:o.bInternalNode?null:d.r})),void 0===a?this._isDtAcceptDataTypes(h)?(n.preventDefault(),n.stopPropagation()):u=o.foreign||!o.reorder:!1===a||n.isDefaultPrevented()?(n.preventDefault(),n.stopPropagation()):!o.foreign&&o.reorder||(u=o.foreign||!o.reorder),u&&this._dndClean(),a):(this._clearDropClasses(d.r),d.r=null,void this._dndHideMarker());this._dndHideMarker()}else this._dndClean()},e.TreeDndContext.prototype._dragOver=function(e){var t,i,n=this._dnd,a=n.vars,s=e.originalEvent.dataTransfer,r=!1;if(a.r&&a.r.length)if((t=a.r).hasClass("oj-tree-node"))if(t.attr("id")!=n.nodeDraggedId){if(this._dndPlacement(e,t),this._dndPrepare())return n.dropDragOverCallback&&(i=n.dropDragOverCallback(e,{item:n.bInternalNode?null:t,reference:n.bInternalNode?null:a.r,position:n.bInternalNode?"first":a.last_pos})),void 0===i?this._isDtAcceptDataTypes(s)?(e.preventDefault(),e.stopPropagation()):r=n.foreign||!n.reorder:!1===i||e.isDefaultPrevented()?(e.preventDefault(),e.stopPropagation()):!n.foreign&&n.reorder||(r=n.foreign||!n.reorder),r&&this._dndClean(),i;this._dndHideMarker()}else this._dndHideMarker();else this._dndHideMarker();else this._dndHideMarker()},e.TreeDndContext.prototype._dragDrop=function(e){var t,i=this._dnd,n=i.vars,a=(e.originalEvent.dataTransfer,"boolean"==typeof n.o&&n.o,!1);return n.r&&(i.dropDropCallback?t=i.dropDropCallback(e,{reference:i.bInternalNode?null:n.r,position:i.bInternalNode?"first":n.last_pos,reorder:!i.foreign&&i.reorder}):!i.foreign&&i.reorder||(a=!0),a||t&&!e.isDefaultPrevented()||this._dndFinishReorder(e)),i.foreign&&this._dndClean(),a||(e.preventDefault(),e.stopPropagation()),i.nodeLastLeft=null,t},e.TreeDndContext.prototype._dragEnd=function(e){var t=this._dnd,i=t.vars;t.dragEndCallback&&t.dragEndCallback(e,{reorder:t.reorder&&!1===i.o}),this._dndStopDrag(),this._dndClean()},e.TreeDndContext.prototype._addInternalNode=function(){this._internalNode||(this._internalNode=t("<li class='"+i._OJ_TEMPNODE+" oj-tree-node oj-tree-leaf oj-valid-drop' id='"+i._OJ_TEMPNODE+"'><ins class='oj-tree-icon'></ins><a href='#'><ins class='oj-tree-icon'></ins><span class='oj-tree-title'></span></a></li>")),this.component._$container_ul.append(this._internalNode)},e.TreeDndContext.prototype._dragLeave=function(i){var n=this._dnd,a=n.vars,s=t(i.target),r=s.closest("li"),o=r&&r.length>0&&r.hasClass("oj-tree-node"),d=(r.attr("id"),i.originalEvent.dataTransfer);e.TreeDndContext;n.dropDragLeaveCallback&&n.dropDragLeaveCallback(i,{item:n.bInternalNode?null:r}),s.hasClass("oj-tree")||!o||"none"==d.dropEffect?this._dndLeave(i):n.nodeLastLeft=r,a.r&&this._clearDropClasses(a.r)},e.TreeDndContext.prototype._dndEnter=function(t){var n,a=this._dnd,s=a.vars;e.TreeDndContext;a.prepared=!1,n=this._dndPrepare();var r=a.openTimeoutMs;r&&(a.openTimer_Id&&clearTimeout(a.openTimerId),s.r&&s.r.length&&s.r.hasClass(i._OJ_COLLAPSED)&&(a.openTimerId=setTimeout(this._dndOpen.bind(this),r)));var o=typeof n;return n="boolean"==o&&n||"string"==o},e.TreeDndContext.prototype._dndOpen=function(){var e=this._dnd,t=e.vars;e.openTimerId=!1,this.component._expand(t.r,this._dndPrepare.bind(this),!0)},e.TreeDndContext.prototype._dndFinishReorder=function(t){var i=this._dnd,n=i.vars;i.dragStarted&&i.reorder&&"object"==typeof n.o&&n.o.length>0&&(this.component._moveNode(n.o,n.r,n.last_pos,e.DomUtils.isMetaKeyPressed(t)),n.o=!1)},e.TreeDndContext.prototype._dndFinishSelection=function(e){e.hasClass(i._OJ_SELECTED)&&(e.removeClass(i._OJ_SELECTED),this.component._select(e,!0));var n,a=this.component.getChildren(e),s=a&&a.length?a.length:0;for(n=0;n<s;n++)this._dndFinishSelection(t(a[n]))},e.TreeDndContext.prototype._dndPlacement=function(e,t){var n=this._dnd;t&&(t.hasClass(i._OJ_TEMPNODE)?n.place="after":(e=e.originalEvent,n.off=t.offset(),n.place=e.pageY-(n.off.top||0),n.place=n.place>=this.component._getNodeHeight()?"after":n.place<0?"before":"inside","after"===n.place&&t.hasClass(i._OJ_EXPANDED)&&(n.place="first")))},e.TreeDndContext.prototype._dndLeave=function(e){var t=this._dnd,i=t.vars;t.after=!1,t.before=!1,t.inside=!1,t.lastNodeEnter=null,this._dndHideMarker(),i.r&&i.r[0]===e.target.parentNode&&t.openTimerId&&(clearTimeout(t.openTimerId),t.openTimerId=!1)},e.TreeDndContext.prototype._dndClean=function(){this._dndHideMarker();var e=this._dnd,t=e.vars;t.o=!1,t.r=!1,e.openTimerId&&clearTimeout(e.openTimerId),e.nodeDraggedId=null,e.foreign=!1,e.nodeLastEnter=null,e.nodeLastLeft=null,e.after=!1,e.before=!1,e.inside=!1,e.off=!1,e.prepared=!1,e.openTimerId=!1,e.foreign=!1,e.bInternalNode=!1},e.TreeDndContext.prototype._dndCleanAll=function(){var e,i=this._dnd;(e=t(this.component._getContainer()[0])).off("dragstart",i.fnDragStart),e.off("dragend",i.fnDragEnd),e.off("drag",i.fnDrag),e.off("dragenter",i.fnDragEnter),e.off("dragover",i.fnDragOver),e.off("dragleave",i.fnDragLeave),e.off("drop",i.fnDragDrop),this._dndClean(),this._reset()},e.TreeDndContext.prototype._dndPrepare=function(){var e=this._dnd,t=e.vars,i=this.component,n=!1;if(!t.r||!t.r.length)return!1;if("number"!=typeof t.o||1!==t.o&&2!==t.o){if(!t.o)return!1}else n=!0;return e.off=t.r.offset(),this.component._isRtl&&(e.off.right=e.off.left+t.r.width()-t.r.find(">a").width()-30),e.targ_ml_width=t.r.find("a").width(),n?(e.before="before"==e.place,e.after="after"==e.place,e.inside="inside"==e.place):(i._prepare_move(t.o,t.r,"before"),e.before=i._checkMove(),i._prepare_move(t.o,t.r,"after"),e.after=i._checkMove(),this.component._is_loaded(t.r)?(i._prepare_move(t.o,t.r,"inside"),e.inside=i._checkMove()):e.inside=!1),e.prepared=!0,this._dndShowMarker()},e.TreeDndContext.prototype._dndShowMarker=function(){var t,i,n,a,s,r=this._dnd,o=e.TreeDndContext,d=r.vars,l=this.component._isRtl,h=this.component._getNodeHeight(),c=!1;if(!r.prepared)return this._dndHideMarker(),c;if(("after"==r.place&&r.after||"inside"==r.place&&r.inside||"before"==r.place&&r.before||"first"==r.place)&&(c=r.place),"first"===c){var _=d.r.find("li:eq(0)");r.off=_.offset()}switch(s=l?r.off.right-18:r.off.left+5,t=!this.component.isLeaf(d.r),i=l?s+r.targ_ml_width+18:s,n=l?i-r.ml_width:s+8,a=r.off.top-3,c){case"before":case"first":this._moveMarkerUI(d.m,{left:i,top:a-7}),d.ml&&this._moveMarkerUI(d.ml,{left:n,top:a});break;case"after":a+=h,this._moveMarkerUI(d.m,{left:i,top:a-2}),d.ml&&this._moveMarkerUI(d.ml,{left:n,top:a+6});break;case"inside":this._moveMarkerUI(d.m,{left:i+(l?t?-4:0:4),top:r.off.top+h/2-8}),d.ml&&d.ml.hide();break;default:this._dndHideMarker()}return c?d.r.removeClass(o._OJ_INVALID_DROP).addClass(o._OJ_VALID_DROP):d.r.removeClass(o._OJ_VALID_DROP).removeClass(o._OJ_VALID_DROP),d.last_pos=c,c},e.TreeDndContext.prototype._dndHideMarker=function(){var t=this._dnd.vars;e.TreeDndContext;t&&(t.m&&t.m.hide(),t.ml&&t.ml.hide(),t.r&&this._clearDropClasses(t.r))},e.TreeDndContext.prototype._moveMarkerUI=function(e,t){this._dnd.vars;t.left=t.left+"px",t.top=t.top+"px",e.css(t).show()},e.TreeDndContext.prototype._dndStartDrag=function(t,i,n){var a,s=this._dnd,r=s.vars,o=e.TreeDndContext;r.o=t,r.o.addClass(o._OJ_DRAG),s.nodeDraggedId=i.attr("id");try{n.currentTarget.unselectable="on",n.currentTarget.onselectstart=function(){return!1},n.currentTarget.style&&(n.currentTarget.style.MozUserSelect="none")}catch(e){}this.component._isTheme()&&r.m&&r.m.addClass("oj-tree-"+this.component._getTheme()),a=this.component._getContainer(),s.cof=a.offset(),s.cw=parseInt(a.width(),10),s.ch=parseInt(a.height(),10),s.dragStarted=!0},e.TreeDndContext.prototype._dndStopDrag=function(){var t=this._dnd,i=t.vars,n=e.TreeDndContext;i.r&&this._clearDropClasses(i.r),"number"!=typeof i.o&&i.o&&i.o.removeClass(n._OJ_DRAG),this._dragImg&&(document.body.removeChild(this._dragImg),this._dragImg=null),t.dragStarted=!1},e.TreeDndContext.prototype._setDataTypes=function(t,i){var n,a,s,r=this._dnd,o=e.TreeDndContext;if((n=this.component.__getJson(i))&&(a=JSON.stringify(n)),r.dragDataTypes)for(s=0;s<r.dragDataTypes.length;s++)t.setData(r.dragDataTypes[s],a);t.setData(o._DND_INTERNAL_DT,"0"),r.pureReorder&&t.setData(o._DND_INTERNAL_DT_REORDER,"0")},e.TreeDndContext.prototype._setDragImage=function(e,i){var n,a,s,r,o,d=i.length;if(1!==d){for(n=t("<div></div>"),a=t("<ul style='padding:0px;margin:0;'></ul>"),n.append(a),o=0;o<d;o++)(r=i[o].cloneNode(!0)).style.marginLeft=0,r.style.paddingLeft=0,a.append(r);s=n[0],document.body.appendChild(s),s.style.position="absolute",s.style.top="-"+2*n.height()+"px",s.style.right="0",this._dragImg=s,e.setDragImage(s,0,0)}else this._dragImg=null},e.TreeDndContext.prototype._isDtType=function(e,t){var i,n=e.types,a=n.length;for(i=0;i<a;i++)if(t==n[i])return!0;return!1},e.TreeDndContext.prototype._isDtAcceptDataTypes=function(e){var t,i=this._dnd.dropDataTypes,n=!1;if(i){for(n=!(i.length>0),t=0;t<i.length;t++)if(this._isDtType(e,i[t])){n=!0;break}}else n=!0;return n},e.TreeDndContext.prototype._checkAddedDataTypes=function(t){var i,n,a=t.types,s=a&&a.length?a.length:0,r=e.TreeDndContext,o=!1;for(n=0;n<s;n++)if((i=a[n])!=r._DND_INTERNAL_DT&&i!=r._DND_INTERNAL_DT_REORDER){o=!0;break}return o},e.TreeDndContext.prototype._clearDropClasses=function(t){var i=e.TreeDndContext;t&&t.removeClass(i._OJ_VALID_DROP).removeClass(i._OJ_INVALID_DROP).removeClass(i._OJ_ACTIVE_DROP)},e.TreeDndContext.prototype._getDraggedItemArray=function(e){var t=[];return e&&e.each(function(){t.push(this)}),t},e.TreeDndContext.prototype._reset=function(){var e={};this._dnd=e,e.reorder=!1,e.pureReorder=!1,e.foreign=!1,e.dragStarted=!1,e.nodeDraggedId=null,e.nodeLastEnter=null,e.fnDragStart=null,e.fnDragEnd=null,e.fnDrag=null,e.fnDragEnter=null,e.fnDragOver=null,e.fnDragLeave=null,e.fnDragDrop=null,e.dragFromEnabled=!1,e.dropToEnabled=!1,e.dragStartCallback=null,e.dragDragCallback=null,e.dragDragEndCallback=null,e.dropDragEnterCallback=null,e.dropDragOverCallback=null,e.dropDragLeaveCallback=null,e.dragDropCallback=null,e.dropDataTypes=null,e.after=!1,e.inside=!1,e.before=!1,e.off=!1,e.prepared=!1,e.openTimerId=!1,e.cof=!1,e.cw=!1,e.ch=!1,e.ml_width=100,e.targ_ml_width=100,e.openTimeoutMs=500,e.vars={},e.vars.o=!1,e.vars.r=!1,e.vars.m=!1,e.vars.ml=!1},e.TreeDndContext.prototype._trace=function(e){this.component._trace(e)},e.TreeDndContext._OJ_DRAGGABLE="oj-draggable",e.TreeDndContext._OJ_DRAG="oj-drag",e.TreeDndContext._OJ_ACTIVE_DROP="oj-active-drop",e.TreeDndContext._OJ_VALID_DROP="oj-valid-drop",e.TreeDndContext._OJ_INVALID_DROP="oj-invalid-drop",e.TreeDndContext._OJ_DROP="oj-drop",e.TreeDndContext._OJT_DROP_MARKER="oj-tree-drop-marker",e.TreeDndContext._OJT_DROP_MARKER_LINE="oj-tree-drop-marker-line",e.TreeDndContext._DND_REORDER="reorder",e.TreeDndContext._DND_DRAG="drag",e.TreeDndContext._DND_DROP="drop",e.TreeDndContext._DND_NODE="node",e.TreeDndContext._DND_DATATYPES="dataTypes",e.TreeDndContext._DND_DRAGSTART_CB="dragStart",e.TreeDndContext._DND_DRAGDRAG_CB="drag",e.TreeDndContext._DND_DRAGEND_CB="dragEnd",e.TreeDndContext._DND_DROPDRAGENTER_CB="dragEnter",e.TreeDndContext._DND_DROPDRAGOVER_CB="dragOver",e.TreeDndContext._DND_DROPDRAGLEAVE_CB="dragLeave",e.TreeDndContext._DND_DROPDROP_CB="drop",e.TreeDndContext._DND_INTERNAL_DT="_ojtree",e.TreeDndContext._DND_INTERNAL_DT_REORDER="_ojtreereorder",i._OJ_EXPANDED="oj-expanded",i._OJ_COLLAPSED="oj-collapsed",i._OJ_HOVER="oj-hover",i._OJ_SELECTED="oj-selected",i._OJ_DISABLED="oj-disabled",i._OJ_DEFAULT="oj-default",i._OJ_TEMPNODE="oj-treenode-temp",function(){var n,a,s,r="oj-tree-leaf",o="oj-tree-icon",d="oj-tree-node-icon",l="oj-tree-loading",h="oj-tree-icon oj-tree-disclosure-icon oj-component-icon oj-clickable-icon-nocontext oj-default",c="oj-tree-children",_={cut:"ojtreecut",copy:"ojtreecopy",paste:"ojtreepaste","paste-after":"ojtreepasteafter","paste-before":"ojtreepastebefore",remove:"ojtreeremove",rename:"ojtreerename"},u={cut:"labelCut",copy:"labelCopy",paste:"labelPaste","paste-after":"labelPasteAfter","paste-before":"labelPasteBefore",remove:"labelRemove",rename:"labelRename"},p=["id","title","class","role","draggable","style"];t(function(){/msie/.test(navigator.userAgent.toLowerCase())?(a=t('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),s=t('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),n=a.width()-s.width(),a.add(s).remove()):(a=t("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:0}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200}),n=100-a.width(),a.parent().remove())});var f=[];function g(i){var n="";e.DomUtils.isMetaKeyPressed(i)?n+="ctrl+":i.shiftKey&&(n+="shift+");var a=i.which;switch(a){case 32:n+="space";break;case 37:n+="left";break;case 38:n+="up";break;case 39:n+="right";break;case 40:n+="down";break;case 46:n+="del";break;case 33:n+="pgup";break;case 34:n+="pgdn";break;case 35:n+="end";break;case 36:n+="home";break;case 56:n="*";break;case 113:case 121:n+="f"+("1"-(112-a))}if(0===n.length||"shift+"==n||"ctrl+"==n)return!0;var s=null;return t.each(f,function(e,t){if(t._this._data.ui.focused)return t._this._data.ui.touchEvent=!1,"shift+f10"==n?(t._this._data.menu.activeNode=t._this._data.ui.hovered,t._this._data.menu.activeNode||(t._this._data.menu.activeNode=t._this._data.ui.lastSelected)):t._handler[n]&&(i.preventDefault(),s=t._handler[n].call(t._this,i)),!1}),null!=s?s:void 0}function m(e,i){var n=!1,a=!0;if(e.str)return e.title&&(n=t("style[id='"+e.title+"-stylesheet']")[0]),n?a=!1:((n=document.createElement("style")).setAttribute("type","text/css"),e.title&&n.setAttribute("id",e.title+"-stylesheet")),n.styleSheet?a?(document.getElementsByTagName("head")[0].appendChild(n),n.styleSheet.cssText=e.str):n.styleSheet.cssText=n.styleSheet.cssText+" "+e.str:(n.appendChild(document.createTextNode(e.str)),document.getElementsByTagName("head")[0].appendChild(n)),n.sheet||n.styleSheet}var v=-1;e.__registerWidget("oj.ojTree",t.oj.baseComponent,{widgetEventPrefix:"oj",defaultElement:"<div>",options:{dnd:{reorder:"disable"},expandParents:!1,initExpanded:null,initLoaded:[],selection:[],selectionMode:"single",selectedParentCollapse:!1,selectedParentExpand:!0,selectPrevOnDelete:!1,data:null,emptyText:null,icons:!0,types:null,before:null,collapse:null,create:null,collapseAll:null,cut:null,dehover:null,remove:null,destroy:null,expand:null,expandAll:null,hover:null,loaded:null,move:null,paste:null,refresh:null,rename:null},collapse:function(e,n){var a=(n=n||!1)?0:this._animDuration;if(!(e=this._getNode(e)).length||-1===e||!e.hasClass(i._OJ_EXPANDED)||this._data.core.locked||e.hasClass(i._OJ_DISABLED))return!1;var s=this._emitEvent({obj:e,func:"collapse"},"before");("boolean"!=typeof s||s)&&(e.removeClass(i._OJ_EXPANDED).addClass(i._OJ_COLLAPSED).attr("aria-expanded","false"),t(e.children()[0]).removeClass(i._OJ_SELECTED).addClass("oj-default"),this._busyStack.push({op:"c",id:e.attr("id")}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+e.attr("id")+"' is animating."),!n&&a?this._slide(e,!0):this._transitionEnd(t(e.children("UL")[0]),e))},_slide:function(e,i){var n,a,s;n=t(e.children("ul")),this._isSafari?n[0].addEventListener("webkitTransitionEnd",this._proxyTransitionEndHandler):n[0].addEventListener("transitionend",this._proxyTransitionEndHandler),i?(a=n[0].offsetHeight,s=0):(a=0,s=this._getElemHeight(n[0])),n.css("max-height",a+"px"),this._overflow=n.css("overflow"),n.css("overflow","hidden"),i||(n[0].style.display="block"),setTimeout(function(){n.addClass("oj-tree-transition"),n.css("max-height",s+"px")},20)},_getElemHeight:function(e){var i,n,a,s,r=t("<div style='position: absolute'>");return i=e.parentNode,n=e.nextSibling,i.removeChild(e),s=e.style.display,e.style.display="block",r.append(e),this._$container[0].appendChild(r[0]),a=e.offsetHeight||e.scrollHeight,e.style.display=s,this._$container[0].removeChild(r[0]),r[0].removeChild(e),n?i.insertBefore(e,n):i.appendChild(e),a+10},_transitionEndHandler:function(e){var i=t(e.target),n=i.closest("li");this._isSafari?i[0].removeEventListener("webkitTransitionEnd",this._proxyTransitionEndHandler):i[0].removeEventListener("transitionend",this._proxyTransitionEndHandler),i.removeClass("oj-tree-transition"),this._transitionEnd(i,n)},_transitionEnd:function(e,t){var n;t.hasClass(i._OJ_COLLAPSED)?(n="c",e[0].style.display="none",e.css("max-height",""),this._emitEvent({obj:t},"collapse"),this.after_close(t)):(n="e",e[0].style.display="block",e.css("max-height",""),this._emitEvent({obj:t},"expand")),this._overflow&&(e.css("overflow",this._overflow),this._overflow=null),this._removeFromBusyStack(n,t.attr("id")),this._resolveIfBusyStackEmpty()},collapseAll:function(e,t){var n=e||-1,a=this;if(!this._data.core.locked&&((e=e?this._getNode(e):this._$container)&&-1!==n&&(n=e),e&&-1!==n||(e=this._$container_ul),!e.hasClass(i._OJ_DISABLED))){var s;-1!==n&&this.isExpanded(e)&&(s=e[0]);var r=e.find("li.oj-expanded");r.length&&r.each(function(){a.collapse(this,!t)}),s&&(this.collapse(s,!t),r.splice(0,0,s)),r.length&&this._emitEvent({obj:r,targ:n},"collapseAll")}},expand:function(e,t){this._expand(e,!1,t)},expanded:function(e,i){var n,a,s=this;if(e&&"array"===t.type(e))return this._data.core.locked?null:(a=e.length,t.each(e,function(e,t){s._expand(t,!1,i)}),null);a=(e=this._$container_ul.find("li.oj-expanded")).length,n=[];for(var r=0;r<a;r++)n.push(e[r]);return t(n)},expandAll:function(e,t){this._expandAll(e,t)},toggleExpand:function(e,t){if((e=this._getNode(e))&&e.length&&-1!==e&&!e.hasClass(i._OJ_DISABLED)&&!this._data.core.locked)return e.hasClass(i._OJ_COLLAPSED)?this.expand(e,t):e.hasClass(i._OJ_EXPANDED)?this.collapse(e,t):void 0},deselect:function(e){var t=this.options.selection.slice(0);this._deselect(e),this._fireOptionChangeEvent("selection",t,null,null)},deselectAll:function(e){if(!this._data.core.locked){var t=this.options.selection.slice(0);this._deselectAll(e),this._fireOptionChangeEvent("selection",t,null,null)}},select:function(e){this._select(e,!0)},toggleSelect:function(e){return!!(e=this._getNode(e)).length&&(!e.hasClass(i._OJ_DISABLED)&&!this._data.core.locked&&(this._isSelected(e)?this.deselect(e):this._select(e,!0),!0))},isCollapsed:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(i._OJ_COLLAPSED)},isExpanded:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(i._OJ_EXPANDED)},isLeaf:function(e){return this._isLeaf(e)},isSelected:function(e){return this._isSelected(e)},create:function(e,i,n){var a,s,r;if(!(s=t.isArray(n))||1==n.length)return a=this._createNode(e,i,s?n[0]:n),this._getDndContext()._dndFinishSelection(a),a;if(s=[],"before"!=i)for(r=n.length-1;r>=0;r--)a=this._createNode(e,i,n[r]),s.unshift(a[0]),this._getDndContext()._dndFinishSelection(a);else for(r=0;r<n.length;r++)a=this._createNode(e,i,n[r]),s.push(a[0]),this._getDndContext()._dndFinishSelection(a);return t(s)},remove:function(e){if(!(e=this._getNode(e)).length||e.hasClass(i._OJ_DISABLED)||this._data.core.locked)return!1;var n=this._emitEvent({obj:e,func:"remove"},"before");if("boolean"==typeof n&&!n)return!1;this.__rollback();var a=this._getParent(e),s=t([]),o=this,d=this._getPrev(e);return e.each(function(){s=s.add(o._getPrev(this))}),e=e.detach(),-1!==a&&0===a.find("> ul > li").length&&a.removeClass("oj-expanded oj-collapsed").addClass(r).removeAttr("aria-expanded"),this._cleanNode(a),this._emitEvent({obj:e,prev:d,parent:a},"remove"),e},getText:function(e){return!!(e=this._getNode(e)).length&&(e=(e=e.children("a:eq(0)")).find("span:eq(0)"))[0].textContent},rename:function(e,t){t=this._escapeHtml(t),this._renameNode(e,t)},hover:function(e){this._hover(e)},dehover:function(){this._dehover()},getPath:function(e,t){var i=[],n=this;return!(-1===(e=this._getNode(e))||!e||!e.length)&&(e.parentsUntil(".oj-tree","li").each(function(){i.push(t?this.id:n.getText(this))}),i.reverse(),i.push(t?e.attr("id"):this.getText(e)),i)},getRoot:function(){return this._$container.children("ul:eq(0)")},refresh:function(e){this._super(),this._data.core.locked||this._refresh(e||-1)},move:function(e,t,i,n){this._moveNode(e,t,i,n)},getType:function(e){return this._getType(e)},setType:function(e,t){return this._setType(e,t)},getNodeBySubId:function(e){return e?this._processSubId(e):this.element?this.element[0]:null},getSubIdByNode:function(e){return this._getSubIdFromNodeElem(e)},getContextByNode:function(e){var t;return e=null==e||null==e?0:e,(t=-1!=(e=this._getNode(e))&&e.length>0)||-1==e?{subId:t?"oj-tree-node":"oj-tree",item:t?e[0]:null,node:!!t&&e,leaf:!!t&&this._isLeaf(e)}:null},getParent:function(e){var t=this._getParent(e);return t&&t.length>0?t:null},getPrevSibling:function(e){var t=this._getPrev(e,!0);return t&&t.length>0?t:null},getNextSibling:function(e){var t=this._getNext(e,!0);return t&&t.length>0?t:null},getChildren:function(e){e=e||-1;var t=this._getChildren(e);return(t=t&&t.length?t.not("."+i._OJ_TEMPNODE):t)&&t.length>0?t:null},scrollIntoView:function(e,t,i){var n,a;if(e?(n=e.node,n=this._getNode(n)):n=-1,-1==n&&(n=this._$container.find("> ul > li:first-child")),n&&n.length)return a="top"==t,(i=!!i)&&(this._$container_ul.focus(),this.hover(n)),n[0].scrollIntoView(a),this},_ComponentCreate:function(){if(this._super(),this._index=this._newIndex(),this._elemId=this.element.attr("id"),void 0===this._elemId&&(this._elemId="oj-tree-"+this._getIndex(),this.element.attr("id",this._elemId)),this._$container=this.element,this._$container_ul=null,this._data={},this._tds=null,this._isRtl="rtl"===this._GetReadingDirection(),this._isTouch=e.DomUtils.isTouchSupported(),this._initTree(),this._animDuration=this._getAnimDuration(),this._animDuration){var t=e.AgentUtils.getAgentInfo();this._isSafari=t.browser===e.AgentUtils.BROWSER.SAFARI,this._proxyTransitionEndHandler=this._transitionEndHandler.bind(this)}this._busyStack=[],this._start()},_destroy:function(){this._resolveBusyContext(),this._clearTree(),this._data.html.markup_ul&&(this._unTransformElemIds(this._data.html.markup_ul),this._$container.append(this._data.html.markup_ul),this._data.html.markup_div.remove(),this._data.html.markup_div=!1,this._data.html.useExistingMarkup=!1),this._data.ds.type=0,this._super()},_setOption:function(e,i,n){var a;if("selection"===e)i="string"==typeof i?[i]:i&&i.length?i:[],this._data.core.suppressSelectEvent=!0,this._handleSelectionOptionChange(i),this._data.core.suppressSelectEvent=!1,i=this._getSelected();else if("selectionMode"===e)"none"===i?a=0:"single"===i?a=1:"multiple"===i?a=-1:(a=0,i="none"),a!=this._data.core.selectMode&&(this._data.core.selectMode=a);else if("icons"===e)"boolean"==t.type(i)&&i!=this._data.themes.icons&&(this._data.themes.icons=i,i?this._showIcons():this._hideIcons());else if("contextMenu"===e)this._clearMenu(),i&&(this._initMenuOpts(),this._initMenu(i));else if("disabled"===e)this._handleDisabledChanged(i);else{if("data"===e)return this._super(e,i,n),this._initDSOpts(),this._initDataSource(),this._initExpandedOpts(),void this._loadNodes();if("dnd"===e)return this._super(e,i,n),void this._getDndContext().handleDnDOptionChange(i);"emptyText"==e&&(i=this._escapeHtml(i))}this._super(e,i,n)},_CompareOptionValues:function(e,t,i){return"selection"===e?this._compareSelectionValues(t,i):this._superApply(arguments)},_compareSelectionValues:function(e,i){var n,a,s,r,o,d=!1,l=!1;if((r=e&&e.length?e.length:0)!==(o=i&&i.length?i.length:0))d=!0;else if(0==r&&0===o)d=!1;else for(n=0;n<r;n++){for(s=t(e[n]).attr("id"),l=!1,a=0;a<o;a++)if(s==t(i[a]).attr("id")){l=!0;break}if(!l){d=!0;break}}return!d},_addBusyState:function(t){if(!this._animationResolve){var i=e.Context.getContext(this.element[0]).getBusyContext();this._animationResolve=i.addBusyState({description:t})}},_resolveBusyContext:function(){this._animationResolve&&(this._animationResolve(),this._animationResolve=null)},_isOnBusyStack:function(e,t){var i,n=this._busyStack,a=n.length,s=-1;for(i=0;i<a;i++)if(n[i].id===t&&n[i].op===e){s=i;break}return s},_removeFromBusyStack:function(e,t){var i=this._isOnBusyStack(e,t);return i>=0&&this._busyStack.splice(i,1),i},_resolveIfBusyStackEmpty:function(){0===this._busyStack.length&&this._resolveBusyContext()},_clearTree:function(){this._TreeDndContext&&(this._TreeDndContext._closedown(),this._TreeDndContext=null);var e=this._getIndex();this._$container.unbind(".oj-tree").undelegate(".oj-tree").removeData("oj-tree-instance-id").find("[class^='oj-tree']").addBack().attr("class",function(){return this.className.replace(/oj-tree[^ ]*|$/gi,"")});var i,n=this._$container.attr("class");0===(n=n.trim()).length&&this._$container.removeAttr("class"),i=this._$container_ul,t.each(f,function(e){if(f[e]._selector===i)return t(i).off("keydown"),f[e]=null,f.splice(e,1),!1}),t(document).unbind(".oj-tree-"+e).undelegate(".oj-tree-"+e),this._$container_ul.remove(),this._$container_ul=null},_getNode:function(e,i){if(null==e)return i?this._data.ui.selected:this._data.ui.lastSelected;var n=t(e,this._getContainer());return n.is(".oj-tree")||-1===e?-1:!!(n=n.closest("li",this._getContainer())).length&&n},_getPrev:function(e,t){if(-1===(e=this._getNode(e)))return this._$container.find("> ul > li:last-child");if(!e.length)return!1;if(t)return e.prevAll("li").length>0&&e.prevAll("li:eq(0)");if(e.prev("li").length){for(e=e.prev("li").eq(0);e.hasClass(i._OJ_EXPANDED);)e=e.children("ul:eq(0)").children("li:last");return e}var n=e.parentsUntil(".oj-tree","li:eq(0)");return!!n.length&&n},_getNext:function(e,t){return-1===(e=this._getNode(e))?this._$container.find("> ul > li:first-child"):!!e.length&&(t?e.nextAll("li").length>0&&e.nextAll("li:eq(0)"):e.hasClass(i._OJ_EXPANDED)?e.find("li:eq(0)"):e.nextAll("li").length>0?e.nextAll("li:eq(0)"):e.parentsUntil(".oj-tree","li").next("li").eq(0))},_getParent:function(e){if(-1==(e=this._getNode(e))||!e.length)return!1;var t=e.parentsUntil(".oj-tree","li:eq(0)");return t.length?t:-1},_getChildren:function(e){return-1===(e=this._getNode(e))?this._$container.children("ul:eq(0)").children("li"):!!e.length&&e.children("ul:eq(0)").children("li")},_isLeaf:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(r)},_getNodeElem:function(e){var i=this._$container_ul.find(e),n=!1;return i&&i.length&&i.length>0&&t(i).is("li")&&(n=i),n},_isSelected:function(e){var t=this._getNode(e),i=!1;return t&&t.length&&this._data.ui.selected&&(i=this._data.ui.selected.index(t)>=0),i},_reference:function(t,i){var n=t.parents("div").eq(0),a=e.Components.__GetWidgetConstructor(n);return a&&i&&a("getCI",i),this},getCI:function(e){e.ot=this},_applyDefaults:function(e,i){null!=e&&null!=i&&t.each(i,function(t,i){null==e[t]&&(e[t]=i)})},_handleDisabledChanged:function(e){var t;void 0!==e&&((t=this._$container_ul.hasClass(i._OJ_DISABLED))||(t=!1),t!=e&&(e?(this._$container_ul.addClass(i._OJ_DISABLED),this._$container_ul.prop("disabled",!0)):(this._$container_ul.removeClass(i._OJ_DISABLED),this._$container_ul.prop("disabled",!1)),this._treeDisable(e)))},_treeDisable:function(e){(e=e||!1)?(this._data.core.locked=!0,this._data.ui.opacity=this._$container.children("ul").css("opacity"),this._$container_ul.addClass(i._OJ_DISABLED).css("opacity","0.9")):(this._data.core.locked=!1,this._$container_ul.removeClass(i._OJ_DISABLED).css("opacity",this._data.ui.opacity))},_isTreeDisabled:function(){return this._data.core.locked},_handleSelectionOptionChange:function(e){var i,n,a,s,r=e.slice(0),o=[],d=this;t.grep(r,function(e,t){return!!(i=d._getNodeElem(e))&&(o.push(i),r[t]=i[0],!0)});var l=this._getSelected();t.each(l,function(e,i){for(s=o.length,n=t(i).attr("id"),a=!1,e=0;e<s;e++)if(n==o[e].attr("id")){a=!0;break}a||d._deselect(i)}),this._setSelected(o,null)},_prepare_move:function(e,t,i,n,a){var s={};if(t=-1!==t&&t?this._getNode(t):-1,this._reference(e,s),s.rt=this,s.o=s.ot._getNode(e),s.r=t,s.p=void 0===i||!1===i?"last":i,a||!this._data.core.prepMoveBlk.o||this._data.core.prepMoveBlk.o[0]!==s.o[0]||this._data.core.prepMoveBlk.r[0]!==s.r[0]||this._data.core.prepMoveBlk.p!==s.p){if(-1!==s.r&&s.r){if(!/^(before|after)$/.test(s.p)&&!this._is_loaded(s.r))return this._load_node(s.r,function(){this._prepare_move(e,t,i,n,!0)});switch(s.p){case"before":s.cp=s.r.index(),s.cr=s.rt._getParent(s.r);break;case"after":s.cp=s.r.index()+1,s.cr=s.rt._getParent(s.r);break;case"inside":case"first":s.cp=0,s.cr=s.r;break;case"last":s.cp=s.r.find(" > ul > li").length,s.cr=s.r;break;default:s.cp=s.p,s.cr=s.r}}else switch(s.cr=-1,s.p){case"first":case"before":case"inside":s.cp=0;break;case"after":case"last":s.cp=s.rt._$container.find(" > ul > li").length;break;default:s.cp=s.p}s.np=-1==s.cr?s.rt._getContainer():s.cr,s.op=s.ot._getParent(s.o),s.cop=s.o.index(),-1===s.op&&(s.op=s.ot?s.ot._$container:this._$container),!/^(before|after)$/.test(s.p)&&s.op&&s.np&&s.op[0]===s.np[0]&&s.o.index()<s.cp&&s.cp++,s.or=s.np.find(" > ul > li:nth-child("+(s.cp+1)+")"),this._data.core.prepMoveBlk=s,n&&n.call(this,this._data.core.prepMoveBlk,"prepare_move")}else n&&n.call(this,this._data.core.prepMoveBlk)},_checkMove:function(){var e,t=this._data.core.prepMoveBlk,i=!0;if(e=-1===t.r?this._$container:t.r,!t||!t.o||t.or[0]===t.o[0])return!1;if(!t.r)return!1;if(!t.cy){if(t.op&&t.np&&t.op[0]===t.np[0]&&t.cp-1===t.o.index())return!1;t.o.each(function(){if(-1!==e.parentsUntil(".oj-tree","li").addBack().index(this))return i=!1,!1})}return i},_renameNode:function(e,t){var i;if(e=this._getNode(e),this.__rollback(),i=this.getText(e),e&&e.length){var n=this._emitEvent({obj:e,func:"rename",title:t,prevTitle:i},"before");if("boolean"==typeof n&&!n)return}e&&e.length&&this._set_text.apply(this,Array.prototype.slice.call(arguments))&&this._emitEvent({obj:e,title:t,prevTitle:i},"rename")},_moveNode:function(e,n,a,s,o,d){if(!o){e=this._getNode(e);var l=this._emitEvent({obj:e,func:"move"},"before");if("boolean"==typeof l&&!l)return!1}if(!(e.hasClass&&e.hasClass(i._OJ_DISABLED)||this._data.core.locked)){if(!o)return this._prepare_move(e,n,a,function(e){e.ot===e.rt||e.cy||e.ot.deselect(e.o),this._moveNode(e,!1,!1,s,!0,d)});if(s&&(this._data.core.prepMoveBlk.cy=!0),!d&&!this._checkMove())return!1;this.__rollback();var h=!1;s?(h=e.o.clone(!0)).find("*[id]").addBack().each(function(){this.id&&(this.id="copy_"+this.id)}):h=e.o,e.or.length?e.or.before(h):(e.np.children("ul").length||t("<ul />").appendTo(e.np),e.np.children("ul:eq(0)").append(h));try{e.ot._cleanNode(e.op),e.rt._cleanNode(e.np),e.op.find("> ul > li").length||e.op.removeClass("oj-expanded oj-collapsed").removeAttr("aria-expanded").addClass(r).children("ul").remove()}catch(e){}s&&(this._data.core.prepMoveBlk.cy=!0,this._data.core.prepMoveBlk.oc=h);var c=t.extend(!0,{},this._data.core.prepMoveBlk);return c.obj=e.o,this._emitEvent(c,"move"),this._data.core.prepMoveBlk}},_getMoveBlk:function(){return this._data.crrm.prepMoveBlk},_getType:function(e){var t=null;return this.options.types&&(t=this._getNode(e)),!(!t||!t.length)&&(t.attr(this.options.types.attr)||"default")},_setType:function(e,t){var i,n,a=this.options.types,s=!1;return e=this._getNode(e),a&&e&&-1!=e&&e.length&&t&&(i=a.attr,n=a.types,i&&n&&n[t]&&(e.attr(i,t),e.addClass("oj-tree-type"),s=!0)),s},_canTypedNodeMove:function(e,t){var i,n,a=!0;return(i=this.options.types)&&(i=i.types)&&(i[n=this._getType(e)]&&void 0!==i[n][t]||i.default&&void 0!==i.default[t])&&!1===this._check(t,e)&&(a=!1),a},_check:function(e,i,n){i=this._getNode(i);var a=!1,s=this._getType(i),r=this._getOptions().types,o=!1;if(-1===i){if(!r[e])return;a=r[e]}else{if(!1===s)return;(o=!!this._data.types.defaults.useData&&i.data("oj-tree"))&&o.types&&void 0!==o.types[e]?a=o.types[e]:r.types[s]&&void 0!==r.types[s][e]?a=r.types[s][e]:r.types.default&&void 0!==r.types.default[e]&&(a=r.types.default[e])}return t.isFunction(a)&&(a=a.call(this,i)),a},_cleanNode:function(n){var a,s,l,c=this._getDndContext(),_=e.TreeDndContext;c.isDragEnabled()&&(a=_._OJ_DRAGGABLE,s="draggable",l=!0),c.isDropEnabled()&&(a+=" "+_._OJ_VALID_DROP),(n=(n=n&&-1!=n?t(n):this._$container_ul).is("li")?n.find("li").addBack():n.find("li")).removeClass("oj-tree-last").addClass("oj-tree-node").addClass(a).attr(s,l).filter("li:last-child").addClass("oj-tree-last").end().filter(":has(li)").not(".oj-expanded").removeClass(r).addClass(i._OJ_COLLAPSED).attr("aria-expanded","false"),n.not(".oj-expanded, .oj-collapsed").addClass(r).children("ul").remove();var u,p,f=!!this.options.types&&this.options.types.attr;n.find("li");t.each(n,function(e,i){p=t(this),(u=p.find("> ins")).length>1&&(u=t(u[0])),p.hasClass(r)?(u.removeClass(h),u.addClass(o)):(u.addClass(h),u.removeClass(d)),f&&p.attr(f)&&p.addClass("oj-tree-type")})},_createNode:function(e,n,a,s,r){if(e=e||-1,-1!==(e=this._getNode(e))&&!e.length)return null;var o,d;this.options;if(n=void 0===n?"last":n,!r&&!this._is_loaded(e))return this._load_node(e,function(){this._createNode(e,n,a,s,!0)}),null;if(this.__rollback(),!(a=this._parseJson(a)))return null;switch(a=a.children(),o=t(a[0]),-1===e&&(e=this._$container,"before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":e.before(o),d=this._getParent(e);break;case"after":e.after(o),d=this._getParent(e);break;case"inside":case"first":e.children("ul").length||e.append("<ul />"),e.children("ul").prepend(o),d=e;break;case"last":e.children("ul").length||e.append("<ul />"),e.children("ul").append(o),d=e;break;default:e.children("ul").length||e.append("<ul />"),n||(n=0),(d=e.children("ul").children("li").eq(n)).length?d.before(o):e.children("ul").append(o),d=e}return-1!==d&&d.get(0)!==this._$container.get(0)||(d=-1),this._cleanNode(d),this._emitEvent({obj:o,parent:d},"create"),s&&s.call(this,o),this._$container_ul[0].childNodes.length>1&&this._$container_ul.find("."+i._OJ_TEMPNODE).remove(),o},_expand:function(e,n,a){if(!(e=this._getNode(e))||!e.length)return!1;if(a=a||!1,!e.hasClass(i._OJ_DISABLED)&&!this._data.core.locked){if(!e.hasClass(i._OJ_COLLAPSED))return n&&n.call(),!1;var s=this._emitEvent({obj:e,func:"expand"},"before");if("boolean"!=typeof s||s){var r=a?0:this._animDuration,o=this;this._is_loaded(e)?(this.options.expandParents&&e.parentsUntil(".oj-tree",".oj-collapsed").each(function(){o._expand(this,!1,!0)}),e.removeClass(i._OJ_COLLAPSED).addClass(i._OJ_EXPANDED).attr("aria-expanded","true").children("a").removeClass(l),t(e.children()[0]).removeClass(i._OJ_SELECTED).addClass("oj-default"),this._busyStack.push({op:"e",id:e.attr("id")}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+e.attr("id")+"' is animating."),!a&&r?this._slide(e,!1):this._transitionEnd(t(e.children("UL")[0]),e),n&&n.call()):(e.children("a").addClass(l),this._load_node(e,function(){o._expand(e,n,a)},n))}}},_expandAll:function(e,t,i){var n=e||-1;(e=e?this._getNode(e):-1)&&-1!==e?n=e:e=this._$container_ul,i?e=e.find("li.oj-collapsed"):(i=e,e=e.is(".oj-collapsed")?e.find("li.oj-collapsed").addBack():e.find("li.oj-collapsed"));var a=this;e.each(function(){var e=this;a._is_loaded(this)?a._expand(this,!1,!t):a.expand(this,function(){a._expandAll(e,t,i)},!t)}),0===i.find("li.oj-collapsed").length&&this._emitEvent({obj:e,targ:n},"expandAll")},_select:function(t,n,a){var s=this._data.core,r=this._data.ui,o=s.selectMode;if(0==o)return!1;if(-1==(t=this._getNode(t))||!t||!t.length)return!1;if(t.hasClass(i._OJ_DISABLED)||s.locked)return!1;a&&"touchend"==a.type||(r.touchEvent=!1);var d=this._isSelected(t);if(!d){var l=this._emitEvent({obj:t,func:"select"},"before");if("boolean"==typeof l&&!l)return!1}var h=this.options.selection.slice(0),c=this.options,_=r.defaults.selectMultipleModifier,u=r.defaults.selectRangeModifier,p=r.defaults.disableSelectingChildren,f="on"==_||!1!==_&&a&&e.DomUtils.isMetaKeyPressed(a),g=!1!==u&&a&&a[u+"Key"]&&r.lastSelected&&this._data.ui.lastSelected[0]!==t[0]&&r.lastSelected.parent()[0]===t.parent()[0],m=!0,v=this;if(n){if(p&&f&&(t.parentsUntil(".oj-tree","li").children("a.oj-selected").length||t.children("ul").find("a.oj-selected:eq(0)").length))return!1;switch(m=!1,!0){case g:r.lastSelected.addClass("oj-tree-last-selected"),t=t[t.index()<r.lastSelected.index()?"nextUntil":"prevUntil"](".oj-tree-last-selected").addBack(),-1==o||t.length<o?(r.lastSelected.removeClass("oj-tree-last-selected"),r.selected.each(function(){this!==r.lastSelected[0]&&v._deselect(this)}),d=!1,m=!0):m=!1;break;case r.touchEvent&&-1==o:r.touchEvent=!1,this.toggleSelect(t),m=!1;break;case d&&!f:if(!a)break;this._deselectAll(),r.spacebar||(d=!1),m=!0;break;case!d&&!f:a?r.selected&&1==r.selected.length?this._deselect(r.selected):this._deselectAll(r.selected):1===o?this._deselect(r.selected):o>1&&this._deselectAll(),m=!0;break;case d&&f:this.deselect(t);break;case!d&&f:(-1==o||r.selected.length+1<=o)&&(m=!0)}}var D=!1;return m&&!d&&(g||(r.lastSelected=t),t.children("a").addClass(i._OJ_SELECTED),t.attr("aria-selected","true"),D=!0,c.selectedParentExpand&&t.parents(".oj-collapsed").each(function(){v._expand(this,!1,!0)}),r.selected=r.selected.add(t),this._fix_scroll(t.eq(0)),s.suppressSelectEvent||this._fireOptionChangeEvent("selection",h,null,a)),D},_deselect:function(e){if(!(e=this._getNode(e)).length)return!1;e.hasClass(i._OJ_DISABLED)||this._data.core.locked||this._isSelected(e)&&(e.children("a").removeClass(i._OJ_SELECTED),e.removeAttr("aria-selected"),this._data.ui.selected=this._data.ui.selected.not(e),this._data.ui.lastSelected&&this._data.ui.lastSelected.length&&this._data.ui.lastSelected.get(0)===e.get(0)&&(this._data.ui.lastSelected=this._data.ui.selected.eq(0)))},_deselectAll:function(e){if(!this._data.core.locked){var i=e?t(e).find("a.oj-selected").parent():this._$container.find("a.oj-selected").parent();if(i.not(".oj-disabled"),0!==i.length){var n=this;t.each(i,function(){n._deselect(this)})}}},_setSelected:function(e,i){if(this._data.core.locked)return null;if(e&&e.length>0){var n=this;t.each(e,function(e,t){t&&n._select(t,!0,i)})}},_handleNodeTapClick:function(e){if(e.preventDefault(),e.currentTarget.blur(),!t(e.currentTarget).hasClass(l)){if(this._setFocus(),!this._data.ui.focused){var i=this._getNode(e.currentTarget);i.length>0&&-1!=i&&(this._data.ui.lastHovered=i),this._$container_ul.focus()}this._select(e.currentTarget,!0,e)}this._data.ui.touchEvent=!1},_disclosureHover:function(e,n){if(!(e=t(e)).hasClass(i._OJ_DISABLED)&&!this._data.core.locked){var a=e.parent(),s=a.hasClass(i._OJ_EXPANDED),r=a.hasClass(i._OJ_COLLAPSED);(s||r)&&(n?(e.addClass(i._OJ_HOVER),e.removeClass("oj-default"),e.removeClass(i._OJ_SELECTED)):(e.removeClass(i._OJ_HOVER),e.addClass("oj-default")))}},_hover:function(e){if(!this._data.menu.activeNode&&(e=this._getNode(e)).length&&!e.hasClass(i._OJ_DISABLED)&&!this._data.core.locked&&!e.hasClass(i._OJ_HOVER)){var t=this._emitEvent({obj:e,func:"hover"},"before");("boolean"!=typeof t||t)&&(e.hasClass(i._OJ_HOVER)||this._dehover(),this._data.ui.hovered=e.children("a").addClass(i._OJ_HOVER).parent(),this._$container_ul.attr("aria-activedescendant",this._data.ui.hovered.attr("id")),this._fix_scroll(e),this._emitEvent({obj:e},"hover"))}},_dehover:function(){if(!this._data.menu.activeNode){var e,t=this._data.ui.hovered;t&&t.length&&(t.hasClass(i._OJ_DISABLED)||this._data.core.locked||((e=t.find("a.oj-hover")).length||(e=this._$container_ul.find("a.oj-hover")).length)&&(e=e.removeClass(i._OJ_HOVER).parent(),this._$container_ul.removeAttr("aria-activedescendant"),this._data.ui.hovered=null,null!=t.attr("id")&&this._emitEvent({obj:t},"dehover")))}},_refresh:function(e){this._refresh_core(e)},_refresh_core:function(e){var t=e||-1,i=this;this._save_opened(),this._saveSelected(),e||(e=-1),(e=this._getNode(e))?t=e:e=-1,-1!==e?e.children("UL").remove():(this._$container_ul.empty(),this._processExistingMarkup()),this._load_node(e,function(){i._emitEvent({obj:t},"refresh"),i._reload_nodes(),i._rehover()})},_refresh_ui:function(e){this._saveSelected(),this._refresh_core(e)},after_close:function(e){this._emitEvent({obj:e},"after_close",!0)},_reopen:function(){var e=this;this._data.core.toExpand.length&&t.each(this._data.core.toExpand,function(t,i){e._expand(i,!1,!0)}),this._emitEvent({},"reopen",!0)},_rehover:function(){var e,t=this._data.ui.lastHovered;t&&(e=t.attr("id"))&&(t=this._getNode("#"+e)),this._data.ui.hovered=this._data.ui.lastHovered=t},_getSelected:function(e){var i,n,a,s;for(n=[],s=(i=e?t(e).find("a.oj-selected").parent():this._data.ui.selected).length,a=0;a<s;a++)n.push(i[a]);return n},_set_text:function(e,t){return!!(e=this._getNode(e)).length&&(e=(e=e.children("a:eq(0)")).find("span:eq(0)"),this._emitEvent({obj:e,name:t},"set_text",!0),e[0].textContent=t)},_loadNodes:function(){0!==this._data.ds.type&&-1!==this._data.ds.type?this._load_node(-1,function(){this._loaded(),this._reload_nodes()}):(this._applyEmptyText(),this._loaded())},_load_node:function(e,t,i){this._emitEvent({obj:e},"load_node",!0)},_is_loaded:function(e){return!0},_load_node_DS:function(e,t,i){var n=this;this._load_node_tree(e,function(){n._emitEvent({obj:n._getNode(e)},"load_node",!0),t.call(this)},i)},_is_loaded_DS:function(e){return-1===(e=this._getNode(e))||!e||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_refresh_DS:function(e){return(e=this._getNode(e))&&-1!==e&&e.removeData(c),this._refresh_ui(e)},_load_node_J:function(e,t,i){var n=this;this._loadNodeJson(e,function(){n._emitEvent({obj:n._getNode(e)},"load_node",!0),t.call(this)},i)},_is_loaded_J:function(e){var i=this.options.data;return-1==(e=this._getNode(e))||!e||!i.ajax&&!this._data.ds.progressiveRender&&!t.isFunction(i.data)||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_load_node_H:function(e,t,i){var n=this;this._loadNodeHtml(e,function(){n._emitEvent({obj:n._getNode(e)},"load_node",!0),t.call(this)},i)},_is_loaded_H:function(e){var i=this.options.data,n=null,a=null;return i&&(n=i.data||null,a=i.ajax||null),-1==(e=this._getNode(e))||!e||!a&&!t.isFunction(n)||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_reselect:function(){var e=this,i=this._data.ui.toSelect;(i=t.map(t.makeArray(i),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}))&&i.length&&(this.options.selection.length=0,this._data.ui.selected.length=t()),t.each(i,function(t,i){i&&"#"!==i&&e.select(i)}),this._data.ui.selected=this._data.ui.selected.filter(function(){return this.parentNode})},_saveSelected:function(){var e=this._data.ui;e.toSelect=[],e.selected.each(function(){this.id&&e.toSelect.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))})},rollback:function(e){e&&(t.isArray(e)||(e=[e]))},get_rollback:function(){return this._emitEvent(null,"get_rollback",!0),{i:this._getIndex(),h:this._$container.children("ul").clone(!0),d:this.data}},_load_node_tree:function(e,t,i){var n=e&&-1!=e?e[0].id:e||-1,a=this._JsonDSToJson(n,e);if(a.success){var s,r=!e||-1===e,o=this.options.data;if(o.data&&!o.ajax||o.data&&o.ajax&&r)r&&((s=this._parseJson(a.js,e))?(this._$container_ul.empty().append(s.children()),this._cleanNode()):this._data.ds.correctState&&this._$container_ul.empty()),t&&t.call(this);else if(!o.data&&o.ajax||o.data&&o.ajax&&!r)if(s=this._parseJson(a.js,e)){if(r){var d=this._$container_ul;d.empty().append(s.children()),d.attr("role","tree").attr("aria-labelledby",this._elemId).attr("tabindex","0").css("outline","none"),-1===this._data.core.selectMode&&d.attr("aria-multiselectable",!0)}else e.append(s).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading");this._cleanNode(e),t&&t.call(this)}else r?this._data.ds.correctState&&(this._$container_ul.empty(),t&&t.call(this)):(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),o.correct_state&&(this._correct_state(e),t&&t.call(this)))}},_JsonDSToJson:function(e,t){var i,n=[],a=this._tds,s={},r={success:!1,js:null};return-1==e&&(e=null,s.start=0),(i=a.getChildCount(e))>0?(s.count=i,a.fetchChildren(e,s,{success:function(e){for(var i,s=e.getCount(),o=0;o<s;o++){t={},(i=e.getData(o))&&(t.attr=i),t.title=e.m_nodes[o].title,i.metadata&&(t.metadata=e.m_nodes[o].metadata);var d=t.attr.id;if(a.getChildCount(d)>0){var l=this._JsonDSToJson(d,t);t.children=l.js}n.push(t)}r.success=!0,r.js=n}.bind(this),error:function(e){r.success=!1}})):r.success=!0,r},_refresh_json:function(e){if(e=this._getNode(e),!this._data.core.locked){var n=!e||-1!==e||!e.length;if(n||!e.hasClass(i._OJ_DISABLED)){var a=this.options.data.json;return!n&&this._data.ds.progressiveUnload&&(t.isFunction(a.data)||a.ajax)&&e.removeData(c),this._refresh_ui(e)}}},_loadNodeJson:function(e,i,n){var a,s=this._getOptions().data,r=function(){},o=function(){},d=s&&s.data||null,h=s&&s.ajax||null;if(!s||d||h||(d=s),(e=this._getNode(e))&&-1!==e&&(this._data.ds.progressiveRender||this._data.ds.progressiveUnload)&&!e.is(".oj-expanded, .oj-tree-leaf")&&0===e.children("ul").children("li").length&&e.data(c))return(a=this._parseJson(e.data(c),e))&&(e.append(a),this._data.ds.progressiveUnload||e.removeData(c)),this._cleanNode(e),void(i&&i.call(this));if(e&&-1!==e){if(e.data("oj-tree-is-loading"))return;e.data("oj-tree-is-loading",!0)}switch(!0){case!d&&!h:throw"ojTree - neither data nor ajax settings supplied.";case t.isFunction(d):d.call(this,e,function(t){(t=this._parseJson(t,e))?(-1!==e&&e?(e.append(t).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading")):this._$container_ul.empty().append(t.children()),this._cleanNode(e),i&&i.call(this)):(-1!==e&&e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),this._data.ds.correctState&&this._correct_state(e)):this._data.ds.correctState&&this._$container_ul.empty(),n&&n.call(this))}.bind(this));break;case!!d&&!h||!!d&&!!h&&(!e||-1===e):e&&-1!=e||((a=this._parseJson(d,e))?(this._$container_ul.empty().append(a.children()),this._cleanNode()):this._data.ds.correctState&&this._$container_ul.empty()),i&&i.call(this);break;case!d&&!!h||!!d&&!!h&&e&&-1!==e:r=function(t,i,a){var s=this.ctx;s._noteLoadFailureId(this.id,!0),s._removeFromBusyStack("j",-1===e?-1:e.attr("id")),s._resolveIfBusyStackEmpty();var r=s._getOptions().data.ajax.error;r&&r.call(s,i,a,t),-1!=e&&e.length?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),"success"===i&&s._data.ds.correctState&&s._correct_state(e)):("error"==i||"success"===i&&s._data.ds.correctState)&&(s._$container_ul.empty(),s._applyEmptyText()),n&&n.call(s)},o=function(t,n,a){var s=this.ctx;s._noteLoadFailureId(this.id,!1),s._removeFromBusyStack("j",this.id);var o=s._getOptions().data.ajax.success;if(o&&(t=o.call(s,t,n,a)||t),"string"==typeof t){var d=t.replace(/^[\s\n]+$/,"");try{d=JSON.parse(d)}catch(e){d=null}if(!d)return r.call(this,a,"Bad JSON","")}if(t=s._parseJson(t,e)){if(-1!==e&&e)e.append(t).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading");else{var h=s._$container_ul;h.empty().append(t.children()),h.attr("role","tree").attr("aria-labelledby",s._elemId).attr("tabindex","0").css("outline","none"),-1===s._data.core.selectMode&&h.attr("aria-multiselectable",!0)}s._cleanNode(e),i&&i.call(s)}else-1!==e&&e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),s._data.ds.correctState&&(s._correct_state(e),i&&i.call(s))):s._data.ds.correctState&&(s._$container_ul.empty(),i&&i.call(s))};var _=-1===e?-1:e.attr("id");this._busyStack.push({op:"j",id:_}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+_+"' is lazyloading.");var u={ctx:this,id:_};s.ajax.context=u,s.ajax.error=r,s.ajax.success=o,s.dataType||(s.ajax.dataType="json"),u.type=s.ajax.dataType,t.isFunction(s.ajax.url)&&(s.ajax.url=s.ajax.url.call(this,e),u.url=s.ajax.url),t.isFunction(s.ajax.data)&&(s.ajax.data=s.ajax.data.call(this,e)),t.ajax(s.ajax)}},_parseJson:function(e,n,a){var s,r,o,l,_,u,p=!1;if(!e)return p;if(this._data.ds.progressiveUnload&&n&&-1!==n&&n.data(c,p),"string"==typeof e)try{e=JSON.parse(e)}catch(t){e=[]}if(t.isArray(e)){if(p=t("<ul>"),!e.length)return!1;for(r=0,o=e.length;r<o;r++)(s=this._parseJson(e[r],n,!0)).length&&(p=p.append(s));p=p.children()}else{"string"==typeof e&&(e={data:e}),u="string"==typeof e.title?e.title:" ",p=t("<li role='treeitem' />"),e.attr&&(this._data.types.defType&&!e.attr.type&&(e.attr.type="oj-tree-deftype",p.addClass("oj-tree-type")),p.attr(e.attr)),e.metadata&&p.data(e.metadata),e.children&&0===e.children.length&&p.addClass(i._OJ_COLLAPSED),e.state&&"s"===e.state&&p.addClass(i._OJ_SELECTED),e.data||(e.data={dummy:0});var f,g=!1;s=t("<a/>"),t.each(e.data,function(i,n){t.isFunction(n)&&(n=n.call(this,e)),"object"==typeof n&&("attr"==i?s.attr(n):"style"==i&&s.css(n),"language"==i&&s.addClass(n)),g||((f=t("<span class='oj-tree-title'>"))[0].textContent=u,s.prepend("<ins class='oj-tree-icon "+d+" oj-component-icon'>&#160;</ins>",f),g=!0),!n.icon&&e.icon&&(n.icon=e.icon),n.icon&&(-1===n.icon.indexOf("/")?s.children("ins").addClass(n.icon):s.children("ins").css("background","url('"+n.icon+"') center center no-repeat"))}),p.append(s),p.prepend("<ins class='"+h+"'>&#160;</ins>"),e.children&&(this._data.ds.progressiveRender&&"expanded"!==e.state?p.addClass(i._OJ_COLLAPSED).attr("aria-expanded","false").data(c,e.children):(this._data.ds.progressiveUnload&&p.data(c,e.children),t.isArray(e.children)&&e.children.length&&(s=this._parseJson(e.children,n,!0)).length&&((_=t("<ul role='group' />")).append(s),p.append(_))))}return a||((l=t("<ul />")).append(p),p=l),p},__getJson:function(e,i,n,a){var s,r,o,d,l,h,c,_,u,p=[],f=this.options,g=this;return(e=this._getNode(e))&&-1!==e||(e=this._$container.find("> ul > li")),i=t.isArray(i)?i:["id","class"],!a&&f.types&&i.push(f.types.attr),n=t.isArray(n)?n:[],e.each(function(){d=t(this),s={},u=g._noteUserAttrs(d),(i.length||u&&u.length)&&(s.attr={}),u&&t.each(u,function(e,t){d.attr(t).length>0&&(s.attr[t]=d.attr(t))}),t.each(i,function(e,t){(r=d.attr(t))&&r.length&&r.replace(/oj-tree[^ ]*/gi,"").length&&(r=(" "+r).replace(/ oj-tree[^ ]*/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(s.attr[t]=r)}),g._getDndContext().isDragEnabled()&&g._isSelected(d)&&(s.state="s"),function(e){var t=!0;for(var i in e)if(e.hasOwnProperty(i)){t=!1;break}return t}(o=d.data())||(s.metadata=o),l=d.children("a"),r=null,l.each(function(){h=t(this),n.length||h.children("ins").get(0).style.backgroundImage.length||h.children("ins").get(0).className&&h.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").length?(_=g.getText(h),t.each(n,function(e,t){(c=(" "+(h.attr(t)||"")).replace(/ oj-tree[^ ]*/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(r||(r={attr:{}}),r.attr[t]=c)}),h.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").replace(/^\s+$/gi,"").length&&(c=h.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(r||(r={}),r.icon=c),h.children("ins").get(0).style.backgroundImage.length&&(c=h.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")).length&&(r||(r={}),r.icon=c)):_=g.getText(h),null!=r&&(s.data||(s.data=[]),l.length>1?s.data.push(r):s.data=r),s.title=_}),(d=d.find("> ul > li")).length&&(s.children=g.__getJson(d,i,n,!0)),p.push(s)}),p},_noteUserAttrs:function(e){var t,i,n,a;if((t=e[0].attributes)&&t.length){n=[],a=p.length;for(var s=0;s<t.length;s++)if(i=t[s]){i=i.name;for(var r=0;r<a&&(p[r]!=i&&0!=i.indexOf("aria-"));r++);r>=a&&n.push(i)}}return n&&n.length>0?n:null},_correct_state:function(e){if(!(e=this._getNode(e))||-1===e)return!1;e.removeClass("oj-collapsed oj-expanded").removeAttr("aria-expanded").addClass(r).children("ul").remove(),e.find("ins:first-child").removeClass(h).addClass(o),this._emitEvent({obj:e},"correct_state",!0)},_loaded:function(){this._emitEvent(null,"loaded")},_loadNodeHtml:function(e,i,n){var a,s=this._getOptions().data,r=function(){},c=function(){},_=s&&s.data||null,u=s&&s.ajax||null;if((e=this._getNode(e))&&-1!==e){if(e.data("oj-tree-is-loading"))return;e.data("oj-tree-is-loading",!0)}switch(!0){case!_&&!u&&s&&"string"==typeof s:this._loadHtmlString(s,e,i,n);break;case t.isFunction(_):_.call(this,e,function(t){this._loadHtmlString(t,e,i,n)}.bind(this));break;case!_&&!u:e&&-1!=e||(this._$container_ul.empty().append(this._data.html.cloneMarkup).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon' >&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li").children("ins:first-child").addClass(h),this._insertHtmlTextSpan(this._$container_ul),this._data.types.defType&&this._addDefType(this._$container_ul),this._cleanNode(),this._$container_ul.find("ul").attr("role","group"),this._$container_ul.find("li").attr("role","treeitem")),i&&i.call(this);break;case!!_&&!u||!!_&&!!u&&(!e||-1===e):e&&-1!=e||((a=t(_)).is("ul")||(a=t("<ul />").append(a)),this._$container_ul.empty().append(a.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),this._insertHtmlTextSpan(this._$container_ul),this._data.types.defType&&this._addDefType(this._$container_ul),this._cleanNode(),this._$container_ul.find("ul").attr("role","group"),this._$container_ul.find("li").attr("role","treeitem")),i&&i.call(this);break;case!_&&!!u||!!_&&!!u&&e&&-1!==e:e=this._getNode(e),r=function(t,i,a){var s=this.ctx;s._noteLoadFailureId(this.id,!0),s._removeFromBusyStack("j",-1===e?-1:e.attr("id")),s._resolveIfBusyStackEmpty();var r=s._getOptions().data.ajax.error;r&&r.call(s,t,i,a),-1!=e&&e.length?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),"success"===i&&s._data.ds.correctState&&s._correct_state(e)):"success"===i&&s._data.ds.correctState&&(s._$container_ul.empty(),s._applyEmptyText()),n&&n.call(s)},c=function(n,a,s){var c,_=this.ctx;_._noteLoadFailureId(this.id,!1),_._removeFromBusyStack("j",-1===e?-1:e.attr("id"));var u=_._getOptions().data.ajax.success;if(u&&(n=u.call(_,n,a,s)||n),""===n||n&&n.toString&&""===n.toString().replace(/^[\s\n]+$/,""))return r.call(_,s,a,"");if(n){(n=t(n)).is("ul")||(n=t("<ul />").append(n)),-1!=e&&e?(e.children("a.oj-tree-loading").removeClass(l),_._removeEmptyUL(e),e.append(n).children("ul").find("li, a").filter(function(){return!_.firstChild||!_.firstChild.tagName||"INS"!==_.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),e.removeData("oj-tree-is-loading"),e.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),c=e):(_._$container_ul.empty().append(n.children()).find("li, a").filter(function(){return!_.firstChild||!_.firstChild.tagName||"INS"!==_.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),_._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),c=_._$container_ul),_._handleHtmlParentNoChildren(c),_._insertHtmlTextSpan(c);var p=c.children("UL");p.length>=1&&(p=p.first().find("span.oj-tree-title"),t.each(p,function(){this.textContent=_._escapeHtml(this.textContent)})),_._data.types.defType&&c&&_._addDefType(this._$container_ul),_._cleanNode(e),i&&i.call(_)}else e&&-1!==e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),_._data.ds.correctState&&(_._correct_state(e),i&&i.call(_))):_._data.ds.correctState&&(_._$container_ul.empty(),i&&i.call(_)),_._$container_ul.find("ul").attr("role","group"),_._$container_ul.find("li").attr("role","treeitem")};var p=-1===e?-1:e.attr("id");this._busyStack.push({op:"j",id:p}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+p+"' is lazyloading.");var f={ctx:this,id:p};s.ajax.context=f,s.ajax.error=r,s.ajax.success=c,s.ajax.dataType||(s.ajax.dataType="html"),f.type=s.ajax.dataType,t.isFunction(s.ajax.url)&&(s.ajax.url=s.ajax.url.call(this,e),f.url=s.ajax.url),t.isFunction(s.ajax.data)&&(s.ajax.data=s.ajax.data.call(this,e)),t.ajax(s.ajax)}},_handleHtmlParentNoChildren:function(e){var n=e.find(e.is("ul")?"li ul":"ul").filter(function(){return!this.firstChild||0==this.childNodes.length||1==this.childNodes.length&&3==this.firstChild.nodeType});t.each(n,function(){t(this).closest("li").addClass(i._OJ_COLLAPSED)})},_removeEmptyUL:function(e){var t=e.find("ul").filter(function(){return!this.firstChild||0==this.childNodes.length||1==this.childNodes.length&&3==this.firstChild.nodeType});t.length>0&&t.remove()},_loadHtmlString:function(e,i,n,a){var s;if(e&&""!==e&&e.toString&&""!==e.toString().replace(/^[\s\n]+$/,"")){(e=t(e)).is("ul")||(e=t("<ul />").append(e)),-1!=i&&i?(i.children("a.oj-tree-loading").removeClass(l),i.append(e).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass("oj-tree-node-icon").addClass("oj-tree-icon"),i.removeData("oj-tree-is-loading"),s=i,this._addDefType(this.obj)):(this._$container_ul.empty().append(e.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon oj-tree-disclosure-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),s=this._$container_ul,this._addDefType(this._$container_ul)),s&&this._insertHtmlTextSpan(s);var r=s.children("UL");if(r.length>=1){r=r.first().find("span.oj-tree-title");var c=this;t.each(r,function(){this.textContent=c._escapeHtml(this.textContent)})}this._cleanNode(i),n&&n.call(this)}else i&&-1!==i?(i.children("a.oj-tree-loading").removeClass(l),i.removeData("oj-tree-is-loading"),this._data.ds.correctState&&(this._correct_state(i),n&&n.call(this))):this._data.ds.correctState&&(this._$container_ul.empty(),n&&n.call(this))},_insertHtmlTextSpan:function(e){t.each(e.find("li a"),function(e,t){var i=t.innerHTML;i=i.replace("ins>","ins><span class='oj-tree-title'>"),i+="</span>",t.innerHTML=i})},_addDefType:function(e){var i,n;this._data.types.defType&&(i=this.options.types,n=i?i.attr:this._data.types.defaults.attr,t.each(e.find("li"),function(e,i){(i=t(i)).attr(n)||i.attr(n,"oj-tree-deftype").addClass("oj-tree-type")}))},_save_opened:function(){var e=this;this._data.core.toExpand=[],this._$container_ul.find("li.oj-expanded").each(function(){this.id&&e._data.core.toExpand.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))})},_reload_nodes:function(e){var i,n=this,a=!0,s=[],r=[];e||(this._data.core.reopen=!1,this._data.core.refreshing=!0),this._isOptExpandAll()&&(this._data.core.toExpand=[],this._$container_ul.find("li.oj-collapsed").each(function(){i="#"+t(this).attr("id"),n.isExpanded(i)||n._isLoadFailureId(i)||n._data.core.toExpand.push(i)})),this._data.core.toExpand=t.map(t.makeArray(this._data.core.toExpand),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this._data.core.toLoad=t.map(t.makeArray(this._data.core.toLoad),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this._data.core.toExpand.length&&(this._data.core.toLoad=this._data.core.toLoad.concat(this._data.core.toExpand),this._data.core.toLoad=this._data.core.toLoad.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])),this._data.core.toLoad.length&&(t.each(this._data.core.toLoad,function(e,t){if("#"==t)return!0;n._$container.find(t).length?n.isExpanded(t)||s.push(t):r.push(t)}),s.length&&(this._data.core.toLoad=r,t.each(s,function(e,t){n._is_loaded(t)||(n._load_node(t,function(){n._reload_nodes(!0)},function(){n._reload_nodes(!0)}),a=!1)}))),this._data.core.toExpand.length&&t.each(this._data.core.toExpand,function(e,t){n.isExpanded(t)||n._expand(t,!1,!0)}),a&&(this._data.core.reopen&&clearTimeout(this._data.core.reopen),this._data.core.reopen=setTimeout(function(){n._emitEvent({},"reload_nodes",!0),n._resolveIfBusyStackEmpty()},50),this._data.core.refreshing=!1,this._reopen())},setTheme:function(e,i){if(!e)return!1;i||(i=this._data.themes._themes+e+"/style.css"),-1==t.inArray(i,this._data.themes.themes_loaded)&&(m({url:i}),this._data.themes.themes_loaded.push(i)),this._data.themes.theme!=e&&(this._$container.removeClass("oj-tree-"+this._data.themes.theme),this._data.themes.theme=e),this._$container.addClass("oj-tree-"+e),this._data.themes.dots?this._showDots():this._hideDots(),this._data.themes.icons?this._showIcons():this._hideIcons()},_isTheme:function(){return null!=this._data.themes},_getTheme:function(){return this._data.themes.theme},isIcons:function(){return this._data.themes.icons},_showIcons:function(){this._data.themes.icons=!0,this._$container.children("ul").removeClass("oj-tree-no-icons")},_hideIcons:function(){this._data.themes.icons=!1,this._$container.children("ul").addClass("oj-tree-no-icons")},toggleIcons:function(){},_enableKeys:function(){this._data.keys.enabled=!0},_initTree:function(){this._initData(),this._initCoreOpts(),this._initUIOpts(),this._initDSOpts(!0),this._initTypeOpts(),this._getDndContext().initDnDOpts(),this._initMenuOpts(),this._initCore(),this._initUI(),this._initThemes(),this._initDataSource(),this._initTypes(),this._getDndContext().initDnD(),this._initKeys(),this._initMenu()},_emitEvent:function(e,i,n){if(i&&"string"===t.type(i)&&(!0!==this._data.core.locked||"unlock"===i||"isLocked"===i||"lock"===i)){var a,s=Array.prototype.slice.call(arguments),r=this._$container,o="before"===i,d=!n;d||(i="_tree"+i);var l={};if(l.item=e?e.obj:void 0,l.inst=r,o?(a=e.func,l.func=a,l.args=s,"rename"===a&&(l.title=e.title,l.prevTitle=e.prevTitle)):d&&("move"==i?(l.position=e.p,l.reference=e.r,l.data=e):"rename"==i?(l.title=e.title,l.prevTitle=e.prevTitle):"remove"==i?(l.parent=e.parent,l.prev=e.prev):"delete"==i?(l.prev=e.prev,l.parent=e.parent):"expandAll"===i||"collapseAll"===i||"deselectAll"===i?l.targ=e.targ:"loaded"===i?l.item=-1:"paste"==i&&(l.position=e.p,l.reference=e.r)),d){var h=this._trigger(i,new t.Event("oj"+i),l);if(o)return void 0!==h&&(h=!!h),h}else this._$container.trigger(i,l)}},_fireOptionChangeEvent:function(e,t,i,n){"selection"===e&&(null==i&&(i=this._getSelected()),this._compareSelectionValues(t,i)||this.option(e,i,{_context:{originalEvent:n,internalSet:!0},changed:!0}))},__rollback:function(){return this.get_rollback()},_start:function(){var e;this._isRtl&&this._$container.addClass("oj-tree-rtl").css("direction","rtl"),this._$container.html("<ul role='tree' tabindex='0' class='oj-tree-list' style='outline:none'"+(-1===this._data.core.selectMode?" aria-multiselectable='true'":"")+" aria-labelledby='"+this._elemId+"'><li class='oj-tree-last oj-tree-leaf'><ins class='oj-tree-icon'>&#160;</ins><a class='oj-tree-loading' href='#'><ins class='oj-tree-icon'>&#160;</ins>"+this._getString("stateLoading")+"</a></li></ul>"),this._$container_ul=this._$container.children("ul:eq(0)"),this._$container.data("oj-tree-instance-id",this._getIndex()),this._data.core.li_height=this._$container_ul.find("li.oj-collapsed, li.oj-tree-leaf").eq(0).height()||18,this._isTouch&&this._$container.delegate(".oj-tree-list ins.oj-tree-disclosure-icon","touchend.ojtree",function(e){e.preventDefault();var i=t(e.target);this.toggleExpand(i)}.bind(this)),this._$container.delegate(".oj-tree-list ins.oj-tree-disclosure-icon","click.ojtree",function(e){var i=t(e.target);this.toggleExpand(i)}.bind(this)).delegate(".oj-tree-list ins.oj-tree-disclosure-icon","mousedown",function(e){this._data.ui.disclosureClick=!0,t(e.target).removeClass("oj-default").removeClass(i._OJ_HOVER).addClass(i._OJ_SELECTED)}.bind(this)).delegate(".oj-tree-list ins.oj-tree-disclosure-icon","mouseup",function(e){t(e.target).removeClass(i._OJ_SELECTED).addClass("oj-default")}.bind(this)).bind("mousedown.ojtree",function(e){this._setFocus(),e.shiftKey&&(this._getDndContext()&&this._getDndContext().isDragEnabled()||e.preventDefault())}.bind(this)).bind("dblclick.ojtree",function(e){var t;if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){t=window.getSelection();try{t.removeAllRanges(),t.collapse(document.getElementsByTagName("body")[0],0)}catch(e){}}}),this._$container_ul.focus(function(e){return this._data.ui.disclosureClick?(this._data.ui.disclosureClick=!1,!1):(this._data.ui.focused=!0,this._data.ui.hovered?t=this._data.ui.hovered:this._data.ui.lastHovered?(this._data.ui.hovered=this._data.ui.lastHovered,t=this._data.ui.hovered):this._data.ui.lastSelected&&this._data.ui.lastSelected.length>0?(this._data.ui.hovered=this._data.ui.lastSelected,t=this._data.ui.hovered):t=this._$container_ul.find("li:first"),t&&(this.hover(t),this._data.ui.lastHovered=null,this._$container_ul.find("a.oj-selected").removeClass("oj-tree-inactive")),!1);var t}.bind(this)).blur(function(e){this._data.ui.focused=!1,this._data.ui.lastHovered=this._data.ui.hovered,this._data.ui.lastHovered&&this.dehover(this._data.ui.hovered),this._$container_ul.find("a.oj-selected").addClass("oj-tree-inactive")}.bind(this)),this._emitEvent({},"init",!0),this._loadNodes(),this._data.menu.usermenu&&this._applyMenu(),e={_handler:this._keyHandler,_selector:this._$container_ul,_this:this},f.push(e),t(e._selector).keydown(g),this._enableKeys()},_initCore:function(){this._data.core.locked=!1,this._$container.addClass("oj-tree oj-tree-"+this._getIndex()),this._$container.css("outline","none"),this._$container.css("MozUserSelect","none"),this._$container.css("WebkitTouchCallout","none"),this._$container.css("WebkitUserSelect","none"),this._$container.css("-ms-user-select","none"),this._$container.css("WebkitTapHighlightColor","rgba(0,0,0,0)")},_initUI:function(){this._data.ui.selected=t(),this._data.ui.lastSelected=!1,this._data.ui.hovered=null;var e=this.options.selection;e&&"array"===t.type(e)&&e.length>0&&(this._data.ui.toSelect=e,this.options.selection=[]),this._isTouch&&this._$container.delegate(".oj-tree-list a","touchend.ojtree",t.proxy(function(e){this._data.ui.touchEvent=!0,this._handleNodeTapClick(e),t(e.currentTarget).hasClass(l)||this.dehover()},this)),this._$container.delegate(".oj-tree-list a","click.ojtree",function(e){this._data.ui.touchEvent=!1,this._handleNodeTapClick(e)}.bind(this)).delegate(".oj-tree-list a","mouseenter.ojtree",function(e){t(e.currentTarget).hasClass(l)||this.hover(e.target)}.bind(this)).delegate(".oj-tree-list a","mouseleave.ojtree",function(e){t(e.currentTarget).hasClass(l)||this.dehover(e.target)}.bind(this)).delegate(".oj-tree-list .oj-tree-disclosure-icon","mouseenter.ojtree",function(e){t(e.currentTarget).hasClass(l)||this._disclosureHover(e.target,!0)}.bind(this)).delegate(".oj-tree-list .oj-tree-disclosure-icon","mouseleave.ojtree",function(e){t(e.currentTarget).hasClass(l)||this._disclosureHover(e.target,!1)}.bind(this)).bind("_treereopen",function(){this._reselect()}.bind(this)).bind("_treeget_rollback",function(){this.dehover(),this._saveSelected()}.bind(this)).bind("ojcollapse",function(e,i){var n=this._getNode(i.item),a=n&&n.length?n.children("ul").find("a.oj-selected"):t(),s=this;!1!==this.options.selectedParentCollapse&&a.length&&a.each(function(){"selectParent"===s.options.selectedParentCollapse?(s.deselect(this),s.select(n)):"deselect"===s.options.selectedParentCollapse&&s.deselect(this)})}.bind(this)).bind("ojremove",function(e,t){var i,n=this.options.selectPrevOnDelete,a=this._getNode(t.item),s=a&&a.length?a.find("a.oj-selected"):[],r=this;s.each(function(){r.deselect(this),r._data.ui.lastHovered&&(i=r._getNode(this))&&r._data.ui.lastHovered.attr("id")==i.attr("id")&&(r._data.ui.lastHovered=null)}),n&&s.length&&t.prev&&t.prev.each(function(){if(this.parentNode)return r.select(this),!1})}.bind(this)).bind("ojmove",function(e,t){var n,a=t.data,s=a.cy;s&&a.oc&&(a.oc.find("a.oj-selected").removeClass(i._OJ_SELECTED),a.oc.removeAttr("aria-selected")),a.ot===a.rt||s||(n=a.ot._data.ui).lastHovered&&(a.o.attr("id")==n.lastHovered.attr("id")&&(n.lastHovered=null),n.lastSelected&&a.o.attr("id")==n.lastSelected.attr("id")&&(n.lastSelected=null))}.bind(this))},_initDataSource:function(){this._initTreeData(),this._initJsonData(),this._initHtmlData()},_initTreeData:function(){1===this._data.ds.type&&(this._tds=this.options.data||null,this._load_node=this._load_node_DS,this._is_loaded=this._is_loaded_DS,this._refresh=this._refresh_DS)},_initJsonData:function(){3===this._data.ds.type&&(this._data.ds.progressiveUnload&&this._$container.bind("_treeafter_close",function(e,t){t.item.children("ul").remove()}),this._load_node=this._load_node_J,this._is_loaded=this._is_loaded_J,this._refresh=this._refresh_json)},_initHtmlData:function(){4===this._data.ds.type&&(this._processExistingMarkup(),this._load_node=this._load_node_H,this._is_loaded=this._is_loaded_H,this._refresh=this._refresh_ui)},_processExistingMarkup:function(){this._data.html.useExistingMarkup&&(this._data.html.markup_ul||(this._data.html.markup_ul=this._$container.find(" > ul"),this._data.html.markup=this._data.html.markup_ul.find(" > li"),this._data.html.cloneMarkup=this._data.html.markup.clone(!0),this._data.html.cloneMarkup.find("li").addBack().contents().filter(function(){return 3==this.nodeType}).remove(),this._transformElemIds(this._data.html.markup_ul),this._data.html.markup_div=t("<div id='oj-tree-existing-markup-"+this._getIndex()+"' style='display:none'>").append(this._data.html.markup_ul),this._$container.after(this._data.html.markup_div)))},_transformElemIds:function(e){var i=t(e).find("li"),n=this._getIndex();i.each(function(e,t){t.setAttribute("id",n+"_"+t.getAttribute("id"))})},_unTransformElemIds:function(e){var i,n,a=t(e).find("li");this._getIndex();a.each(function(e,t){i=t.getAttribute("id"),n=i.indexOf("_"),i=i.substr(n+1),t.setAttribute("id",i)})},_initThemes:function(){!1===this._data.themes._themes&&(this._data.themes._themes="themes/"),this._$container.bind("_treeinit",t.proxy(function(){var e=this.options;this._data.themes.dots=e.dots,this._data.themes.icons=e.icons,this.setTheme(this._data.themes.theme,this._data.themes.url)},this)).bind("ojloaded",t.proxy(function(){this._data.themes.dots?this._showDots():this._hideDots(),this._data.themes.icons?this._showIcons():this._hideIcons()},this))},_initTypes:function(){var e=this.options.types;e&&this._$container.bind("_treeinit",t.proxy(function(){var i=t.extend(!0,{},e.types),n=e.attr||this._data.types.defaults.attr,a="",s=this;t.each(i,function(e,i){t.each(i,function(e,t){/^(maxDepth|maxChildren|icon|validChildren)$/.test(e)||s._data.types.attachTo.push(e)});var r=typeof i.icon;if("undefined"===r){if("boolean"!==(r=typeof i.image)||i.image){if(!i.image&&!i.position)return!0}else i.image="ojt$none";i.icon={},i.image&&(i.icon.image=i.image,delete i.image),void 0!==i.position&&(i.icon.position=i.position,delete i.position)}(i.icon.image||i.icon.position)&&("default"==e?(s._data.types.defType=!0,a+=".oj-tree-"+s._getIndex()+" .oj-tree-list li.oj-tree-type a > .oj-tree-node-icon { ",a+=s._addTypeCss(i,a),a+="} ",a+=".oj-tree-"+s._getIndex()+" .oj-tree-list li["+n+'="oj-tree-deftype"].oj-tree-type > a ins.oj-tree-node-icon { '):i.icon.image&&(a+=".oj-tree-"+s._getIndex()+" .oj-tree-list li["+n+'="'+e+'"].oj-tree-type > a > ins.oj-tree-node-icon { '),a+=s._addTypeCss(i,a),a+="} ")}),""!==a&&m({str:a,title:"oj-tree-types"})},this)).bind("ojbefore",function(e,i){var n=i.func,a=i.item,s=!!this._data.types.defaults.useData&&this._getNode(a),r=!(!s||-1===s||!s.length)&&s.data("oj-tree");if(r&&r.types&&!1===r[n])return e.stopImmediatePropagation(),!1;if(-1!==t.inArray(n,this._data.types.attachTo)){if(!i.item||!i.item.tagName&&!i.item.jquery)return;if(!this._canTypedNodeMove(a,n))return e.stopImmediatePropagation(),!1}}.bind(this))},_addTypeCss:function(e){var t="";return"ojt$none"!==e.icon.image?t+=" background-image:url("+e.icon.image+"); ":t+=" background-image:none; ",e.icon.position?t+=" background-position:"+e.icon.position+"; ":t+=" background-position:0 0; ",t},_getDndContext:function(){return this._TreeDndContext||(this._TreeDndContext=new e.TreeDndContext(this)),this._TreeDndContext},_initKeys:function(){},_initMenu:function(e){var i;if(e||this.options.contextMenu||(i=this._$container.attr("contextmenu"))&&(this.options.contextMenu="#"+i),i=e||this.options.contextMenu){var n=t(i);if(n){n.css("display","none");var a=this._data.menu;a.$container=n,a.usermenu=!0}this._data.menu.usermenu&&e&&this._applyMenu()}},_handleContextMenuSelect:function(e,t){if(!t.inst&&this._data.menu.treeDivId==this._elemId){var i=t?t.item.attr("id"):void 0;"ojtreecopy"===i?this._crrm_copy(this._data.menu.node):"ojtreecut"===i?this._crrm_cut(this._data.menu.node):"ojtreepaste"===i||"ojtreepastebefore"===i||"ojtreepasteafter"===i?this._crrm_paste(this._data.menu.node,i):"ojtreeremove"===i?this._isSelected(this._data.menu.node)?this._crrm_remove():this._crrm_remove(this._data.menu.node):"ojtreerename"===i?this._crrm_rename(this._data.menu.node):"ojtreecreate"===i&&this._crrm_create(this._data.menu.node)}},_NotifyContextMenuGesture:function(e,n,a){var s,r="keyboard"===a;if("contextmenu"==n.type||r||"touch"==a)if(this._data.menu.node=r?this._data.ui.hovered||this._data.menu.activeNode:t(n.target),this._data.menu.activeNode=null,this._data.menu.node){if(!r){var o=t(n.originalEvent.target);if(o.is("LI")||o.hasClass("oj-tree")||o.is("UL"))return}r?this._data.menu.node:this._data.menu.node.closest("li"),this._data.menu.treeDivId=this._data.menu.node.closest("div").attr("id");var d={launcher:this._$container_ul};if(r&&(s=this._data.menu.node.find(".oj-tree-title")[0],d.position={of:s}),this._data.menu.usermenu&&(this._data.menu.$elemPaste||this._data.menu.$elemPasteBefore||this._data.menu.$elemPasteAfter)){var l,h,c=!this._data.crrm.ct_nodes&&!this._data.crrm.cp_nodes,_=[this._data.menu.$elemPaste,this._data.menu.$elemPasteBefore,this._data.menu.$elemPasteAfter],u=!1;for(h=0;h<_.length;h++)(l=_[h])&&!!l.hasClass(i._OJ_DISABLED)!=c&&(c?l.addClass(i._OJ_DISABLED):l.removeClass(i._OJ_DISABLED),u=!0);u&&this._data.menu.$container.ojMenu("refresh")}this._OpenContextMenu(n,a,d)}else n.preventDefault()},_initCoreOpts:function(){var e=this.options.selectionMode;"none"===(e=null==e?"single":e)?e=0:"single"===e?e=1:"multiple"===e&&(e=-1),this._data.core.selectMode=e,this._data.themes.icons=this.options.icons,this._initExpandedOpts(),this._data.core.toLoad=this.options.initLoaded},_initUIOpts:function(){},_initDSOpts:function(i){var n,a,s=this.options.data;if(this._data.ds.type=0,this._data.html.useExistingMarkup=!1,this._data.html.cloneMarkup=!1,this._loadFailureIds={},s)if("string"===(a=t.type(s)))this._isHtml(s)?this._data.ds.type=4:(this._data.ds.type=3,this._initJsonOpts());else if("array"===a)this._data.ds.type=3;else if("object"===a){try{s instanceof e.JsonTreeDataSource&&(this._data.ds.type=1)}catch(e){this._data.ds.type=-1}if(1!==this._data.ds.type)try{s instanceof e.CollectionTreeDataSource&&(this._data.ds.type=2)}catch(e){this._data.ds.type=-1}1===this._data.ds.type||2===this._data.ds.type?this._initTreeDSOpts():(s.data||s.ajax)&&((n=s.dataType)?"json"===n?(this._data.ds.type=3,this._initJsonOpts()):"html"===n&&(this._data.ds.type=4,this._initHtmlOpts()):(s.dataType="json",this._data.ds.type=3,this._initJsonOpts()))}i&&0==this._data.ds.type&&this._$container.find("ul").length>0&&(this._data.ds.type=4,this._data.html.useExistingMarkup=!0)},_initTreeDSOpts:function(){},_initJsonOpts:function(){},_initHtmlOpts:function(){},_initMenuOpts:function(){},_initTypeOpts:function(){var e=this.options.types;"object"==typeof e&&this._applyDefaults(e,{attr:this._data.types.defaults.attr})},_initExpandedOpts:function(){this._data.core.toExpand=this._varCopy(this.options,"initExpanded"),null==this._data.core.toExpand&&(this._data.core.toExpand=[])},_initData:function(){var e=this._data;e.core={initLoaded:[],selectMode:1,load_open:!1,li_height:0,toExpand:!1,toLoad:!1,prepMoveBlk:{},suppressSelectEvent:!1,strings:{}},e.ui={selected:t(),lastSelected:!1,hovered:null,lastHovered:null,disclosureClick:!1,toSelect:null,opacity:1,spacebar:!1,focused:!1,animDurDiv:null,touchEvent:!1},e.ui.defaults={selectMultipleModifier:"ctrl",selectRangeModifier:"shift",disableSelectingChildren:!1},e.crrm={},e.crrm.cp_nodes=!1,e.crrm.ct_nodes=!1,e.crrm.defaults={inputWidthLimit:200,move:{alwaysCopy:!1,openOnMove:!0,defaultPosition:"last",checkMove:function(e){return!0}}},e.crrm.prepMoveBlk={},e.ds={},e.ds.progressiveRender=!1,e.ds.progressiveUnload=!1,e.ds.correctState=!0,e.ds.type=0,e.json={},e.json.defaults={data:!1,ajax:!1},e.html={},e.html.defaults={data:!1,ajax:!1},e.html.useExistingMarkup=!1,e.html.markup_ul=!1,e.html.markup_div=!1,e.html.markup=!1,e.html.cloneMarkup=!1,e.themes={},e.themes.icons=!0,e.themes.dots=!1,e.themes.theme="default",e.themes.url=!1,e.themes.themes_loaded=[],e.themes._themes=!1,e.types={},e.types.attachTo=[],e.types.defType=!1,e.types.defaults={maxChildren:-1,maxDepth:-1,validChildren:"all",useData:!1,attr:"type",types:{default:{maxChildren:-1,maxDepth:-1,validChildren:"all"}}},e.menu={},e.menu.usermenu=!1,e.menu.$container=!1,e.menu.$elemPaste=!1,e.menu.$elemPasteAfter=!1,e.menu.$elemPasteBefore=!1,e.menu.node=!1,e.menu.activeNode=!1,e.keys={},e.keys.enabled=!0,e.keys.bound=[]},_fix_scroll:function(e){var t,i=this._$container[0];if(i.scrollHeight>i.offsetHeight){if(!(e=this._getNode(e))||-1===e||!e.length||!e.is(":visible"))return;(t=e.offset().top-this._$container.offset().top)<0&&(i.scrollTop=i.scrollTop+t-1),t+this._data.core.li_height+(i.scrollWidth>i.offsetWidth?n:0)>i.offsetHeight&&(i.scrollTop=i.scrollTop+(t-i.offsetHeight+this._data.core.li_height+1+(i.scrollWidth>i.offsetWidth?n:0)))}},_setFocus:function(){},_unsetFocus:function(){},_newIndex:function(){return++v},_getIndex:function(){return this._index},_getOptions:function(){return t.extend(!0,{},this.options)},_getContainer:function(){return this._$container},_getContainerList:function(){return this._$container_ul},_keyHandler:{up:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getPrev(e)),!1},"ctrl+up":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getPrev(e)),!1},"shift+up":function(e){var t=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.select(this._getPrev(t),-1!==this._data.ui.selectMode),!1},down:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getNext(e)),!1},"ctrl+down":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getNext(e)),!1},"shift+down":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.select(this._getNext(e),-1!==this._data.ui.selectMode),!1},left:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(i._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},"ctrl+left":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(i._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},"shift+left":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(i._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},right:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(i._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},"ctrl+right":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(i._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},"shift+right":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(i._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},space:function(){return this._data.ui.hovered&&(this._data.ui.spacebar=!0,this._data.ui.hovered.children("a:eq(0)").click(),this._data.ui.spacebar=!1),!1},home:function(){return this.hover(this._$container_ul.find("li:first")),!1},end:function(){var e=this._$container_ul.find("li.oj-tree-last:visible");return e&&e.length&&this.hover(e[e.length-1]),!1},"*":function(){this._$container_ul.find("a");return this._expandAll(-1,!1),!1},"ctrl+space":function(e){if(this._data.ui.hovered){var i=t.Event("click");i.ctrlKey=!0,this._data.ui.hovered.children("a:eq(0)").trigger(i)}return!1},"shift+space":function(e){if(this._data.ui.hovered){var i=t.Event("click");i.shiftKey=!0,this._data.ui.hovered.children("a:eq(0)").trigger(i)}return!1},"shift+home":function(e){var i,n=this._data.ui.hovered;if(n){var a=!0,s=this,r=this._$container_ul.find("li:visible");this._data.core.suppressSelectEvent=!0,i=this.options.selection.slice(0),n=n[0],t.each(r,function(e,t){return t==n&&(a=!1),s._select(t,!0),a}),this._data.core.suppressSelectEvent=!1,this._fireOptionChangeEvent("selection",i,null,e)}return!1},"shift+pgdn":function(e){var i,n=this._data.ui.lastSelected||this._data.ui.hovered;if(n){var a=!1,s=this,r=this._$container_ul.find("li:visible");this._data.core.suppressSelectEvent=!0,i=this.options.selection.slice(0),n=n[0],t.each(r,function(e,t){return a||(a=t==n),a&&!s._isSelected(t)&&s._select(t,!0),!0}),this._data.core.suppressSelectEvent=!1,this._fireOptionChangeEvent("selection",i,null,e)}return!1},f2:function(){return this._crrm_rename(this._data.ui.hovered||this._data.ui.lastSelected),!1},del:function(){return this.remove(this._data.ui.hovered||this._getNode(null)),!1}},_applyMenu:function(){if(this._data.menu.usermenu){var e=this._data.menu.$container,i=this;e.on("ojselect",this._handleContextMenuSelect.bind(this));var n=e.find("[data-oj-command]"),a=!1;n.each(function(){var e;0===t(this).children("a").length&&(e=t(this).attr("data-oj-command").split("oj-tree-"),t(this).replaceWith(i._buildContextMenuItem(e[e.length-1])),t(this).hasClass("oj-menu-divider")&&t(this).removeClass("oj-menu-divider").addClass("oj-menu-item"),a=!0)}),a&&e.ojMenu("refresh"),this._data.menu.$elemPaste=e.find("#ojtreepaste"),this._data.menu.$elemPasteAfter=e.find("#ojtreepasteafter"),this._data.menu.$elemPasteBefore=e.find("#ojtreepastebefore")}},_clearMenu:function(){var e=this._data.menu;e.usermenu&&(e.usermenu=!1,e.$container.off("ojselect"),e.$container=null)},_buildContextMenuItem:function(e){return t(this._buildContextMenuListItem(e))},_buildContextMenuListItem:function(e){return"<li id="+_[e]+">"+this._buildContextMenuLabel(e)+"</li>"},_buildContextMenuLabel:function(e){var t=u[e];return'<a href="#">'+this._getString(t)+"</a>"},_isLoadFailureId:function(e){return e="#"===(e=-1===e?"-1":e).charAt(0)?e.substr(1):e,!!this._loadFailureIds[e]},_noteLoadFailureId:function(e,t){e=-1===e?"-1":e,t?this._loadFailureIds[e]=!0:this._loadFailureIds.hasOwnProperty(e)&&delete this._loadFailureIds[e]},_crrm_cut:function(e){if(e=e.closest("li"),this._isSelected(e)&&(e=null),!(e=this._getNode(e,!0))||!e.length)return!1;this._data.crrm.cp_nodes=!1,this._data.crrm.ct_nodes=e,this._emitEvent({obj:e},"cut")},_crrm_copy:function(e){if(e=e.closest("li"),this._isSelected(e)&&(e=null),!(e=this._getNode(e,!0))||!e.length)return!1;this._data.crrm.ct_nodes=!1,this._data.crrm.cp_nodes=e,this._emitEvent({obj:e},"copy")},_crrm_paste:function(e,t){if(!(e=this._getNode(e))||!e.length)return!1;var i=this._data.crrm.ct_nodes?this._data.crrm.ct_nodes:this._data.crrm.cp_nodes;if(!this._data.crrm.ct_nodes&&!this._data.crrm.cp_nodes)return!1;var n="inside";"ojtreepasteafter"===t?n="after":"ojtreepastebefore"===t&&(n="before"),this._data.crrm.ct_nodes&&(this._crrm_move_node(this._data.crrm.ct_nodes,e,n,!1,!1,!0),this._data.crrm.ct_nodes=!1),this._data.crrm.cp_nodes&&this._crrm_move_node(this._data.crrm.cp_nodes,e,n,!0,!1,!0),this._emitEvent({obj:i,p:n,r:e},"paste")},_crrm_move_node:function(e,t,i,n,a,s){var r=this._data.crrm.defaults.move;if(!a)return void 0===i&&(i=r.defaultPosition),"inside"!==i||r.defaultPosition.match(/^(before|after)$/)||(i=r.defaultPosition),this._moveNode(e,t,i,n,!1,s);(!0===r.alwaysCopy||"multitree"===r.alwaysCopy&&e.rt._getIndex()!==e.ot._getIndex())&&(n=!0),this._moveNode(e,t,i,n,!0,s)},_crrm_remove:function(e){e=this._getNode(e,!0),this.__rollback(),e=this.remove(e)},_crrm_rename:function(e){this._emitEvent;e=this._getNode(e),this.__rollback(),this._crrm_showInput(e,function(e,t,i){})},_crrm_showInput:function(e,i){e=this._getNode(e);var n=this._isRtl,a=this._data.crrm.defaults.inputWidthLimit,s=e.children("ins").width(),r=e.find("> a:visible > ins").width()*e.find("> a:visible > ins").length,o=this.getText(e),d=t("<div />",{css:{position:"absolute",top:"-200px",left:n?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=e.css("position","relative").append(t("<input />",{value:o,class:"oj-tree-rename-input",css:{padding:"0",border:"1px solid silver",position:"absolute",left:n?"auto":s+r+4+"px",right:n?s+r+4+"px":"auto",top:"0px",height:this._data.core.li_height-2+"px",lineHeight:this._data.core.li_height-2+"px",width:"150px"},blur:t.proxy(function(){var t=e.children(".oj-tree-rename-input"),n=t.val();""===(n=this._escapeHtml(n))&&(n=o),d.remove(),t.remove(),this._set_text(e,o),n!=o&&this._renameNode(e,n),i.call(this,e,n,o),e.css("position","")},this),keyup:function(e){var t=e.keyCode||e.which;if(27==t)return this.value=o,void this.blur();13!=t?l.width(Math.min(d.text("pW"+this.value).width(),a)):this.blur()},keypress:function(e){if(13==(e.keyCode||e.which))return!1}})).children(".oj-tree-rename-input");this._set_text(e,""),d.css({fontFamily:l.css("fontFamily")||"",fontSize:l.css("fontSize")||"",fontWeight:l.css("fontWeight")||"",fontStyle:l.css("fontStyle")||"",fontStretch:l.css("fontStretch")||"",fontVariant:l.css("fontVariant")||"",letterSpacing:l.css("letterSpacing")||"",wordSpacing:l.css("wordSpacing")||""}),l.width(Math.min(d.text("pW"+l[0].value).width(),a))[0].select()},_crrm_create:function(e,n,a,s,r){var o=this;return(e=this._getNode(e))||(e=-1),this.__rollback(),this._createNode(e,n,a,function(e){var n=this._getParent(e),a=t(e).index();s&&s.call(this,e),n.length&&n.hasClass(i._OJ_COLLAPSED)&&this.expand(n,!1,!0),r?o._emitEvent({obj:e,name:this.getText(e),parent:n,position:a}):this._crrm_showInput(e,function(e,t,i){o._emitEvent({obj:e,name:t,parent:n,position:a})})})},_isHtml:function(e){var t=!1;return e&&e.length>=3&&(t="<"===(e=e.trim()).charAt(0)),t},_applyEmptyText:function(){var e=this.options.emptyText;if("string"!=typeof e&&(e=this._getString("labelNoData")),e&&e.length>0){var i=this._$container_ul,n=t("<li class='oj-tree-empty'></li>");n[0].textContent=e,i.empty().append(n)}},_processSubId:function(e){var t,i,n,a,s,r,o,d=null;if(e&&(t=e.subId),!t)return null;if(3===(n=t.split("[")).length&&(n[0]=n[0].trim(),"oj-tree-node"===n[0]&&(n[1]=n[1].trim(),s=n[1].charAt(0),(r=n[1].indexOf(s,1))>=0&&(a=n[1].substring(1,r).trim(),n[2]=n[2].trim(),s=n[2].charAt(0),(r=n[2].indexOf(s,1))>=0)))){d=n[2].substring(1,r).trim();try{i=this._getNode(a)}catch(e){i=null}if(d&&i&&-1!==i)switch(d){case"icon":this._data.themes.icons&&(o=i.find(" > a > ins:eq(0)"));break;case"link":o=i.find(" > a:eq(0)");break;case"disclosure":this._isLeaf(i)||(o=i.find(" > ins:eq(0)"));break;case"title":o=i.find(" > a > span")}}return o&&o.length?o[0]:null},_getSubIdFromNodeElem:function(e){var i,n,a=e?this._getNode(e):null,s=null;return a&&-1!=a&&a.length&&a.hasClass("oj-tree-node")&&e.tagName&&e.parentNode&&(i=e.tagName,n=e.parentNode.tagName,"SPAN"===i?s="title":"A"===i?s="link":"INS"===i&&(e=t(e),"LI"===n&&e.hasClass("oj-tree-disclosure-icon")?s="disclosure":"A"===n&&e.hasClass(d)&&(s="icon"))),s?{subId:"oj-tree-node['#"+a.attr("id")+"']['"+s+"']"}:null},_hideDots:function(){this._data.themes.dots=!1,this._$container.children("ul").addClass("oj-tree-no-dots")},_showDots:function(){this._data.themes.dots=!0,this._$container.children("ul").removeClass("oj-tree-no-dots")},_isOptExpandAll:function(){var e=this.options.initExpanded;return e&&"all"==e||t.isArray(e)&&e.length&&"all"==e[0]},_getString:function(e){var t,i=this._data.core.strings;return(t=i[e])||(t=this.getTranslatedString(e),t=this._escapeHtml(t),i[e]=t),t},_escapeHtml:function(e){var i=document.createElement("div");return t(i).text(e),i.textContent},_getNodeHeight:function(){return this._data.core.li_height},_getAnimDuration:function(){var e,i,n,a=0;return window.getComputedStyle&&((i=this._data.ui.animDurDiv)||(i=t("<div id='ojtree-comp-animduration'><span class='oj-tree-transition'>dummy</span></div>"),this._data.ui.animDurDiv=i,t("body").append(i)),n=i[0].childNodes[0],e=(e=window.getComputedStyle(n)).transitionDuration?e.transitionDuration:e["-webkit-transition-duration"]?e["-webkit-transition-duration"]:0,i.detach(),"string"==typeof e&&e.length>1&&("s"==e.charAt(e.length-1).toLowerCase()?(e=e.substring(0,e.length-1),e=parseFloat(e),isNaN(e)||(a=1e3*e)):e.length>2&&"ms"==e.substring(e.length-2).toLowerCase()&&(e.substring(0,e.length-2),e=parseFloat(e),isNaN(e)||(a=e)))),a},_varCopy:function(e,i){var n={};return n[i]=e[i],t.extend(!0,{},n)[i]},_trace:function(e,t){}})}()});