/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojeditablevalue"],function(e,t){e.__registerWidget("oj.inputBase",t.oj.editableValue,{version:"1.0.0",widgetEventPrefix:"oj",_ATTR_CHECK:[],_CLASS_NAMES:"",_WIDGET_CLASS_NAMES:"",_ELEMENT_TRIGGER_WRAPPER_CLASS_NAMES:"",_GET_INIT_OPTIONS_PROPS_FOR_WIDGET:[{attribute:"disabled",validateOption:!0},{attribute:"pattern"},{attribute:"placeholder"},{attribute:"value"},{attribute:"readonly",option:"readOnly",validateOption:!0},{attribute:"required",coerceDomValue:!0,validateOption:!0},{attribute:"title"}],_INPUT_HELPER_KEY:"",_BLUR_HANDLER_KEY:"blur",_KEYDOWN_HANDLER_KEY:"keydown",_KEYUP_HANDLER_KEY:"keyup",_INPUT_HANDLER_KEY:"input",_DROP_HANDLER_KEY:"drop",options:{autocomplete:void 0,autofocus:!1,name:"",placeholder:"",rawValue:"",readOnly:!1,required:!1,validators:void 0},_SaveAttributes:function(e){var t=this._superApply(arguments);return this._processAttrCheck(),t},_InitOptions:function(t,i){this._super(t,i),this._IsCustomElement()||e.EditableValueUtils.initializeOptionsFromDom(this._GET_INIT_OPTIONS_PROPS_FOR_WIDGET,i,this)},_ComponentCreate:function(){var e=this.element,t=this._superApply(arguments),i=(this._GetSavedAttributes(e),this.options.readOnly);return this._rtl="rtl"===this._GetReadingDirection(),"boolean"==typeof i&&this.element.prop("readonly",i),this._DoWrapElement()?(this._wrapElementInRootDomElement(),this._DoWrapElementAndTriggers()&&this._WrapElement(),this._focusable({element:this._wrapper,applyHighlight:!0})):this._focusable({element:this.element,applyHighlight:!0}),this._defaultRegExpValidator={},this._eventHandlers=null,t},_AfterCreate:function(){var i,n=this._superApply(arguments),r=this;return this._refreshRequired(this.options.required),this._CLASS_NAMES&&this.element.addClass(this._CLASS_NAMES),this._attachDetachEventHandlers(),this._AppendInputHelper(),t.each(["disabled","readOnly"],function(e,t){r.options[t]&&r._processDisabledReadOnly(t,r.options[t])}),this._IsCustomElement()&&(i=this.widget().attr("id"))&&e.EditableValueUtils.setSubIdForCustomLabelFor(this._GetContentElement()[0],i),n},_IsRequired:function(){return this.options.required},_AfterSetOptionRequired:e.EditableValueUtils._AfterSetOptionRequired,_AfterSetOptionValidators:e.EditableValueUtils._AfterSetOptionValidators,_AfterSetOptionConverter:e.EditableValueUtils._AfterSetOptionConverter,_ResetConverter:e.EditableValueUtils._ResetConverter,_GetConverter:e.EditableValueUtils._GetConverter,_GetNormalizedValidatorsFromOption:e.EditableValueUtils._GetNormalizedValidatorsFromOption,_processDisabledReadOnly:function(e,t){"disabled"===e&&this.element.prop("disabled",t),"readOnly"===e&&(this.element.prop("readonly",t),this._refreshStateTheming("readOnly",t)),"disabled"!==e&&"readOnly"!==e||this._attachDetachEventHandlers()},_setOption:function(t,i,n){var r=this._superApply(arguments);return"disabled"!==t&&"readOnly"!==t||this._processDisabledReadOnly(t,i),"pattern"===t&&(this._defaultRegExpValidator[e.ValidatorFactory.VALIDATOR_TYPE_REGEXP]=this._getImplicitRegExpValidator(),this._AfterSetOptionValidators()),r},_AfterSetOption:function(t,i,n){switch(this._superApply(arguments),t){case"readOnly":this._AfterSetOptionDisabledReadOnly(t,e.EditableValueUtils.readOnlyOptionOptions);break;case"required":this._AfterSetOptionRequired(t);break;case"validators":this._AfterSetOptionValidators(t);break;case"converter":this._AfterSetOptionConverter(t)}},_destroy:function(){var t=this._superApply(arguments);return this.element.off("blur drop keydown keyup input"),this._inputHelper&&this._inputHelper.remove(),this._DoWrapElement()&&!this._IsCustomElement()&&(this._DoWrapElementAndTriggers()?e.DomUtils.unwrap(this.element,this._wrapper):e.DomUtils.unwrap(this.element)),t},_attachDetachEventHandlers:function(){if(this.options.readOnly||this.options.disabled){if(this._eventHandlers)for(var e=[this._BLUR_HANDLER_KEY,this._KEYDOWN_HANDLER_KEY,this._KEYUP_HANDLER_KEY,this._INPUT_HANDLER_KEY,this._DROP_HANDLER_KEY],i=0,n=e.length;i<n;i++)this._eventHandlers[e[i]]&&(this.element.off(e[i],this._eventHandlers[e[i]]),delete this._eventHandlers[e[i]])}else{this._eventHandlers={};var r=t.proxy(this._onBlurHandler,this),s=t.proxy(this._onKeyDownHandler,this),a=t.proxy(this._onKeyUpHandler,this),o=t.proxy(this._onInputHandler,this),l=function(){this.focus()};this.element.on(this._BLUR_HANDLER_KEY,r),this.element.on(this._KEYDOWN_HANDLER_KEY,s),this.element.on(this._KEYUP_HANDLER_KEY,a),this.element.on(this._INPUT_HANDLER_KEY,o),this.element.on(this._DROP_HANDLER_KEY,l),this._eventHandlers[this._BLUR_HANDLER_KEY]=r,this._eventHandlers[this._KEYDOWN_HANDLER_KEY]=s,this._eventHandlers[this._KEYUP_HANDLER_KEY]=a,this._eventHandlers[this._INPUT_HANDLER_KEY]=o,this._eventHandlers[this._DROP_HANDLER_KEY]=l}},_OPTION_TO_CSS_MAPPING:{readOnly:"oj-read-only"},_processAttrCheck:function(){for(var e=this._ATTR_CHECK,t=0,i=e.length;t<i;t++){var n=e[t].attr;"setMandatory"in e[t]&&this.element.attr(n,e[t].setMandatory)}},_onBlurHandler:function(e){this._SetValue(this._GetDisplayValue(),e)},_onKeyDownHandler:function(e){},_onKeyUpHandler:function(e){e.keyCode===t.ui.keyCode.ENTER&&this._SetValue(this._GetDisplayValue(),e)},_onInputHandler:function(e){this._SetRawValue(this._GetContentElement().val(),e)},_DoWrapElement:function(){return this._WIDGET_CLASS_NAMES},_DoWrapElementAndTriggers:function(){return this._ELEMENT_TRIGGER_WRAPPER_CLASS_NAMES},_wrapElementInRootDomElement:function(){this.OuterWrapper?(this._wrapper=t(this.OuterWrapper).addClass(this._WIDGET_CLASS_NAMES),this._wrapper.append(this.element)):(t(this.element).wrap(t("<div>").addClass(this._WIDGET_CLASS_NAMES)),this._wrapper=this.element.parent())},_WrapElement:function(){return t(this.element).wrap(t("<div>").addClass(this._ELEMENT_TRIGGER_WRAPPER_CLASS_NAMES)).parent()},_AppendInputHelper:function(){if(this._INPUT_HELPER_KEY&&this._DoWrapElement()){var e=this.element.attr("aria-describedby")||"",i=this._GetSubId(this._INPUT_HELPER_KEY);e+=" "+i,this.element.attr("aria-describedby",e),this._inputHelper=t("<div class='oj-helper-hidden-accessible' aria-hidden='true' id='"+i+"'>"+this._EscapeXSS(this.getTranslatedString(this._INPUT_HELPER_KEY))+"</div>"),this._AppendInputHelperParent().append(this._inputHelper)}},_EscapeXSS:function(e){return t("<span>"+e+"</span>").text()},_AppendInputHelperParent:function(){return this.widget()},_GetImplicitValidators:function(){var i=this._superApply(arguments);return this.options.pattern&&(this._defaultRegExpValidator[e.ValidatorFactory.VALIDATOR_TYPE_REGEXP]=this._getImplicitRegExpValidator()),t.extend(this._defaultRegExpValidator,i)},_CanSetValue:function(){return!!this._super()&&!(this.options.readOnly||!1)},_refreshStateTheming:function(e,t){-1!=Object.keys(this._OPTION_TO_CSS_MAPPING).indexOf(e)&&this.widget().toggleClass(this._OPTION_TO_CSS_MAPPING[e],!!t)},_getImplicitRegExpValidator:function(){if(!this.options.pattern)return null;var i={pattern:this.options.pattern,label:this._getLabelText()};return t.extend(i,this.options.translations.regexp||{}),e.Validation.validatorFactory(e.ValidatorFactory.VALIDATOR_TYPE_REGEXP).createValidator(i)},_GetSubId:function(e){return this.uuid+"_"+e},_IsRTL:function(){return this._rtl},refresh:function(){var e=this._superApply(arguments);return this._rtl="rtl"===this._GetReadingDirection(),this._refreshRequired(this.options.required),e},_refreshRequired:e.EditableValueUtils._refreshRequired,_ValidateReturnBoolean:e.EditableValueUtils._ValidateReturnBoolean,getNodeBySubId:function(e){return this._super(e)},validate:e.EditableValueUtils.validate,_AriaRequiredUnsupported:function(){return!1},widget:function(){return this._DoWrapElement()?this._wrapper:this.element}},!0),e.__registerWidget("oj.ojInputPassword",t.oj.inputBase,{version:"1.0.0",defaultElement:"<input>",widgetEventPrefix:"oj",_ATTR_CHECK:[{attr:"type",setMandatory:"password"}],_CLASS_NAMES:"oj-inputpassword-input",_WIDGET_CLASS_NAMES:"oj-inputpassword oj-form-control oj-component",options:{converter:void 0,pattern:""},getNodeBySubId:function(e){var t=this._superApply(arguments);return t||"oj-inputpassword-input"===e.subId&&(t=this.element?this.element[0]:null),t||null},_GetDefaultStyleClass:function(){return"oj-inputpassword"}}),e.__registerWidget("oj.ojInputText",t.oj.inputBase,{version:"1.0.0",defaultElement:"<input>",widgetEventPrefix:"oj",_ATTR_CHECK:[{attr:"type",setMandatory:"text"}],_CLASS_NAMES:"oj-inputtext-input",_WIDGET_CLASS_NAMES:"oj-inputtext oj-form-control oj-component",_ALLOWED_TYPES:["email","number","search","tel","text","url"],_CLICK_HANDLER_KEY:"click",options:{clearIcon:"never",converter:void 0,list:"",pattern:"",spellcheck:!1,virtualKeyboard:"auto"},_ComponentCreate:function(){var e=this._super(),t=this.options.clearIcon;return this._processClearIconAttr(t),this._AddHoverable(this._wrapper),this._SetInputType(this._ALLOWED_TYPES),e},_processClearIconAttr:function(e){var t=this._wrapper[0],i=t.querySelector("a.oj-inputtext-clear-icon-btn");if("never"===e||this.options.disabled||this.options.readOnly)i&&t.removeChild(i),t.classList.remove("oj-inputtext-clearicon-visible"),t.classList.remove("oj-inputtext-clearicon-conditional");else{var n;if(null===i)(i=document.createElement("a")).className="oj-inputtext-clear-icon-btn oj-component-icon oj-clickable-icon-nocontext",i.setAttribute("tabindex","-1"),i.setAttribute("target","_blank"),(n=document.createElement("span")).className="oj-inputtext-clear-icon",i.appendChild(n),t.appendChild(i),i.addEventListener(this._CLICK_HANDLER_KEY,this._onClearIconClickHandler.bind(this));if("always"===e)t.classList.add("oj-inputtext-clearicon-visible");else if(t.classList.remove("oj-inputtext-clearicon-visible"),"conditional"===e)t.classList.add("oj-inputtext-clearicon-conditional"),""!==(t.classList.contains("oj-complete")?this.element[0].value:this.options.value)?t.classList.remove("oj-form-control-empty-clearicon"):t.classList.add("oj-form-control-empty-clearicon");else t.classList.remove("oj-inputtext-clearicon-conditional"),t.classList.remove("oj-form-control-empty-clearicon")}},_AfterSetOption:function(e,t){switch(this._super(e,t),e){case"clearIcon":case"value":case"disabled":case"readOnly":this._processClearIconAttr(this.options.clearIcon);break;case"virtualKeyboard":this._SetInputType(this._ALLOWED_TYPES)}},_onInputHandler:function(e){this._super(e);var t=e.target,i=this._wrapper[0];"conditional"===this.options.clearIcon&&(""!==t.value?i.classList.remove("oj-form-control-empty-clearicon"):i.classList.add("oj-form-control-empty-clearicon"))},_onClearIconClickHandler:function(e){var t=this.element[0];t.value="",this._SetRawValue(t.value,e),t.focus(),this._wrapper[0].classList.add("oj-form-control-empty-clearicon")},_onBlurHandler:function(t){var i=this._wrapper[0],n=t.relatedTarget;n&&n.classList.contains("oj-inputtext-clear-icon-btn")&&n.parentElement&&e.DomUtils.isAncestorOrSelf(i,n.parentElement)?i.classList.add("oj-focus"):this._super(t)},getNodeBySubId:function(e){var t=this._superApply(arguments);return t||"oj-inputtext-input"===e.subId&&(t=this.element?this.element[0]:null),t||null},_GetDefaultStyleClass:function(){return"oj-inputtext"},_GetTranslationsSectionName:function(){return"oj-inputBase"},_SetInputType:e.EditableValueUtils._SetInputType}),e.__registerWidget("oj.ojTextArea",t.oj.inputBase,{version:"1.0.0",defaultElement:"<textarea>",widgetEventPrefix:"oj",_ATTR_CHECK:[],_CLASS_NAMES:"oj-textarea-input",_WIDGET_CLASS_NAMES:"oj-textarea oj-form-control oj-component",options:{converter:void 0,pattern:"",rows:void 0,spellcheck:!1},getNodeBySubId:function(e){var t=this._superApply(arguments);return t||"oj-textarea-input"===e.subId&&(t=this.element?this.element[0]:null),t||null},_GetDefaultStyleClass:function(){return"oj-textarea"},_GetTranslationsSectionName:function(){return"oj-inputBase"}}),e.CustomElementBridge.registerMetadata("inputBase","editableValue",{properties:{autocomplete:{type:"string",enumValues:["off","on"],extension:{_COPY_TO_INNER_ELEM:!0}},autofocus:{type:"boolean",extension:{_COPY_TO_INNER_ELEM:!0}},name:{type:"string",extension:{_COPY_TO_INNER_ELEM:!0}},placeholder:{type:"string"},rawValue:{type:"string",readOnly:!0,writeback:!0},readonly:{type:"boolean"},required:{type:"boolean"},translations:{type:"Object",properties:{regexp:{type:"Object",properties:{messageDetail:{type:"string"},messageSummary:{type:"string"}}},required:{type:"Object",properties:{hint:{type:"string"},messageDetail:{type:"string"},messageSummary:{type:"string"}}}}},validators:{type:"Array"}},methods:{validate:{}},extension:{_INNER_ELEM:"input",_WIDGET_NAME:"inputBase",_GLOBAL_TRANSFER_ATTRS:["accesskey","aria-label","tabindex"],_ALIASED_PROPS:{readonly:"readOnly"}}}),e.CustomElementBridge.registerMetadata("oj-input-password","inputBase",{properties:{value:{type:"string",writeback:!0}},methods:{},extension:{_WIDGET_NAME:"ojInputPassword"}}),e.CustomElementBridge.register("oj-input-password",{metadata:e.CustomElementBridge.getMetadata("oj-input-password")}),e.CustomElementBridge.registerMetadata("oj-input-text","inputBase",{properties:{clearIcon:{type:"string",enumValues:["always","conditional","never"]},converter:{type:"Object"},list:{type:"string",extension:{_COPY_TO_INNER_ELEM:!0}},spellcheck:{type:"boolean",extension:{_ATTRIBUTE_ONLY:!0,_COPY_TO_INNER_ELEM:!0}},value:{type:"any",writeback:!0},virtualKeyboard:{type:"string",enumValues:["auto","email","number","search","tel","text","url"]}},methods:{},extension:{_WIDGET_NAME:"ojInputText"}}),e.CustomElementBridge.register("oj-input-text",{metadata:e.CustomElementBridge.getMetadata("oj-input-text")}),e.CustomElementBridge.registerMetadata("oj-text-area","inputBase",{properties:{converter:{type:"Object"},rows:{type:"number",extension:{_COPY_TO_INNER_ELEM:!0}},spellcheck:{type:"boolean",extension:{_ATTRIBUTE_ONLY:!0,_COPY_TO_INNER_ELEM:!0}},value:{type:"any",writeback:!0}},methods:{},extension:{_INNER_ELEM:"textarea",_WIDGET_NAME:"ojTextArea"}}),e.CustomElementBridge.register("oj-text-area",{metadata:e.CustomElementBridge.getMetadata("oj-text-area")})});