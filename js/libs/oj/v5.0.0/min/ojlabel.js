/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","hammerjs","ojs/ojjquery-hammer","ojs/ojcomponentcore","ojs/ojpopup"],function(e,t,i){e.__registerWidget("oj.ojLabel",t.oj.baseComponent,{version:"1.0.0",defaultElement:"<label>",widgetEventPrefix:"oj",options:{for:null,help:{definition:null,source:null},labelId:null,showRequired:!1,rootAttributes:null},_BUNDLE_KEY:{_TOOLTIP_HELP:"tooltipHelp",_TOOLTIP_REQUIRED:"tooltipRequired"},widget:function(){return this.uiLabel},refresh:function(){this._super(),this._refreshRequired(),this._refreshHelp(),this._addIdsToDom()},_InitOptions:function(e,t){this._super(e,t),this._isCustomElement=this._IsCustomElement(),this._checkRequiredOption()},_ComponentCreate:function(){this._super(),this._touchEatClickNamespace=this.eventNamespace+"TouchEatClick",this._touchEatContextMenuNamespace=this.eventNamespace+"TouchEatContextMenu",this._helpDefPopupNamespace=this.eventNamespace+"HelpDefPopup",this._bTouchSupported=e.DomUtils.isTouchSupported(),this._drawOnCreate()},_SaveAttributes:function(e){this._IsCustomElement()||(this._savedClasses=e.attr("class"))},_RestoreAttributes:function(){this._IsCustomElement()||(this._savedClasses?this.element.attr("class",this._savedClasses):this.element.removeAttr("class"))},_NotifyDetached:function(){this._superApply(arguments),this._handleCloseHelpDefPopup()},_NotifyHidden:function(){this._superApply(arguments),this._handleCloseHelpDefPopup()},_GetTranslationsSectionName:function(){return this._IsCustomElement(),"oj-ojLabel"},_drawOnCreate:function(){var e,i=null;this.OuterWrapper?(this.uiLabel=t(this.OuterWrapper).append(this.element.wrap(this._createOjLabelGroupDom()).parent()),this.uiLabel.addClass("oj-label oj-component")):this.uiLabel=this.element.wrap(this._createRootDomElement()).closest(".oj-component"),this._addIdsToDom(),e=this.element[0].id,this.helpSpanId=e+"_helpIcon",this.requiredSpanId=e+"_requiredIcon",this._isCustomElement||this._moveLabelStyleClassesToRootDom(),this.options.showRequired&&(this._createRequiredIconSpanDom(),this._isCustomElement&&this._addRequiredDescribedByOnCustomFormElement()),this._isCustomElement&&this._refreshFor(),this._needsHelpIcon()&&(i=this._createIconSpan(this.helpSpanId,!0),this._createHelp(i),this._isCustomElement&&this._addHelpSpanIdOnTarget(this.helpSpanId))},_getCustomLabelFormElement:function(){var e,t=null;return this._isCustomElement?(null==(t=this._getForTargetElement())&&(this.OuterWrapper&&(e=this.OuterWrapper.id),null==(t=this._getTargetElementFromLabelledAttr("labelled-by",e))&&(t=this._getTargetElementFromLabelledAttr("aria-labelledby",this.options.labelId))),t):null},_addRequiredDescribedByOnCustomFormElement:function(){var e,t;this.OuterWrapper&&(e=this.OuterWrapper.id),(t=this._getTargetElementFromLabelledAttr("labelled-by",e))&&this._isElementCustomElementAriaRequiredUnsupported(t)&&this._addElementAttribute(t,this.requiredSpanId,"described-by")},_removeRequiredDescribedByOnCustomFormElement:function(){var e,t;this.OuterWrapper&&(e=this.OuterWrapper.id),(t=this._getTargetElementFromLabelledAttr("labelled-by",e))&&this._isElementCustomElementAriaRequiredUnsupported(t)&&this._removeElementAttribute(t,this.requiredSpanId,"described-by")},_addHelpSpanIdOnTarget:function(e){var t,i=this._getCustomLabelFormElement();i&&(t=this._getAriaAttributeForTarget(i),this._addElementAttribute(i,e,t))},_removeHelpSpanIdOnTarget:function(e){var t,i=this._getCustomLabelFormElement();i&&(t=this._getAriaAttributeForTarget(i),this._removeElementAttribute(i,e,t))},_getAriaAttributeForTarget:function(e){return this._isElementCustomElement(e)?"described-by":"group"===e.getAttribute("role")?"aria-labelledby":"aria-describedby"},_getForTargetElement:function(){return document.getElementById(this.options.for)},_getTargetElementFromLabelledAttr:function(e,t){var i;return t?(i="["+e+"~='"+t+"']",document.querySelector(i)):null},_isElementCustomElement:function(t){return e.Assert.assertDomElement(t),-1!==t.tagName.indexOf("-")},_isElementCustomElementAriaRequiredUnsupported:function(t){var i;e.Assert.assertDomElement(t);var o,n=["oj-radioset","oj-checkboxset"],s=n.length,r=!1;if(t){o=t.tagName.toLowerCase();for(var l=0;l<s&&!r;l++)i=n[l],0===o.indexOf(i)&&(r=!0)}return r},_addElementAttribute:function(e,i,o){var n,s,r=e.getAttribute(o);s=r?r.split(/\s+/):[],-1===t.inArray(i,s)&&s.push(i),n=t.trim(s.join(" ")),e.setAttribute(o,n)},_removeElementAttribute:function(e,i,o){var n,s,r,l=e.getAttribute(o);r=l?l.split(/\s+/):[],-1!==(s=t.inArray(i,r))&&r.splice(s,1),(n=t.trim(r.join(" ")))?e.setAttribute(o,n):e.setAttribute(o,"")},_addForOnLabel:function(e){var t=this.element[0],i=this.options.for;this._isElementCustomElement(e)?t.setAttribute("for",i+"|input"):t.setAttribute("for",i)},_createHelp:function(e){var i=this.options.help.definition,o=this.options.help.source,n=this._createHelpIconAnchorDomElement(i,o);t(e).prepend(n),this._attachHelpDefToIconAnchor(),this._focusable({element:n,applyHighlight:!0})},_createRequiredIconSpanDom:function(){this._createIconSpan(this.requiredSpanId,!1).appendChild(this._createRequiredIconDomElement())},_checkRequiredOption:function(){var e=this.options.showRequired;if(null!==e&&"boolean"!=typeof e)throw new Error("Option 'showRequired' has invalid value set: "+e)},_addIdsToDom:function(){this._isCustomElement&&this._refreshLabelId(),null==this.element.attr("id")&&this.element.uniqueId()},_moveLabelStyleClassesToRootDom:function(){var e,t,i,o=this.element.attr("class");if(o){i=(e=o.split(/\s+/)).length;for(var n=0;n<i;n++)(t=e[n]).indexOf("-label")>0&&(this.uiLabel.addClass(t),this.element.removeClass(t))}},_createIconSpan:function(e,t){var i=document.createElement("span");return i.setAttribute("id",e),t?this.uiLabel.find(".oj-label-group").prepend(i):this.element.before(i),i},_createRootDomElement:function(){var e,t,i=this.options.rootAttributes,o="oj-label oj-component";return i&&(e=i.class),e&&(o=o+" "+e),(t=document.createElement("div")).className=o,t.appendChild(this._createOjLabelGroupDom()),t},_createOjLabelGroupDom:function(){var e;return(e=document.createElement("div")).className="oj-label-group",e},_createRequiredIconDomElement:function(){var e=this.getTranslatedString(this._BUNDLE_KEY._TOOLTIP_REQUIRED),t=document.createElement("span");return t.className="oj-label-required-icon oj-component-icon",t.setAttribute("role","img"),t.setAttribute("title",e),t.setAttribute("aria-label",e),t},_createHelpIconAnchorDomElement:function(t,i){var o;if((o=document.createElement("a")).setAttribute("tabindex","0"),o.setAttribute("target","_blank"),o.className="oj-label-help-icon-anchor oj-label-help-icon oj-component-icon oj-clickable-icon-nocontext",i)try{e.DomUtils.validateURL(i),o.setAttribute("href",i)}catch(e){throw new Error(e+". The source option ("+i+") is invalid.")}else o.setAttribute("role","img");return t?o.setAttribute("aria-label",t):o.setAttribute("aria-label",this.getTranslatedString(this._BUNDLE_KEY._TOOLTIP_HELP)),o},_attachHelpDefToIconAnchor:function(){var e,t,i,o=this;0!==(t=this.widget().find(".oj-label-help-icon-anchor")).length&&(e=this._createHelpDefPopupDiv(),this._bTouchSupported&&(this._eatClickOnHelpIconListener&&this.widget().off(this._touchEatClickNamespace),this._eatClickOnHelpIconListener=function(e){return!1},this._eatContextMenuOnHelpIconListener=function(e){return!1},t.on("contextmenu"+this._touchEatContextMenuNamespace,this._eatContextMenuOnHelpIconListener)),this._openPopupForHelpDefCallbackListener||(this._openPopupForHelpDefCallbackListener=function(i){o._handleOpenHelpDefPopup(i,e,t)}),this._closePopupForHelpDefCallbackListener||(this._closePopupForHelpDefCallbackListener=function(e){o._handleCloseHelpDefPopup()}),this._addShowHelpDefinitionEventHandlers(t),i={my:"start bottom",at:"end top",collision:"flipcenter",of:t},e.ojPopup({position:i,modality:"modeless",animation:{open:null,close:null}}))},_createHelpDefPopupDiv:function(){var e,i,o,n,s=this.options.help.definition;return n=s||this.getTranslatedString(this._BUNDLE_KEY._TOOLTIP_HELP),this._helpDefPopupDivId?(o=t(document.getElementById(this._helpDefPopupDivId)))&&o.find(".oj-help-popup-container").first().text(n):((i=document.createElement("div")).className="oj-help-popup",i.style.display="none",(o=t(i)).uniqueId(),this._helpDefPopupDivId=o.prop("id"),(e=document.createElement("div")).className="oj-help-popup-container",i.appendChild(e),t(e).text(n),document.getElementsByTagName("body")[0].appendChild(i)),o},_addShowHelpDefinitionEventHandlers:function(t){var o;t.on("focusin"+this._helpDefPopupNamespace+" mouseenter"+this._helpDefPopupNamespace,this._openPopupForHelpDefCallbackListener),t.on("mouseleave"+this._helpDefPopupNamespace,this._closePopupForHelpDefCallbackListener),this._bTouchSupported&&(this.options.help.source?(o={recognizers:[[i.Press,{time:e.DomUtils.PRESS_HOLD_THRESHOLD}]]},t.ojHammer(o),this._on(t,{press:this._openPopupForHelpDefCallbackListener})):(o={recognizers:[[i.Tap],[i.Press,{time:e.DomUtils.PRESS_HOLD_THRESHOLD}]]},t.ojHammer(o),this._on(t,{press:this._openPopupForHelpDefCallbackListener,tap:this._openPopupForHelpDefCallbackListener})))},_handleOpenHelpDefPopup:function(t,i,o){if(!i.ojPopup("isOpen"))if(this._bTouchSupported){if("press"===t.type){var n=this.widget();n.on("click"+this._touchEatClickNamespace,this._eatClickOnHelpIconListener);var s=this;i.on("ojclose",function(e,t){n.off(s._touchEatClickNamespace)})}else i.off("ojclose");"press"!==t.type&&"tap"!==t.type&&(e.DomUtils.recentTouchStart()||"focusin"!==t.type&&"mouseenter"!==t.type)||i.ojPopup("open",o)}else i.ojPopup("open",o)},_handleCloseHelpDefPopup:function(){null!=this._helpDefPopupDivId&&t(document.getElementById(this._helpDefPopupDivId)).ojPopup("close")},_removeHelpDefIconEventListeners:function(e){this._bTouchSupported&&(this.widget().off(this._touchEatClickNamespace),e.off(this._touchEatContextMenuNamespace),this._eatClickOnHelpIconListener=null,this._eatContextMenuOnHelpIconListener=null,e.ojHammer("destroy")),e.off(this._helpDefPopupNamespace),this._openPopupForHelpDefCallbackListener=null,this._closePopupForHelpDefCallbackListener=null},_removeHelpDefPopup:function(){var e;null!=this._helpDefPopupDivId&&((e=t(document.getElementById(this._helpDefPopupDivId)))&&(e.ojPopup("destroy"),e.remove()),this._helpDefPopupDivId=null)},_needsHelpIcon:function(){var e,t,i=this.options,o=i.help.source;return(t=""!==o&&null!=o)||(t=""!==(e=i.help.definition)&&null!=e),t},_refreshHelp:function(){var e,t,i=this.helpSpanId;1===(t=this.uiLabel.find(".oj-label-help-icon")).length&&(this._removeHelpDefIconEventListeners(t),this._removeHelpDefPopup(),t.remove()),e=document.getElementById(i),this._needsHelpIcon()?(null==e&&(e=this._createIconSpan(i,!0)),this._createHelp(e),this._isCustomElement&&this._addHelpSpanIdOnTarget(i)):null!==e&&(e.parentNode.removeChild(e),this._isCustomElement&&this._removeHelpSpanIdOnTarget(i))},_refreshRequired:function(){var e,t,i=this.requiredSpanId;e=document.getElementById(i),this.options.showRequired?e?(t=this.getTranslatedString(this._BUNDLE_KEY._TOOLTIP_REQUIRED),this.uiLabel.find(".oj-label-required-icon").attr("title",t)):(this._createRequiredIconSpanDom(),this._isCustomElement&&this._addRequiredDescribedByOnCustomFormElement()):(null!==(e=document.getElementById(i))&&e.parentNode.removeChild(e),this._isCustomElement&&this._removeRequiredDescribedByOnCustomFormElement())},_refreshFor:function(){var e;this._isCustomElement&&(e=this._getForTargetElement())&&this._addForOnLabel(e)},_refreshLabelId:function(){var e,t;this._isCustomElement&&((e=this.options.labelId)?this.element.attr("id",e):(t=this.uiLabel.attr("id"))&&this.element.attr("id",t+"|label"))},_setOption:function(e,t){switch(this._superApply(arguments),e){case"showRequired":this._refreshRequired();break;case"help":this._refreshHelp();break;case"for":this._isCustomElement&&this._refreshFor();break;case"labelId":this._isCustomElement&&this._refreshLabelId()}},getNodeBySubId:function(e){var t;return(t=this._super(e))||"oj-label-help-icon"===e.subId&&(t=this.widget().find(".oj-label-help-icon")[0]),t||null},getSubIdByNode:function(e){var t=null;return null!=e&&e===this.widget().find(".oj-label-help-icon")[0]&&(t={subId:"oj-label-help-icon"}),t||this._superApply(arguments)},_destroy:function(){var t=this.uiLabel.find(".oj-label-help-icon");return this._removeHelpDefIconEventListeners(t),this._removeHelpDefPopup(),this.helpSpanId=null,this.requiredSpanId=null,this._isCustomElement=null,e.DomUtils.unwrap(this.element,this.uiLabel),this._super()}}),e.CustomElementBridge.registerMetadata("oj-label","baseComponent",{properties:{help:{type:"Object",properties:{definition:{type:"string"},source:{type:"string"}}},showRequired:{type:"boolean"},labelId:{type:"string"},for:{type:"string"},translations:{type:"Object",properties:{tooltipHelp:{type:"string",value:"Help"},tooltipRequired:{type:"string",value:"Required"}}}},extension:{_INNER_ELEM:"label",_WIDGET_NAME:"ojLabel",_GLOBAL_TRANSFER_ATTRS:["accesskey"]}}),e.CustomElementBridge.register("oj-label",{metadata:e.CustomElementBridge.getMetadata("oj-label")})});