/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojcomponentcore"],function(e,t){e.__registerWidget("oj.ojProgressbar",t.oj.baseComponent,{version:"1.0.0",defaultElement:"<div>",widgetEventPrefix:"oj",options:{max:100,value:0,type:"bar",disabled:!1},min:0,_indeterminate:!1,_ComponentCreate:function(){this._super(),this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progress","aria-valuemin":this.min}),this.element.addClass("oj-component"),this._setUpProgressType()},_setUpProgressType:function(){"circle"===this.options.type?(this.element.addClass("oj-progress-circle"),this._setupCircleSVG()):(this.element.addClass("oj-progress-bar"),this.valueDiv=t("<div class='oj-progress-bar-value'></div>").appendTo(this.element)),this._refreshValue()},_InitOptions:function(e,t){var i=this.element;if(this._super(e,t),void 0===t.max){var s=i.attr("max")||void 0;null!=s&&(this.options.max=s)}},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this._indeterminate=-1==e,"number"!=typeof e&&(e=isNaN(e)?0:Number(e)),this._indeterminate?-1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e,t){var i=e.value;delete e.value,this._super(e,t),this.options.disabled||(this.options.value=this._constrainedValue(i),this._refreshValue())},_setupCircleSVG:function(){if(this.svg&&this.svg.remove(),!this._indeterminate){var e="http://www.w3.org/2000/svg",i=document.createElementNS(e,"svg"),s=document.createElementNS(e,"circle"),r=document.createElementNS(e,"circle"),a=.5*Math.min(this.element.outerWidth(),this.element.outerHeight());i.setAttribute("width",2*a),i.setAttribute("height",2*a),i.setAttribute("class","oj-progress-circle-transform"),s.setAttribute("r",.9*a),s.setAttribute("cx",a),s.setAttribute("cy",a),s.setAttribute("class","oj-progress-circle-base"),r.setAttribute("r",.9*a),r.setAttribute("cx",a),r.setAttribute("cy",a),r.setAttribute("class","oj-progress-circle-base oj-progress-circle-value");var o=2*a*.9*Math.PI,n=o-this._percentage()/100*o;r.setAttribute("style","stroke-dasharray:"+o.toString()+";stroke-dashoffset:"+n),i.appendChild(s),i.appendChild(r),this.svg=t(i),this.element[0].appendChild(i)}},_setOption:function(e,t,i){"max"===e&&(t=Math.max(this.min,t)),"type"===e&&("circle"===this.options.type?(this.element.removeClass("oj-progress-circle"),this.svg&&this.svg.remove()):(this.element.removeClass("oj-progress-bar"),this.valueDiv.remove()),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this._super(e,t,i),"type"===e&&this._setUpProgressType()},_percentage:function(){return Math.min(this._indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min),100)},_refreshValue:function(){var e=this.options.value,i=this._percentage(),s="circle"===this.options.type;if(s?this._setupCircleSVG():s||(this.valueDiv.toggle(this._indeterminate||e>this.min).width(i.toFixed(0)+"%"),this.element.toggleClass("oj-progress-bar-indeterminate",this._indeterminate)),this._indeterminate){if(this.element.attr({"aria-valuetext":this.getTranslatedString("ariaIndeterminateProgressText")}),this.element.removeAttr("aria-valuenow"),this.element.removeAttr("aria-valuemin"),this.element.removeAttr("aria-valuemax"),!this.overlayDiv){if(s){this.overlayDiv=t("<div class='oj-progress-circle-overlay'></div>").appendTo(this.element);var r=Math.min(this.element.outerWidth(),this.element.outerHeight());this.overlayDiv.css("width",r),this.overlayDiv.css("height",r)}else this.overlayDiv=t("<div class='oj-progress-bar-overlay'></div>").appendTo(this.valueDiv);this.overlayDiv.addClass("oj-indeterminate")}}else this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)},_destroy:function(){"circle"===this.options.type?(this.element.removeClass("oj-progress-circle oj-component"),this.svg&&this.svg.remove()):(this.element.removeClass("oj-progress-bar oj-component"),this.valueDiv.remove(),this._indeterminate&&this.element.removeClass("oj-progress-bar-indeterminate")),this.element.removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.overlayDiv&&this.overlayDiv.remove(),this._super()}}),e.CustomElementBridge.registerMetadata("oj-progress","baseComponent",{properties:{max:{type:"number"},type:{type:"string",enumValues:["bar","circle"]},radius:{type:"number"},translations:{type:"Object",properties:{ariaIndeterminateProgressText:{type:"string",value:"In Progress"}}},value:{type:"number",writeback:!0}},methods:{},extension:{_WIDGET_NAME:"ojProgressbar"}}),e.CustomElementBridge.register("oj-progress",{metadata:e.CustomElementBridge.getMetadata("oj-progress")})});