/**
 * @license
 * Copyright (c) 2014, 2018, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(t,r){t.ArrayCellSet=function(t,r,e,a,o){this.m_startRow=t,this.m_endRow=r,this.m_startColumn=e,this.m_endColumn=a,this.m_callback=o},t.ArrayCellSet.prototype.getData=function(t){var r,e,a,o;return r=this,a=t.row,o=t.column,e={},Object.defineProperty(e,"data",{enumerable:!0,get:function(){return r.m_callback._getCellData(a,o)},set:function(t){r.m_callback._setCellData(a,o,t)}}),e},t.ArrayCellSet.prototype.getMetadata=function(t){return this.m_callback._getCellMetadata(t.row,t.column)},t.ArrayCellSet.prototype.getStart=function(t){return"row"==t?this.m_startRow:"column"==t?this.m_startColumn:-1},t.ArrayCellSet.prototype.getCount=function(t){return"row"===t?Math.max(0,this.m_endRow-this.m_startRow):"column"===t?Math.max(0,this.m_endColumn-this.m_startColumn):0},t.ArrayCellSet.prototype.getExtent=function(t){return{row:{extent:1,more:{before:!1,after:!1}},column:{extent:1,more:{before:!1,after:!1}}}},t.ArrayCellSet.prototype.getStartRow=function(){return this.m_startRow},t.ArrayCellSet.prototype.getStartColumn=function(){return this.m_startColumn},t.ArrayDataGridDataSource=function(r,e){if(!(r instanceof Array)&&"function"!=typeof r&&"function"!=typeof r.subscribe)throw"_ERR_DATA_INVALID_TYPE_SUMMARY","_ERR_DATA_INVALID_TYPE_DETAIL",new Error("_ERR_DATA_INVALID_TYPE_SUMMARY\n_ERR_DATA_INVALID_TYPE_DETAIL");this.rowHeaderKey=this._getRowHeaderFromOptions(e),null!=e&&(this.columns=e.columns,this.sortCriteria=e.initialSort),t.ArrayDataGridDataSource.superclass.constructor.call(this,r)},t.Object.createSubclass(t.ArrayDataGridDataSource,t.DataGridDataSource,"oj.ArrayDataGridDataSource"),t.ArrayDataGridDataSource.prototype.Init=function(){null==this.columns&&(this.columns=this._getColumnsForScaffolding(this.getDataArray())),this._initializeRowKeys(),"function"==typeof this.data&&this.data.subscribe(this._subscribe.bind(this),null,"arrayChange"),t.ArrayDataGridDataSource.superclass.Init.call(this)},t.ArrayDataGridDataSource.prototype.comparator=null,t.ArrayDataGridDataSource.prototype.sortCriteria=null,t.ArrayDataGridDataSource.prototype._getRowHeaderFromOptions=function(t){if(null!=t&&null!=t.rowHeader){var r=t.rowHeader;if("object"==typeof r){if(null!=r.default){if("none"==r.default)return;if("index"==r.default)return"m_defaultIndex"}}else if(null!=r)return r}return"m_defaultIndex"},t.ArrayDataGridDataSource.prototype._initializeRowKeys=function(){var t;for(t=this.getDataArray(),this.lastKey=0;this.lastKey<t.length;this.lastKey+=1)t[this.lastKey].ojKey=this.lastKey.toString()},t.ArrayDataGridDataSource.prototype._getColumnsForScaffolding=function(t){var r,e;if("number"!=typeof t.length||0===t.length)return[];for(r in e=[],t[0])t[0].hasOwnProperty(r)&&(null!=this.rowHeaderKey&&r==this.rowHeaderKey||e.push(r));return e},t.ArrayDataGridDataSource.prototype.getCount=function(t){return"row"===t?this._size():"column"===t?this.columns.length:0},t.ArrayDataGridDataSource.prototype.getCountPrecision=function(t){return"exact"},t.ArrayDataGridDataSource.prototype._getHeaderData=function(t,r){return"row"===t?null==this.rowHeaderKey?null:"m_defaultIndex"==this.rowHeaderKey?this._getRowKeyByIndex(r):this.getDataArray()[r][this.rowHeaderKey]:"column"===t?this.columns[r]:void 0},t.ArrayDataGridDataSource.prototype._getHeaderMetadata=function(t,r){var e;return"row"===t?{key:this._getRowKeyByIndex(r)}:"column"===t?(e=this._getHeaderData(t,r),null!=this.sortCriteria&&this.sortCriteria.key===e?{key:this._getHeaderData(t,r),sortDirection:this.sortCriteria.direction}:{key:e}):void 0},t.ArrayDataGridDataSource.prototype.fetchHeaders=function(r,e,a){var o,n,i,s,u,l;o=r.axis,n=r.start,i=r.count,n=Math.max(0,n),"column"===o?s=Math.min(this.columns.length,n+i):(l=this.getDataArray(),s=void 0===this.rowHeaderKey?n:Math.min(l.length,n+i)),u=new t.ArrayHeaderSet(n,s,o,this),null!=e&&null!=e.success&&(null==a&&(a={}),e.success.call(a.success,u,r,null))},t.ArrayDataGridDataSource.prototype._getCellData=function(t,r){var e=this.columns[r];return this.getDataArray()[t][e]},t.ArrayDataGridDataSource.prototype._setCellData=function(t,r,e){this.getDataArray()[t][this.columns[r]]=e},t.ArrayDataGridDataSource.prototype._getCellMetadata=function(t,r){return{keys:{row:this._getRowKeyByIndex(t),column:this.columns[r]}}},t.ArrayDataGridDataSource.prototype.fetchCells=function(r,e,a){var o,n,i,s,u,l,c;for(o=0;o<r.length;o+=1)"row"===(n=r[o]).axis?(i=n.start,s=Math.min(this._size(),i+n.count)):"column"===n.axis&&(l=n.start,c=Math.min(this.columns.length,l+n.count));void 0!==s&&void 0!==c?(u=new t.ArrayCellSet(i,s,l,c,this),null!=e&&null!=e.success&&(null==a&&(a={}),e.success.call(a.success,u,r))):null!=e&&null!=e.error&&(null==a&&(a={}),e.error.call(a.error))},t.ArrayDataGridDataSource.prototype.keys=function(t){var r=t.row,e=t.column;return new Promise(function(t,a){t({row:this._getRowKeyByIndex(r),column:this.columns[e]})}.bind(this))},t.ArrayDataGridDataSource.prototype.indexes=function(t){var r=t.row,e=t.column;return new Promise(function(t,a){t({row:this._getRowIndexByKey(r),column:this.columns.indexOf(e)})}.bind(this))},t.ArrayDataGridDataSource.prototype.sort=function(t,r,e){var a,o,n,i,s=[],u=[];if(null!=r&&null==e&&(e={}),null==this.origData&&(this._origSortCriteria=this.sortCriteria,this.origData=this.data.slice()),null==t?t=this.sortCriteria:this.sortCriteria=t,null!=t)if(n=t.axis,i=t.key,t.direction,"column"===n)this.getDataArray().sort(this._getComparator()),null!=r&&null!=r.success&&r.success.call(e.success);else if("row"===n){for(o=this._getRowIndexByKey(i),a=0;a<this.columns.length;a+=1)s[a]=this.getDataArray()[o][this.columns[a]];for(s.sort(this._getComparator()),a=0;a<this.columns.length;a+=1)u[a]=this.columns[s.indexOf(this.getDataArray()[o][this.columns[a]])];this.origColumns=this.columns,this.columns=u,null!=r&&null!=r.success&&r.success.call(e.success)}else null!==r&&null!=r.error&&r.error.call(e.error,"Invalid axis value");else this._resetSortOrder(r,e)},t.ArrayDataGridDataSource.prototype._resetSortOrder=function(t,r){null!=this.origData&&(this.data=this.origData,this.sortCriteria=this._origSortCriteria),null!=this.origColumns&&(this.columns=this.origColumns),null!=t&&null!=t.success&&t.success.call(r.success)},t.ArrayDataGridDataSource.prototype.getCapability=function(t){return"sort"===t?"column":"move"===t?"row":null},t.ArrayDataGridDataSource.prototype._getComparator=function(){var t,r,e,a;return null==(t=this.comparator)?(r=this.sortCriteria.key,e=this.sortCriteria.direction,a=this.sortCriteria.axis,this._naturalSort(e,r,a)):t},t.ArrayDataGridDataSource.prototype._naturalSort=function(t,r,e){return"ascending"===t?function(t,a){var o,n;return null!=r&&"column"==e&&(t instanceof Array?(t=t[parseInt(r,10)],a=a[parseInt(r,10)]):(t=t[r],a=a[r])),o=isNaN(t),n=isNaN(a),t instanceof Date&&(t=t.toISOString(),o=!0),a instanceof Date&&(a=a.toISOString(),n=!0),o&&n?t<a?-1:t===a?0:1:o?1:n?-1:t-a}:"descending"===t?function(t,a){var o,n;return null!=r&&"column"==e&&(t instanceof Array?(t=t[parseInt(r,10)],a=a[parseInt(r,10)]):(t=t[r],a=a[r])),o=isNaN(t),n=isNaN(a),t instanceof Date&&(t=t.toISOString(),o=!0),a instanceof Date&&(a=a.toISOString(),n=!0),o&&n?t>a?-1:t===a?0:1:o?-1:n?1:a-t}:void 0},t.ArrayDataGridDataSource.prototype.move=function(t,r,e,a,o){var n,i,s,u;n=this._getRowIndexByKey(t),i=this.data.splice(n,1)[0],this.data instanceof Array&&(u=this._getModelEvent("delete",t,null,n,-1,!0),this.handleEvent("change",u)),null===r?(this.data.push(i),s=this.data.length-1):(s=this._getRowIndexByKey(r),this.data.splice(s,0,i)),this.data instanceof Array&&(u=this._getModelEvent("insert",t,null,s,-1),this.handleEvent("change",u)),null!=this.origData&&(this.origData=this.data.slice())},t.ArrayDataGridDataSource.prototype.moveOK=function(t,r,e){return"valid"},t.ArrayDataGridDataSource.prototype.getDataArray=function(){return"function"==typeof this.data?this.data():this.data},t.ArrayDataGridDataSource.prototype._getRowIndexByKey=function(t){var r,e=this.getDataArray();for(r=0;r<e.length;r++)if(e[r].ojKey===t)return r;return-1},t.ArrayDataGridDataSource.prototype._getRowKeyByIndex=function(t){var r=this.getDataArray();return r[t]?r[t].ojKey:null},t.ArrayDataGridDataSource.prototype._getModelEvent=function(t,r,e,a,o,n){var i={};return i.source=this,i.operation=t,i.keys={row:r,column:e},i.indexes={row:a,column:o},i.silent=n,i},t.ArrayDataGridDataSource.prototype._subscribe=function(t){var r,e,a,o,n,i,s=!1,u=!1,l=[],c=[];for(r=0;r<t.length;r++){if(void 0!==(i=t[r]).moved){u=!0,n=this._getModelEvent("refresh",null,null),this.handleEvent("change",n);break}"added"===i.status&&(s=!0)}if(!u){for(r=0;r<t.length;r++)"deleted"===(i=t[r]).status&&(e=i.value,o=i.index,a=e.ojKey,l.push({row:a,column:-1}),c.push({row:o,column:-1}));for(l.length>0&&(n={source:this,operation:"delete",keys:l,indexes:c,silent:s},this.handleEvent("change",n)),r=0;r<t.length;r++)"added"===(i=t[r]).status&&(e=i.value,o=i.index,null==e.ojKey&&(e.ojKey=this.lastKey.toString(),this.lastKey++),a=e.ojKey,n=this._getModelEvent("insert",a,null,o,-1),this.handleEvent("change",n))}null!=this.origData&&(this.origData=this.data.slice())},t.ArrayDataGridDataSource.prototype._size=function(){return this.getDataArray().length},t.ArrayDataGridDataSource.prototype.getRowHeaderKey=function(){return this.rowHeaderKey},t.ArrayDataGridDataSource.prototype.getColumns=function(){return this.columns},t.ArrayDataGridDataSource.prototype.getData=function(){return this.data},t.ArrayHeaderSet=function(t,r,e,a){this.m_start=t,this.m_end=r,this.m_axis=e,this.m_callback=a},t.ArrayHeaderSet.prototype.getData=function(r,e){return null==this.m_callback?null:(t.Assert.assert(r<=this.m_end&&r>=this.m_start,"index out of bounds"),t.Assert.assert(null==e||0==e,"level out of bounds"),this.m_callback._getHeaderData(this.m_axis,r))},t.ArrayHeaderSet.prototype.getMetadata=function(r,e){return null==this.m_callback?null:(t.Assert.assert(r<=this.m_end&&r>=this.m_start,"index out of bounds"),t.Assert.assert(null==e||0==e,"level out of bounds"),this.m_callback._getHeaderMetadata(this.m_axis,r))},t.ArrayHeaderSet.prototype.getLevelCount=function(){return this.getCount()>0?1:0},t.ArrayHeaderSet.prototype.getExtent=function(r,e){return t.Assert.assert(r<=this.m_end&&r>=this.m_start,"index out of bounds"),t.Assert.assert(null==e||0==e,"level out of bounds"),{extent:1,more:{before:!1,after:!1}}},t.ArrayHeaderSet.prototype.getDepth=function(r,e){return t.Assert.assert(r<=this.m_end&&r>=this.m_start,"index out of bounds"),t.Assert.assert(null==e||0==e,"level out of bounds"),1},t.ArrayHeaderSet.prototype.getCount=function(){return null==this.m_callback?0:Math.max(0,this.m_end-this.m_start)},t.ArrayHeaderSet.prototype.getStart=function(){return this.m_start}});